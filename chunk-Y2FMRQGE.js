import{A as $,B as dt,C as Ue,D as vh,E as uy,F as to,G as ne,H as _t,I as ll,J as wh,K as Ct,L as Bn,M as bi,N as cl,O as hy,P as Ot,Q as Be,a as O,b as _r,c as il,d as ty,e as ny,f as Ge,g as rl,h as Zs,i as gh,j as iy,k as Qt,l as _h,m as sl,n as ry,o as sy,p as ol,q as De,r as oy,s as ay,t as At,u as Un,v as al,w as eo,x as yh,y as ly,z as cy}from"./chunk-OJR25IT7.js";import{c as ey,d as ph,g as tl,h as nl,j as mh}from"./chunk-HX3ESI56.js";import{g as Z_}from"./chunk-5IRIGFBY.js";import{D as el,d as dh,n as fh}from"./chunk-7IEGBUCH.js";import{$ as Ya,Ca as ih,Cb as H_,Da as $t,E as zs,G as Ws,Ga as $_,Hb as $s,Kc as _n,Mc as Si,Na as rh,Oa as sh,Pb as Qs,Sc as uh,T as Ha,Ta as Xa,Tb as Hs,Ub as rt,Vb as Ys,X as q_,Xa as mt,Yb as mn,aa as Ai,ba as j_,c as Mn,ca as th,db as Ln,dd as J_,ea as G_,ed as X_,f as Kt,fa as Ja,g as U_,ga as pn,ha as nh,hc as Vt,ic as gn,j as pr,jc as Js,k as B_,ka as K_,kc as ah,lc as lh,ma as z_,n as Ii,nc as ch,o as mr,od as Za,p as Fn,pb as Q_,pc as Y_,q as zt,qb as oh,ra as ht,sa as Wt,td as hh,u as Ce,ua as Ne,wa as K,wc as Xs,xa as gr,yb as Le,yc as gt,za as W_,zb as Ci}from"./chunk-7QP7SMW2.js";import{a as Ae,b as Dt,h as eh,i as k}from"./chunk-66YHNWRR.js";var dy=class n{localStorageKey="xamplify-ng";initialState={theme:"light",direction:"ltr",navigationStyles:"vertical",menuStyles:"",layoutStyles:"default",pageStyles:"regular",widthStyles:"fullwidth",menuPosition:"fixed",headerPosition:"fixed",menuColor:"light",headerColor:"light",themePrimary:"",themeBackground:"",backgroundImage:""};stateSubject=new U_(this.initialState);state$=this.stateSubject.asObservable();navigationStyles;constructor(){let e=this.getInitialStateFromLocalStorage();this.initializeState(),this.stateSubject.next(e)}getInitialStateFromLocalStorage(){try{let e=localStorage.getItem(this.localStorageKey);if(e)return JSON.parse(e)}catch(e){console.error("Error retrieving initial state from local storage:",e)}return this.initialState}initializeState(){let e=Ae({},this.initialState);this.applyDirectionSpecificChanges(e.direction),this.stateSubject.next(e)}updateState(e){let t=this.stateSubject.getValue();if(!t){this.updateStateAndEmit(e);return}if(e){let i=Ae(Ae({},t),e);this.updateStateAndEmit(i)}else{this.updateStateAndEmit(t);return}}applyThemeBackgroundSpecificChanges(e){if(!e)return;let t=document.querySelector("html");t?.style.setProperty("--body-bg-rgb",e.main),t?.style.setProperty("--body-bg-rgb2",e.secondary),t?.style.setProperty("--light-rgb",e.accent),t?.style.setProperty("--form-control-bg",`rgba(${e.accent})`),t?.style.setProperty("--input-border",e.overlay),t?.style.setProperty("--input-border",e.overlay),t?.style.setProperty("--gray-3",e.primary),this.applythemeSpecificChanges(e.theme)}applyDirectionSpecificChanges(e){document.querySelector("html")?.setAttribute("dir",e)}applythemeSpecificChanges(e){let t=document.querySelector("html");t?.setAttribute("data-theme-mode",e),t?.setAttribute("data-header-styles",e),t?.setAttribute("data-menu-styles",e)}applyNavigationStylesSpecificChanges(e){let t=document.querySelector("html");t?.setAttribute("data-nav-layout",e),e=="horizontal"&&(t?.setAttribute("data-nav-style","menu-click"),t?.removeAttribute("data-vertical-style"))}applyMenuStylesSpecificChanges(e){let t=document.querySelector("html");t?.setAttribute("data-nav-style",e),t?.setAttribute("data-toggled",e+"-closed"),t?.removeAttribute("data-vertical-style")}applyLayoutStylesSpecificChanges(e){let t=document.querySelector("html");switch(t?.setAttribute("data-vertical-style",e),t?.removeAttribute("data-nav-style"),e){case"default":t?.setAttribute("data-vertical-style","overlay"),t?.setAttribute("data-toggled","");break;case"closed":t?.setAttribute("data-toggled","close-menu-close");break;case"icontext":t?.setAttribute("data-toggled","icon-text-close");break;case"overlay":t?.setAttribute("data-toggled","icon-overlay-close");break;case"detached":t?.setAttribute("data-toggled","detached-close");break;case"doublemenu":t?.setAttribute("data-toggled","double-menu-open");break}e==="icon-text"?t?.setAttribute("icon-text","open"):t?.removeAttribute("icon-text")}applypageStylesSpecificChanges(e){document.querySelector("html")?.setAttribute("data-page-style",e);let i=document.querySelector(".slide-right");if(i)i.classList.contains("d-none")?i.classList.remove("d-none"):i.classList.add("d-none");else{let r=document.createElement("div");r.classList.add("slide-right","d-none"),document.body.appendChild(r)}}applywidthStylesSpecificChanges(e){document.querySelector("html")?.setAttribute("data-width",e)}applymenuPositionSpecificChanges(e){document.querySelector("html")?.setAttribute("data-menu-position",e)}applyheaderPositionSpecificChanges(e){document.querySelector("html")?.setAttribute("data-header-position",e)}applyheaderColorSpecificChanges(e){document.querySelector("html")?.setAttribute("data-header-styles",e)}applymenuColorSpecificChanges(e){document.querySelector("html")?.setAttribute("data-menu-styles",e)}applyPrimarySpecificChanges(e){document.querySelector("html")?.style.setProperty("--primary-rgb",e)}applybackgroundImageSpecificChanges(e){document.querySelector("html")?.setAttribute("data-bg-img",e)}applyReset(){let e=document.querySelector("html");e&&(e?.style.removeProperty("--body-bg-rgb"),e?.style.removeProperty("--body-bg-rgb2"),e?.style.removeProperty("--light-rgb"),e?.style.removeProperty("--gray-3"),e?.style.removeProperty("--form-control-bg"),e?.style.removeProperty("--input-border"),e?.style.removeProperty("--primary-rgb")),e?.removeAttribute("data-bg-img"),e?.setAttribute("data-vertical-style","overlay"),this.stateSubject.next(this.initialState),this.updateStateAndEmit(this.initialState),localStorage.clear();let t=document.querySelector('[name="theme-primary"]:checked');t&&(t.checked=!1);let i=document.querySelector('[name="theme-background"]:checked');i&&(i.checked=!1);let r=document.querySelector('[name="layout-width"]:checked');r&&(r.checked=!0)}updateStateAndEmit(e){let t=this.stateSubject.getValue();e.theme&&this.applythemeSpecificChanges(e.theme),e.direction&&this.applyDirectionSpecificChanges(e.direction),e.navigationStyles&&this.applyNavigationStylesSpecificChanges(e.navigationStyles),e.menuStyles&&!e.layoutStyles&&this.applyMenuStylesSpecificChanges(e.menuStyles),e.layoutStyles&&!e.menuStyles&&this.applyLayoutStylesSpecificChanges(e.layoutStyles),e.pageStyles&&this.applypageStylesSpecificChanges(e.pageStyles),e.widthStyles&&this.applywidthStylesSpecificChanges(e.widthStyles),e.menuPosition&&this.applymenuPositionSpecificChanges(e.menuPosition),e.headerPosition&&this.applyheaderPositionSpecificChanges(e.headerPosition),e.themePrimary&&this.applyPrimarySpecificChanges(e.themePrimary),e.themeBackground&&this.applyThemeBackgroundSpecificChanges(e.themeBackground),e.headerColor&&this.applyheaderColorSpecificChanges(e.headerColor),e.menuColor&&this.applymenuColorSpecificChanges(e.menuColor),e.backgroundImage&&this.applybackgroundImageSpecificChanges(e.backgroundImage),this.stateSubject.next(e),this.updateLocalStorage(e)}updateLocalStorage(e){try{localStorage.setItem(this.localStorageKey,JSON.stringify(e))}catch{}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=ht({token:n,factory:n.\u0275fac,providedIn:"root"})};var gA="firebase",_A="10.14.1";Ot(gA,_A,"app");var vn=new J_("ANGULARFIRE2_VERSION");var yA=(n,e)=>{let t=e?[e]:hy(),i=[];return t.forEach(r=>{r.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},yn=class{constructor(){return yA(vA)}},vA="app-check";function Th(){}var ul=class{zone;delegate;constructor(e,t=B_){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let r=this.zone,s=function(o){r.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,i)}},Eh=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let i=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Th,{},Th,Th)),t.pipe(K_({next:i,complete:i,error:i})).subscribe(e).add(i)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},vr=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new ul(Zone.current)),this.insideAngular=t.run(()=>new ul(Zone.current,pr)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(i){return new(i||n)(K(mt))};static \u0275prov=ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function wA(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function be(n){return TA(wA())(n)}function TA(n){return function(t){return t=t.lift(new Eh(n.ngZone)),t.pipe(mr(n.outsideAngular),Ii(n.insideAngular))}}var EA="firebase",IA="10.14.1";Be.registerVersion(EA,IA,"app-compat");var AA=["ngOnDestroy"],py=(n,e,t,i={})=>new Proxy(n,{get:(r,s)=>t.runOutsideAngular(()=>{if(n[s])return i?.spy?.get&&i.spy.get(s,n[s]),n[s];if(AA.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let c=a?.[s];return typeof c=="function"?c.bind(a):c?.then?c.then(u=>t.run(()=>u)):t.run(()=>c)});return new Proxy(()=>{},{get:(a,c)=>o[c],apply:(a,c,u)=>o.then(d=>{let p=d?.(...u);return i?.spy?.apply&&i.spy.apply(s,u,p),p})})})});var hl=class{constructor(e){return e}},qn=new Ne("angularfire2.app.options"),jn=new Ne("angularfire2.app.name");function Ri(n,e,t){let i=typeof t=="string"&&t||"[DEFAULT]",r=typeof t=="object"&&t||{};r.name=r.name||i;let o=Be.apps.filter(a=>a&&a.name===r.name)[0]||e.runOutsideAngular(()=>Be.initializeApp(n,r));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;CA("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new hl(o)}var CA=(n,...e)=>{hh()&&typeof console<"u"&&console[n](...e)},SA={provide:hl,useFactory:Ri,deps:[qn,mt,[new W_,jn]]},Jx=(()=>{class n{static initializeApp(t,i){return{ngModule:n,providers:[{provide:qn,useValue:t},{provide:jn,useValue:i}]}}constructor(t){Be.registerVersion("angularfire",vn.full,"core"),Be.registerVersion("angularfire",vn.full,"app-compat"),Be.registerVersion("angular",X_.full,t.toString())}static \u0275fac=function(i){return new(i||n)(K(Ln))};static \u0275mod=$t({type:n});static \u0275inj=Wt({providers:[SA]})}return n})();function wr(n,e,t,i,r){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return bA(r,o)||(fy("error",`${e} was already initialized on the ${t} Firebase App with different settings.${RA?" You may need to reload as Firebase is not HMR aware.":""}`),fy("warn",{is:r,was:o})),s;{let a=i();return globalThis.\u0275AngularfireInstanceCache.push([n,a,r]),a}}function bA(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var RA=typeof module<"u"&&!!module.hot,fy=(n,...e)=>{hh()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var PA=new Map,xA={activated:!1,tokenObservers:[]},kA={initialized:!1,enabled:!1};function Mt(n){return PA.get(n)||Object.assign({},xA)}function Ty(){return kA}var NA="https://content-firebaseappcheck.googleapis.com/v1";var DA="exchangeDebugToken",my={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},ak=24*60*60*1e3;var Ch=class{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return k(this,null,function*(){this.stop();try{this.pending=new Ge,this.pending.promise.catch(t=>{}),yield VA(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Ge,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function VA(n){return new Promise(e=>{setTimeout(e,n)})}var OA={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Gn=new sy("appCheck","AppCheck",OA);function Ey(n){if(!Mt(n).activated)throw Gn.create("use-before-activation",{appName:n.name})}function Iy(i,r){return k(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let y=yield o.getHeartbeatsHeader();y&&(s["X-Firebase-Client"]=y)}let a={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(n,a)}catch(y){throw Gn.create("fetch-network-error",{originalErrorMessage:y?.message})}if(c.status!==200)throw Gn.create("fetch-status-error",{httpStatus:c.status});let u;try{u=yield c.json()}catch(y){throw Gn.create("fetch-parse-error",{originalErrorMessage:y?.message})}let d=u.ttl.match(/^([\d.]+)(s)$/);if(!d||!d[2]||isNaN(Number(d[1])))throw Gn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${u.ttl}`});let p=Number(d[1])*1e3,m=Date.now();return{token:u.token,expireTimeMillis:m+p,issuedAtTimeMillis:m}})}function Ay(n,e){let{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${NA}/projects/${t}/apps/${i}:${DA}?key=${r}`,body:{debug_token:e}}}var MA="firebase-app-check-database",FA=1,Sh="firebase-app-check-store";var dl=null;function LA(){return dl||(dl=new Promise((n,e)=>{try{let t=indexedDB.open(MA,FA);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(Gn.create("storage-open",{originalErrorMessage:(r=i.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=i=>{let r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(Sh,{keyPath:"compositeKey"})}}}catch(t){e(Gn.create("storage-open",{originalErrorMessage:t?.message}))}}),dl)}function UA(n,e){return BA(qA(n),e)}function BA(n,e){return k(this,null,function*(){let i=(yield LA()).transaction(Sh,"readwrite"),s=i.objectStore(Sh).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},i.onerror=c=>{var u;a(Gn.create("storage-set",{originalErrorMessage:(u=c.target.error)===null||u===void 0?void 0:u.message}))}})})}function qA(n){return`${n.options.appId}-${n.name}`}var bh=new Bn("@firebase/app-check");function Ah(n,e){return sl()?UA(n,e).catch(t=>{bh.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Cy(){return Ty().enabled}function Sy(){return k(this,null,function*(){let n=Ty();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var jA={error:"UNKNOWN_ERROR"};function GA(n){return il.encodeString(JSON.stringify(n),!1)}function Rh(n,e=!1){return k(this,null,function*(){let t=n.app;Ey(t);let i=Mt(t),r=i.token,s;if(r&&!no(r)&&(i.token=void 0,r=void 0),!r){let c=yield i.cachedTokenPromise;c&&(no(c)?r=c:yield Ah(t,void 0))}if(!e&&r&&no(r))return{token:r.token};let o=!1;if(Cy()){i.exchangeTokenPromise||(i.exchangeTokenPromise=Iy(Ay(t,yield Sy()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);let c=yield i.exchangeTokenPromise;return yield Ah(t,c),i.token=c,{token:c.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),r=yield Mt(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?bh.warn(c.message):bh.error(c),s=c}let a;return r?s?no(r)?a={token:r.token,internalError:s}:a=_y(s):(a={token:r.token},i.token=r,yield Ah(t,r)):a=_y(s),o&&$A(t,a),a})}function KA(n){return k(this,null,function*(){let e=n.app;Ey(e);let{provider:t}=Mt(e);if(Cy()){let i=yield Sy(),{token:r}=yield Iy(Ay(e,i),n.heartbeatServiceProvider);return{token:r}}else{let{token:i}=yield t.getToken();return{token:i}}})}function zA(n,e,t,i){let{app:r}=n,s=Mt(r),o={next:t,error:i,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&no(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),gy(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>gy(n))}function by(n,e){let t=Mt(n),i=t.tokenObservers.filter(r=>r.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function gy(n){let{app:e}=n,t=Mt(e),i=t.tokenRefresher;i||(i=WA(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function WA(n){let{app:e}=n;return new Ch(()=>k(this,null,function*(){let t=Mt(e),i;if(t.token?i=yield Rh(n,!0):i=yield Rh(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let t=Mt(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,r=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,r),Math.max(0,i-Date.now())}else return 0},my.RETRIAL_MIN_WAIT,my.RETRIAL_MAX_WAIT)}function $A(n,e){let t=Mt(n).tokenObservers;for(let i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function no(n){return n.expireTimeMillis-Date.now()>0}function _y(n){return{token:GA(jA),error:n}}var Ph=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Mt(this.app);for(let t of e)by(this.app,t.next);return Promise.resolve()}};function QA(n,e){return new Ph(n,e)}function HA(n){return{getToken:e=>Rh(n,e),getLimitedUseToken:()=>KA(n),addTokenListener:e=>zA(n,"INTERNAL",e),removeTokenListener:e=>by(n.app,e)}}var YA="@firebase/app-check",JA="0.8.8";var XA="app-check",yy="app-check-internal";function ZA(){bi(new _t(XA,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return QA(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(yy).initialize()})),bi(new _t(yy,n=>{let e=n.getProvider("app-check").getImmediate();return HA(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Ot(YA,JA)}ZA();var eC=["localhost","0.0.0.0","127.0.0.1"],vk=typeof window<"u"&&eC.includes(window.location.hostname);var io=new Ne("angularfire2.auth.use-emulator"),ro=new Ne("angularfire2.auth.settings"),so=new Ne("angularfire2.auth.tenant-id"),oo=new Ne("angularfire2.auth.langugage-code"),ao=new Ne("angularfire2.auth.use-device-language"),lo=new Ne("angularfire.auth.persistence"),co=(n,e,t,i,r,s,o,a)=>wr(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let c=e.runOutsideAngular(()=>n.auth());if(t&&c.useEmulator(...t),i&&(c.tenantId=i),c.languageCode=r,s&&c.useDeviceLanguage(),o)for(let[u,d]of Object.entries(o))c.settings[u]=d;return a&&c.setPersistence(a),c},[t,i,r,s,o,a]),uo=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,i,r,s,o,a,c,u,d,p,m,y){let C=new Kt,x=zt(void 0).pipe(Ii(o.outsideAngular),pn(()=>s.runOutsideAngular(()=>import("./chunk-7M4JHQWU.js"))),Ce(()=>Ri(t,s,i)),Ce(N=>co(N,s,a,u,d,p,c,m)),th({bufferSize:1,refCount:!1}));if(el(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=zt(null);else{x.pipe(q_()).subscribe();let N=x.pipe(pn(M=>M.getRedirectResult().then(W=>W,()=>null)),be,th({bufferSize:1,refCount:!1})),q=x.pipe(pn(M=>new Mn(W=>({unsubscribe:s.runOutsideAngular(()=>M.onAuthStateChanged(H=>W.next(H),H=>W.error(H),()=>W.complete()))})))),j=x.pipe(pn(M=>new Mn(W=>({unsubscribe:s.runOutsideAngular(()=>M.onIdTokenChanged(H=>W.next(H),H=>W.error(H),()=>W.complete()))}))));this.authState=N.pipe(nh(q),mr(o.outsideAngular),Ii(o.insideAngular)),this.user=N.pipe(nh(j),mr(o.outsideAngular),Ii(o.insideAngular)),this.idToken=this.user.pipe(pn(M=>M?Fn(M.getIdToken()):zt(null))),this.idTokenResult=this.user.pipe(pn(M=>M?Fn(M.getIdTokenResult()):zt(null))),this.credential=zs(N,C,this.authState.pipe(Ws(M=>!M))).pipe(Ce(M=>M?.user?M:null),mr(o.outsideAngular),Ii(o.insideAngular))}return py(this,x,s,{spy:{apply:(N,q,j)=>{(N.startsWith("signIn")||N.startsWith("createUser"))&&j.then(M=>C.next(M))}}})}static \u0275fac=function(i){return new(i||n)(K(qn),K(jn,8),K(Ln),K(mt),K(vr),K(io,8),K(ro,8),K(so,8),K(oo,8),K(ao,8),K(lo,8),K(yn,8))};static \u0275prov=ht({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Ok=(()=>{class n{constructor(){Be.registerVersion("angularfire",vn.full,"auth-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=$t({type:n});static \u0275inj=Wt({providers:[uo]})}return n})();var Py="@firebase/database",xy="1.0.8";var jd="";function Gd(n){jd=n}var Lh=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),De(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:ol(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Uh=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return At(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var av=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Lh(e)}}catch{}return new Uh},xi=av("localStorage"),Bh=av("sessionStorage");var Ar=new Bn("@firebase/database"),lv=function(){let n=1;return function(){return n++}}(),cv=function(n){let e=uy(n),t=new cy;t.update(e);let i=t.digest();return il.encodeByteArray(i)},Oo=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=Oo.apply(null,i):typeof i=="object"?e+=De(i):e+=i,e+=" "}return e},ki=null,ky=!0,uv=function(n,e){O(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Ar.logLevel=Ct.VERBOSE,ki=Ar.log.bind(Ar),e&&Bh.set("logging_enabled",!0)):typeof n=="function"?ki=n:(ki=null,Bh.remove("logging_enabled"))},Ke=function(...n){if(ky===!0&&(ky=!1,ki===null&&Bh.get("logging_enabled")===!0&&uv(!0)),ki){let e=Oo.apply(null,n);ki(e)}},Mo=function(n){return function(...e){Ke(n,...e)}},qh=function(...n){let e="FIREBASE INTERNAL ERROR: "+Oo(...n);Ar.error(e)},Jt=function(...n){let e=`FIREBASE FATAL ERROR: ${Oo(...n)}`;throw Ar.error(e),new Error(e)},Ze=function(...n){let e="FIREBASE WARNING: "+Oo(...n);Ar.warn(e)},nC=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Ze("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Bl=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},iC=function(n){if(Qt()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},$n="[MIN_NAME]",wn="[MAX_NAME]",Di=function(n,e){if(n===e)return 0;if(n===$n||e===wn)return-1;if(e===$n||n===wn)return 1;{let t=Ny(n),i=Ny(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},rC=function(n,e){return n===e?0:n<e?-1:1},ho=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+De(e))},Kd=function(n){if(typeof n!="object"||n===null)return De(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=De(e[i]),t+=":",t+=Kd(n[e[i]]);return t+="}",t},hv=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let r=0;r<t;r+=e)r+e>t?i.push(n.substring(r,t)):i.push(n.substring(r,r+e));return i};function ze(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var dv=function(n){O(!Bl(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,r,s,o,a,c;n===0?(s=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),s=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-i-t))));let u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(s%2?1:0),s=Math.floor(s/2);u.push(r?1:0),u.reverse();let d=u.join(""),p="";for(c=0;c<64;c+=8){let m=parseInt(d.substr(c,8),2).toString(16);m.length===1&&(m="0"+m),p=p+m}return p.toLowerCase()},sC=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},oC=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function aC(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var lC=new RegExp("^-?(0*)\\d{1,10}$"),cC=-2147483648,uC=2147483647,Ny=function(n){if(lC.test(n)){let e=Number(n);if(e>=cC&&e<=uC)return e}return null},Dr=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw Ze("Exception was thrown by user callback.",t),e},Math.floor(0))}},hC=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},go=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var jh=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){Ze(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Gh=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Ke("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ze(e)}},_o=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),pl="5",fv="v",pv="s",mv="r",gv="f",_v=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,yv="ls",vv="p",Kh="ac",wv="websocket",Tv="long_polling";var ml=class{constructor(e,t,i,r,s=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=xi.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&xi.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function dC(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function Ev(n,e,t){O(typeof e=="string","typeof type must == string"),O(typeof t=="object","typeof params must == object");let i;if(e===wv)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Tv)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);dC(n)&&(t.ns=n.namespace);let r=[];return ze(t,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}var zh=class{constructor(){this.counters_={}}incrementCounter(e,t=1){At(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return ny(this.counters_)}};var kh={},Nh={};function zd(n){let e=n.toString();return kh[e]||(kh[e]=new zh),kh[e]}function fC(n,e){let t=n.toString();return Nh[t]||(Nh[t]=e()),Nh[t]}var Wh=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&Dr(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var Dy="start",pC="close",mC="pLPCommand",gC="pRTLPCB",Iv="id",Av="pw",Cv="ser",_C="cb",yC="seg",vC="ts",wC="d",TC="dframe",Sv=1870,bv=30,EC=Sv-bv,IC=25e3,AC=3e4,To=class n{constructor(e,t,i,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Mo(e),this.stats_=zd(t),this.urlFn=c=>(this.appCheckToken&&(c[Kh]=this.appCheckToken),Ev(t,Tv,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Wh(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(AC)),iC(()=>{if(this.isClosed_)return;this.scriptTagHolder=new $h((...s)=>{let[o,a,c,u,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Dy)this.id=a,this.password=c;else if(o===pC)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[Dy]="t",i[Cv]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[_C]=this.scriptTagHolder.uniqueCallbackIdentifier),i[fv]=pl,this.transportSessionId&&(i[pv]=this.transportSessionId),this.lastSessionId&&(i[yv]=this.lastSessionId),this.applicationId&&(i[vv]=this.applicationId),this.appCheckToken&&(i[Kh]=this.appCheckToken),typeof location<"u"&&location.hostname&&_v.test(location.hostname)&&(i[mv]=gv);let r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Qt()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!sC()&&!oC()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=De(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=ty(t),r=hv(i,EC);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Qt())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[TC]="t",i[Iv]=e,i[Av]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=De(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},$h=class n{constructor(e,t,i,r){if(this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Qt())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=lv(),window[mC+this.uniqueCallbackIdentifier]=e,window[gC+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Ke("frame writing exception"),a.stack&&Ke(a.stack),Ke(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ke("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[Iv]=this.myID,e[Av]=this.myPW,e[Cv]=this.currentSerial;let t=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+bv+i.length<=Sv;){let o=this.pendingSegs.shift();i=i+"&"+yC+r+"="+o.seg+"&"+vC+r+"="+o.ts+"&"+wC+r+"="+o.d,r++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(i,Math.floor(IC)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,t){Qt()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{Ke("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var CC=16384,SC=45e3,gl=null;typeof MozWebSocket<"u"?gl=MozWebSocket:typeof WebSocket<"u"&&(gl=WebSocket);var Er=(()=>{class n{constructor(t,i,r,s,o,a,c){this.connId=t,this.applicationId=r,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Mo(this.connId),this.stats_=zd(i),this.connURL=n.connectionURL_(i,a,c,s,r),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,r,s,o){let a={};return a[fv]=pl,!Qt()&&typeof location<"u"&&location.hostname&&_v.test(location.hostname)&&(a[mv]=gv),i&&(a[pv]=i),r&&(a[yv]=r),s&&(a[Kh]=s),o&&(a[vv]=o),Ev(t,wv,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,xi.set("previous_websocket_failure",!0);try{let r;if(Qt()){let s=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":`Firebase/${pl}/${jd}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(r.proxy={origin:a})}this.mySock=new gl(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(i);r&&r.length>1&&parseFloat(r[1])<4.4&&(t=!0)}return!t&&gl!==null&&!n.forceDisallow_}static previouslyFailed(){return xi.isInMemoryStorage||xi.get("previous_websocket_failure")===!0}markConnectionHealthy(){xi.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let r=ol(i);this.onMessage(r)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(O(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let r=this.extractFrameCount_(i);r!==null&&this.appendFrame_(r)}}send(t){this.resetKeepAlive();let i=De(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let r=hv(i,CC);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(SC))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),Rv=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[To,Er]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let i=Er&&Er.isAvailable(),r=i&&!Er.previouslyFailed();if(t.webSocketOnly&&(i||Ze("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Er];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),bC=6e4,RC=5e3,PC=10*1024,xC=100*1024,Dh="t",Vy="d",kC="s",Oy="r",NC="e",My="o",Fy="a",Ly="n",Uy="p",DC="h",Qh=class{constructor(e,t,i,r,s,o,a,c,u,d){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Mo("c:"+this.id+":"),this.transportManager_=new Rv(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=go(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>xC?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>PC?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Dh in e){let t=e[Dh];t===Fy?this.upgradeIfSecondaryHealthy_():t===Oy?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===My&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=ho("t",e),i=ho("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Uy,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Fy,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Ly,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=ho("t",e),i=ho("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=ho(Dh,e);if(Vy in e){let i=e[Vy];if(t===DC){let r=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===Ly){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===kC?this.onConnectionShutdown_(i):t===Oy?this.onReset_(i):t===NC?qh("Server Error: "+i):t===My?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):qh("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),pl!==i&&Ze("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),go(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(bC))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):go(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(RC))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Uy,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(xi.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var _l=class{put(e,t,i,r){}merge(e,t,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var yl=class{constructor(e){this.allowedEvents_=e,this.listeners_={},O(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let r=this.getInitialEvent(e);r&&t.apply(i,r)}off(e,t,i){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){O(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var vl=class n extends yl{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!gh()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return O(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var By=32,qy=768,ce=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function le(){return new ce("")}function Z(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Qn(n){return n.pieces_.length-n.pieceNum_}function de(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ce(n.pieces_,e)}function Wd(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function VC(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Eo(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Pv(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ce(e,0)}function ye(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof ce)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&t.push(i[r])}return new ce(t,0)}function ee(n){return n.pieceNum_>=n.pieces_.length}function st(n,e){let t=Z(n),i=Z(e);if(t===null)return e;if(t===i)return st(de(n),de(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function OC(n,e){let t=Eo(n,0),i=Eo(e,0);for(let r=0;r<t.length&&r<i.length;r++){let s=Di(t[r],i[r]);if(s!==0)return s}return t.length===i.length?0:t.length<i.length?-1:1}function $d(n,e){if(Qn(n)!==Qn(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function St(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(Qn(n)>Qn(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var Hh=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Eo(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=to(this.parts_[i]);xv(this)}};function MC(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=to(e),xv(n)}function FC(n){let e=n.parts_.pop();n.byteLength_-=to(e),n.parts_.length>0&&(n.byteLength_-=1)}function xv(n){if(n.byteLength_>qy)throw new Error(n.errorPrefix_+"has a key path longer than "+qy+" bytes ("+n.byteLength_+").");if(n.parts_.length>By)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+By+") or object contains a cycle "+Pi(n))}function Pi(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Yh=class n extends yl{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new n}getInitialEvent(e){return O(e==="visible","Unknown event type: "+e),[this.visible_]}};var fo=1e3,LC=60*5*1e3,jy=30*1e3,UC=1.3,BC=3e4,qC="server_kill",Gy=3,Qd=(()=>{class n extends _l{constructor(t,i,r,s,o,a,c,u){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=u,this.id=n.nextPersistentConnectionId_++,this.log_=Mo("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=fo,this.maxReconnectDelay_=LC,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u&&!Qt())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Yh.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&vl.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,r){let s=++this.requestNumber_,o={r:s,a:t,b:i};this.log_(De(o)),O(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),r&&(this.requestCBHash_[s]=r)}get(t){this.initConnection_();let i=new Ge,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?i.resolve(c):i.reject(c)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,r,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),O(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:s,hashFn:i,query:t,tag:r};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,r=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(r)})}sendListen_(t){let i=t.query,r=i._path.toString(),s=i._queryIdentifier;this.log_("Listen on "+r+" for "+s);let o={p:r},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,c=>{let u=c.d,d=c.s;n.warnOnListenWarnings_(u,i),(this.listens.get(r)&&this.listens.get(r).get(s))===t&&(this.log_("listen response",c),d!=="ok"&&this.removeListen_(r,s),t.onComplete&&t.onComplete(d,u))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&At(t,"w")){let r=Un(t,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let s='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();Ze(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||ay(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=jy)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=oy(t)?"auth":"gauth",r={cred:t};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(i,r,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,r=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,r)})}unlisten(t,i){let r=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,t._queryObject,i)}sendUnlisten_(t,i,r,s){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";s&&(o.q=r,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:r})}onDisconnectMerge(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:r})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,r,s){let o={p:i,d:r};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,i,r,s){this.putInternal("p",t,i,r,s)}merge(t,i,r,s){this.putInternal("m",t,i,r,s)}putInternal(t,i,r,s,o){this.initConnection_();let a={p:i,d:r};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,r,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,r=>{if(r.s!=="ok"){let o=r.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+De(t));let i=t.r,r=this.requestCBHash_[i];r&&(delete this.requestCBHash_[i],r(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):qh("Unrecognized action received from server: "+De(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){O(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=fo,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=fo,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>BC&&(this.reconnectDelay_=fo),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*UC)}this.onConnectStatus_(!1)}establishConnection_(){return k(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,u=function(){c?c.close():(a=!0,r())},d=function(m){O(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(m)};this.realtime_={close:u,sendRequest:d};let p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[m,y]=yield Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)]);a?Ke("getToken() completed but was canceled"):(Ke("getToken() completed. Creating connection."),this.authToken_=m&&m.accessToken,this.appCheckToken_=y&&y.token,c=new Qh(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,r,C=>{Ze(C+" ("+this.repoInfo_.toString()+")"),this.interrupt(qC)},o))}catch(m){this.log_("Failed to get token: "+m),a||(this.repoInfo_.nodeAdmin&&Ze(m),u())}}})}interrupt(t){Ke("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Ke("Resuming connection for reason: "+t),delete this.interruptReasons_[t],al(this.interruptReasons_)&&(this.reconnectDelay_=fo,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let r;i?r=i.map(o=>Kd(o)).join("$"):r="default";let s=this.removeListen_(t,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,i){let r=new ce(t).toString(),s;if(this.listens.has(r)){let o=this.listens.get(r);s=o.get(i),o.delete(i),o.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(t,i){Ke("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Gy&&(this.reconnectDelay_=jy,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){Ke("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Gy&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";Qt()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+jd.replace(/\./g,"-")]=1,gh()?t["framework.cordova"]=1:iy()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=vl.getInstance().currentlyOnline();return al(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),te=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var Cr=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new te($n,e),r=new te($n,t);return this.compare(i,r)!==0}minPost(){return te.MIN}};var fl,wl=class extends Cr{static get __EMPTY_NODE(){return fl}static set __EMPTY_NODE(e){fl=e}compare(e,t){return Di(e.name,t.name)}isDefinedOn(e){throw _r("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return te.MIN}maxPost(){return new te(wn,fl)}makePost(e,t){return O(typeof e=="string","KeyIndex indexValue must always be a string."),new te(e,fl)}toString(){return".key"}},Yt=new wl;var Ir=class{constructor(e,t,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Ft=(()=>{class n{constructor(t,i,r,s,o){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??bt.EMPTY_NODE,this.right=o??bt.EMPTY_NODE}copy(t,i,r,s,o){return new n(t??this.key,i??this.value,r??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this,o=r(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,i,r),null):o===0?s=s.copy(null,i,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return bt.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let r,s;if(r=this,i(t,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(t,i),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),i(t,r.key)===0){if(r.right.isEmpty())return bt.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(t,i))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Jh=class{copy(e,t,i,r,s){return this}insert(e,t,i){return new Ft(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},bt=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ft.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ft.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,r=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ir(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ir(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ir(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ir(this.root_,null,this.comparator_,!0,e)}};bt.EMPTY_NODE=new Jh;function jC(n,e){return Di(n.name,e.name)}function Hd(n,e){return Di(n,e)}var Xh;function GC(n){Xh=n}var kv=function(n){return typeof n=="number"?"number:"+dv(n):"string:"+n},Nv=function(n){if(n.isLeafNode()){let e=n.val();O(typeof e=="string"||typeof e=="number"||typeof e=="object"&&At(e,".sv"),"Priority must be a string or number.")}else O(n===Xh||n.isEmpty(),"priority of unexpected type.");O(n===Xh||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Ky,Sr=(()=>{class n{constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,O(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Nv(this.priorityNode_)}static set __childrenNodeConstructor(t){Ky=t}static get __childrenNodeConstructor(){return Ky}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ee(t)?this:Z(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let r=Z(t);return r===null?i:i.isEmpty()&&r!==".priority"?this:(O(r!==".priority"||Qn(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(de(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+kv(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=dv(this.value_):t+=this.value_,this.lazyHash_=cv(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(O(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,r=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(r);return O(s>=0,"Unknown leaf type: "+i),O(o>=0,"Unknown leaf type: "+r),s===o?r==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),Dv,Vv;function KC(n){Dv=n}function zC(n){Vv=n}var Zh=class extends Cr{compare(e,t){let i=e.node.getPriority(),r=t.node.getPriority(),s=i.compareTo(r);return s===0?Di(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return te.MIN}maxPost(){return new te(wn,new Sr("[PRIORITY-POST]",Vv))}makePost(e,t){let i=Dv(e);return new te(t,new Sr("[PRIORITY-POST]",i))}toString(){return".priority"}},pe=new Zh;var WC=Math.log(2),ed=class{constructor(e){let t=s=>parseInt(Math.log(s)/WC,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Tl=function(n,e,t,i){n.sort(e);let r=function(c,u){let d=u-c,p,m;if(d===0)return null;if(d===1)return p=n[c],m=t?t(p):p,new Ft(m,p.node,Ft.BLACK,null,null);{let y=parseInt(d/2,10)+c,C=r(c,y),x=r(y+1,u);return p=n[y],m=t?t(p):p,new Ft(m,p.node,Ft.BLACK,C,x)}},s=function(c){let u=null,d=null,p=n.length,m=function(C,x){let N=p-C,q=p;p-=C;let j=r(N+1,q),M=n[N],W=t?t(M):M;y(new Ft(W,M.node,x,null,j))},y=function(C){u?(u.left=C,u=C):(d=C,u=C)};for(let C=0;C<c.count;++C){let x=c.nextBitIsOne(),N=Math.pow(2,c.count-(C+1));x?m(N,Ft.BLACK):(m(N,Ft.BLACK),m(N,Ft.RED))}return d},o=new ed(n.length),a=s(o);return new bt(i||e,a)};var Vh,Tr={},br=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return O(Tr&&pe,"ChildrenNode.ts has not been loaded"),Vh=Vh||new n({".priority":Tr},{".priority":pe}),Vh}get(e){let t=Un(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof bt?t:null}hasIndex(e){return At(this.indexSet_,e.toString())}addIndex(e,t){O(e!==Yt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(te.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=Tl(i,e.getCompare()):a=Tr;let c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;let d=Object.assign({},this.indexes_);return d[c]=a,new n(d,u)}addToIndexes(e,t){let i=eo(this.indexes_,(r,s)=>{let o=Un(this.indexSet_,s);if(O(o,"Missing index implementation for "+s),r===Tr)if(o.isDefinedOn(e.node)){let a=[],c=t.getIterator(te.Wrap),u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),Tl(a,o.getCompare())}else return Tr;else{let a=t.get(e.name),c=r;return a&&(c=c.remove(new te(e.name,a))),c.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=eo(this.indexes_,r=>{if(r===Tr)return r;{let s=t.get(e.name);return s?r.remove(new te(e.name,s)):r}});return new n(i,this.indexSet_)}};var po,J=(()=>{class n{constructor(t,i,r){this.children_=t,this.priorityNode_=i,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Nv(this.priorityNode_),this.children_.isEmpty()&&O(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return po||(po=new n(new bt(Hd),null,br.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||po}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?po:i}}getChild(t){let i=Z(t);return i===null?this:this.getImmediateChild(i).getChild(de(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(O(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let r=new te(t,i),s,o;i.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(r,this.children_));let a=s.isEmpty()?po:this.priorityNode_;return new n(s,a,o)}}updateChild(t,i){let r=Z(t);if(r===null)return i;{O(Z(t)!==".priority"||Qn(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(r).updateChild(de(t),i);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},r=0,s=0,o=!0;if(this.forEachChild(pe,(a,c)=>{i[a]=c.val(t),r++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*r){let a=[];for(let c in i)a[c]=i[c];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+kv(this.getPriority().val())+":"),this.forEachChild(pe,(i,r)=>{let s=r.hash();s!==""&&(t+=":"+i+":"+s)}),this.lazyHash_=t===""?"":cv(t)}return this.lazyHash_}getPredecessorChildName(t,i,r){let s=this.resolveIndex_(r);if(s){let o=s.getPredecessorKey(new te(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new te(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new te(i,this.children_.get(i)):null}forEachChild(t,i){let r=this.resolveIndex_(t);return r?r.inorderTraversal(s=>i(s.name,s.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Fo?-1:0}withIndex(t){if(t===Yt||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===Yt||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let r=this.getIterator(pe),s=i.getIterator(pe),o=r.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=r.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Yt?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),td=class extends J{constructor(){super(new bt(Hd),J.EMPTY_NODE,br.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return J.EMPTY_NODE}isEmpty(){return!1}},Fo=new td;Object.defineProperties(te,{MIN:{value:new te($n,J.EMPTY_NODE)},MAX:{value:new te(wn,Fo)}});wl.__EMPTY_NODE=J.EMPTY_NODE;Sr.__childrenNodeConstructor=J;GC(Fo);zC(Fo);var $C=!0;function we(n,e=null){if(n===null)return J.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),O(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Sr(t,we(e))}if(!(n instanceof Array)&&$C){let t=[],i=!1;if(ze(n,(o,a)=>{if(o.substring(0,1)!=="."){let c=we(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new te(o,c)))}}),t.length===0)return J.EMPTY_NODE;let s=Tl(t,jC,o=>o.name,Hd);if(i){let o=Tl(t,pe.getCompare());return new J(s,we(e),new br({".priority":o},{".priority":pe}))}else return new J(s,we(e),br.Default)}else{let t=J.EMPTY_NODE;return ze(n,(i,r)=>{if(At(n,i)&&i.substring(0,1)!=="."){let s=we(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(i,s))}}),t.updatePriority(we(e))}}KC(we);var Io=class extends Cr{constructor(e){super(),this.indexPath_=e,O(!ee(e)&&Z(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),r=this.extractChild(t.node),s=i.compareTo(r);return s===0?Di(e.name,t.name):s}makePost(e,t){let i=we(e),r=J.EMPTY_NODE.updateChild(this.indexPath_,i);return new te(t,r)}maxPost(){let e=J.EMPTY_NODE.updateChild(this.indexPath_,Fo);return new te(wn,e)}toString(){return Eo(this.indexPath_,0).join("/")}};var nd=class extends Cr{compare(e,t){let i=e.node.compareTo(t.node);return i===0?Di(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return te.MIN}maxPost(){return te.MAX}makePost(e,t){let i=we(e);return new te(t,i)}toString(){return".value"}},Yd=new nd;function Ov(n){return{type:"value",snapshotNode:n}}function Rr(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Ao(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Co(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function QC(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var So=class{constructor(e){this.index_=e}updateChild(e,t,i,r,s,o){O(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(Ao(t,a)):O(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Rr(t,i)):o.trackChildChange(Co(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(pe,(r,s)=>{t.hasChild(r)||i.trackChildChange(Ao(r,s))}),t.isLeafNode()||t.forEachChild(pe,(r,s)=>{if(e.hasChild(r)){let o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(Co(r,s,o))}else i.trackChildChange(Rr(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?J.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var El=class n{constructor(e){this.indexedFilter_=new So(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,r,s,o){return this.matches(new te(t,i))||(i=J.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,r,s,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=J.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(J.EMPTY_NODE);let s=this;return t.forEachChild(pe,(o,a)=>{s.matches(new te(o,a))||(r=r.updateImmediateChild(o,J.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var id=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new El(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,r,s,o){return this.rangedFilter_.matches(new te(t,i))||(i=J.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,r,s,o):this.fullLimitUpdateChild_(e,t,i,s,o)}updateFullNode(e,t,i){let r;if(t.isLeafNode()||t.isEmpty())r=J.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=J.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(J.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,J.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,r,s){let o;if(this.reverse_){let p=this.index_.getCompare();o=(m,y)=>p(y,m)}else o=this.index_.getCompare();let a=e;O(a.numChildren()===this.limit_,"");let c=new te(t,i),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(a.hasChild(t)){let p=a.getImmediateChild(t),m=r.getChildAfterChild(this.index_,u,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=r.getChildAfterChild(this.index_,m,this.reverse_);let y=m==null?1:o(m,c);if(d&&!i.isEmpty()&&y>=0)return s?.trackChildChange(Co(t,i,p)),a.updateImmediateChild(t,i);{s?.trackChildChange(Ao(t,p));let x=a.updateImmediateChild(t,J.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(s?.trackChildChange(Rr(m.name,m.node)),x.updateImmediateChild(m.name,m.node)):x}}else return i.isEmpty()?e:d&&o(u,c)>=0?(s!=null&&(s.trackChildChange(Ao(u.name,u.node)),s.trackChildChange(Rr(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(u.name,J.EMPTY_NODE)):e}};var bo=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=pe}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return O(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return O(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:$n}hasEnd(){return this.endSet_}getIndexEndValue(){return O(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return O(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:wn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return O(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===pe}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function HC(n){return n.loadsAllData()?new So(n.getIndex()):n.hasLimit()?new id(n):new El(n)}function YC(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function JC(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function rd(n,e,t){let i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function XC(n,e,t){let i;return n.index_===Yt||t?i=rd(n,e,t):i=rd(n,e,wn),i.startAfterSet_=!0,i}function sd(n,e,t){let i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function ZC(n,e,t){let i;return n.index_===Yt||t?i=sd(n,e,t):i=sd(n,e,$n),i.endBeforeSet_=!0,i}function ql(n,e){let t=n.copy();return t.index_=e,t}function zy(n){let e={};if(n.isDefault())return e;let t;if(n.index_===pe?t="$priority":n.index_===Yd?t="$value":n.index_===Yt?t="$key":(O(n.index_ instanceof Io,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=De(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=De(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+De(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=De(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+De(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Wy(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==pe&&(e.i=n.index_.toString()),e}var od=class n extends _l{constructor(e,t,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=Mo("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(O(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,r){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let c=zy(e._queryParams);this.restRequest_(s+".json",c,(u,d)=>{let p=d;if(u===404&&(p=null,u=null),u===null&&this.onDataUpdate_(s,p,!1,i),Un(this.listens_,o)===a){let m;u?u===401?m="permission_denied":m="rest_error:"+u:m="ok",r(m,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=zy(e._queryParams),i=e._path.toString(),r=new Ge;return this.restRequest_(i+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ly(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=ol(a.responseText)}catch{Ze("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&Ze("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var ad=class{constructor(){this.rootNode_=J.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Il(){return{value:null,children:new Map}}function Vr(n,e,t){if(ee(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=Z(e);n.children.has(i)||n.children.set(i,Il());let r=n.children.get(i);e=de(e),Vr(r,e,t)}}function ld(n,e){if(ee(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(pe,(i,r)=>{Vr(n,new ce(i),r)}),ld(n,e)}}else if(n.children.size>0){let t=Z(e);return e=de(e),n.children.has(t)&&ld(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function cd(n,e,t){n.value!==null?t(e,n.value):eS(n,(i,r)=>{let s=new ce(e.toString()+"/"+i);cd(r,s,t)})}function eS(n,e){n.children.forEach((t,i)=>{e(i,t)})}var ud=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&ze(this.last_,(i,r)=>{t[i]=t[i]-r}),this.last_=e,t}};var $y=10*1e3,tS=30*1e3,nS=5*60*1e3,hd=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new ud(e);let i=$y+(tS-$y)*Math.random();go(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;ze(e,(r,s)=>{s>0&&At(this.statsToReport_,r)&&(t[r]=s,i=!0)}),i&&this.server_.reportStats(t),go(this.reportStats_.bind(this),Math.floor(Math.random()*2*nS))}};var Ht=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Ht||{});function Jd(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Xd(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Zd(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var dd=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Ht.ACK_USER_WRITE,this.source=Jd()}operationForChild(e){if(ee(this.path)){if(this.affectedTree.value!=null)return O(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new ce(e));return new n(le(),t,this.revert)}}else return O(Z(this.path)===e,"operationForChild called for unrelated child."),new n(de(this.path),this.affectedTree,this.revert)}};var Al=class n{constructor(e,t){this.source=e,this.path=t,this.type=Ht.LISTEN_COMPLETE}operationForChild(e){return ee(this.path)?new n(this.source,le()):new n(this.source,de(this.path))}};var Pr=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Ht.OVERWRITE}operationForChild(e){return ee(this.path)?new n(this.source,le(),this.snap.getImmediateChild(e)):new n(this.source,de(this.path),this.snap)}};var Ro=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Ht.MERGE}operationForChild(e){if(ee(this.path)){let t=this.children.subtree(new ce(e));return t.isEmpty()?null:t.value?new Pr(this.source,le(),t.value):new n(this.source,le(),t)}else return O(Z(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,de(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Xt=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ee(e))return this.isFullyInitialized()&&!this.filtered_;let t=Z(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var fd=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function iS(n,e,t,i){let r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(QC(o.childName,o.snapshotNode))}),mo(n,r,"child_removed",e,i,t),mo(n,r,"child_added",e,i,t),mo(n,r,"child_moved",s,i,t),mo(n,r,"child_changed",e,i,t),mo(n,r,"value",e,i,t),r}function mo(n,e,t,i,r,s){let o=i.filter(a=>a.type===t);o.sort((a,c)=>sS(n,a,c)),o.forEach(a=>{let c=rS(n,a,s);r.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,n.query_))})})}function rS(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function sS(n,e,t){if(e.childName==null||t.childName==null)throw _r("Should only compare child_ events.");let i=new te(e.childName,e.snapshotNode),r=new te(t.childName,t.snapshotNode);return n.index_.compare(i,r)}function jl(n,e){return{eventCache:n,serverCache:e}}function yo(n,e,t,i){return jl(new Xt(e,t,i),n.serverCache)}function Mv(n,e,t,i){return jl(n.eventCache,new Xt(e,t,i))}function Cl(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Ni(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Oh,oS=()=>(Oh||(Oh=new bt(rC)),Oh),ot=class n{constructor(e,t=oS()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return ze(e,(i,r)=>{t=t.set(new ce(i),r)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:le(),value:this.value};if(ee(e))return null;{let i=Z(e),r=this.children.get(i);if(r!==null){let s=r.findRootMostMatchingPathAndValue(de(e),t);return s!=null?{path:ye(new ce(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ee(e))return this;{let t=Z(e),i=this.children.get(t);return i!==null?i.subtree(de(e)):new n(null)}}set(e,t){if(ee(e))return new n(t,this.children);{let i=Z(e),s=(this.children.get(i)||new n(null)).set(de(e),t),o=this.children.insert(i,s);return new n(this.value,o)}}remove(e){if(ee(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=Z(e),i=this.children.get(t);if(i){let r=i.remove(de(e)),s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(ee(e))return this.value;{let t=Z(e),i=this.children.get(t);return i?i.get(de(e)):null}}setTree(e,t){if(ee(e))return t;{let i=Z(e),s=(this.children.get(i)||new n(null)).setTree(de(e),t),o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new n(this.value,o)}}fold(e){return this.fold_(le(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(ye(e,r),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,le(),t)}findOnPath_(e,t,i){let r=this.value?i(t,this.value):!1;if(r)return r;if(ee(e))return null;{let s=Z(e),o=this.children.get(s);return o?o.findOnPath_(de(e),ye(t,s),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,le(),t)}foreachOnPath_(e,t,i){if(ee(e))return this;{this.value&&i(t,this.value);let r=Z(e),s=this.children.get(r);return s?s.foreachOnPath_(de(e),ye(t,r),i):new n(null)}}foreach(e){this.foreach_(le(),e)}foreach_(e,t){this.children.inorderTraversal((i,r)=>{r.foreach_(ye(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var Lt=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new ot(null))}};function vo(n,e,t){if(ee(e))return new Lt(new ot(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let r=i.path,s=i.value,o=st(r,e);return s=s.updateChild(o,t),new Lt(n.writeTree_.set(r,s))}else{let r=new ot(t),s=n.writeTree_.setTree(e,r);return new Lt(s)}}}function pd(n,e,t){let i=n;return ze(t,(r,s)=>{i=vo(i,ye(e,r),s)}),i}function Qy(n,e){if(ee(e))return Lt.empty();{let t=n.writeTree_.setTree(e,new ot(null));return new Lt(t)}}function md(n,e){return Vi(n,e)!=null}function Vi(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(st(t.path,e)):null}function Hy(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(pe,(i,r)=>{e.push(new te(i,r))}):n.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new te(i,r.value))}),e}function zn(n,e){if(ee(e))return n;{let t=Vi(n,e);return t!=null?new Lt(new ot(t)):new Lt(n.writeTree_.subtree(e))}}function gd(n){return n.writeTree_.isEmpty()}function xr(n,e){return Fv(le(),n.writeTree_,e)}function Fv(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(O(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):t=Fv(ye(n,r),s,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(ye(n,".priority"),i)),t}}function Gl(n,e){return qv(e,n)}function aS(n,e,t,i,r){O(i>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:r}),r&&(n.visibleWrites=vo(n.visibleWrites,e,t)),n.lastWriteId=i}function lS(n,e,t,i){O(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=pd(n.visibleWrites,e,t),n.lastWriteId=i}function cS(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function uS(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);O(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let r=i.visible,s=!1,o=n.allWrites.length-1;for(;r&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&hS(a,i.path)?r=!1:St(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return dS(n),!0;if(i.snap)n.visibleWrites=Qy(n.visibleWrites,i.path);else{let a=i.children;ze(a,c=>{n.visibleWrites=Qy(n.visibleWrites,ye(i.path,c))})}return!0}else return!1}function hS(n,e){if(n.snap)return St(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&St(ye(n.path,t),e))return!0;return!1}function dS(n){n.visibleWrites=Lv(n.allWrites,fS,le()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function fS(n){return n.visible}function Lv(n,e,t){let i=Lt.empty();for(let r=0;r<n.length;++r){let s=n[r];if(e(s)){let o=s.path,a;if(s.snap)St(t,o)?(a=st(t,o),i=vo(i,a,s.snap)):St(o,t)&&(a=st(o,t),i=vo(i,le(),s.snap.getChild(a)));else if(s.children){if(St(t,o))a=st(t,o),i=pd(i,a,s.children);else if(St(o,t))if(a=st(o,t),ee(a))i=pd(i,le(),s.children);else{let c=Un(s.children,Z(a));if(c){let u=c.getChild(de(a));i=vo(i,le(),u)}}}else throw _r("WriteRecord should have .snap or .children")}}return i}function Uv(n,e,t,i,r){if(!i&&!r){let s=Vi(n.visibleWrites,e);if(s!=null)return s;{let o=zn(n.visibleWrites,e);if(gd(o))return t;if(t==null&&!md(o,le()))return null;{let a=t||J.EMPTY_NODE;return xr(o,a)}}}else{let s=zn(n.visibleWrites,e);if(!r&&gd(s))return t;if(!r&&t==null&&!md(s,le()))return null;{let o=function(u){return(u.visible||r)&&(!i||!~i.indexOf(u.writeId))&&(St(u.path,e)||St(e,u.path))},a=Lv(n.allWrites,o,e),c=t||J.EMPTY_NODE;return xr(a,c)}}}function pS(n,e,t){let i=J.EMPTY_NODE,r=Vi(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(pe,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(t){let s=zn(n.visibleWrites,e);return t.forEachChild(pe,(o,a)=>{let c=xr(zn(s,new ce(o)),a);i=i.updateImmediateChild(o,c)}),Hy(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let s=zn(n.visibleWrites,e);return Hy(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function mS(n,e,t,i,r){O(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=ye(e,t);if(md(n.visibleWrites,s))return null;{let o=zn(n.visibleWrites,s);return gd(o)?r.getChild(t):xr(o,r.getChild(t))}}function gS(n,e,t,i){let r=ye(e,t),s=Vi(n.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(t)){let o=zn(n.visibleWrites,r);return xr(o,i.getNode().getImmediateChild(t))}else return null}function _S(n,e){return Vi(n.visibleWrites,e)}function yS(n,e,t,i,r,s,o){let a,c=zn(n.visibleWrites,e),u=Vi(c,le());if(u!=null)a=u;else if(t!=null)a=xr(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],p=o.getCompare(),m=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),y=m.getNext();for(;y&&d.length<r;)p(y,i)!==0&&d.push(y),y=m.getNext();return d}else return[]}function vS(){return{visibleWrites:Lt.empty(),allWrites:[],lastWriteId:-1}}function Sl(n,e,t,i){return Uv(n.writeTree,n.treePath,e,t,i)}function ef(n,e){return pS(n.writeTree,n.treePath,e)}function Yy(n,e,t,i){return mS(n.writeTree,n.treePath,e,t,i)}function bl(n,e){return _S(n.writeTree,ye(n.treePath,e))}function wS(n,e,t,i,r,s){return yS(n.writeTree,n.treePath,e,t,i,r,s)}function tf(n,e,t){return gS(n.writeTree,n.treePath,e,t)}function Bv(n,e){return qv(ye(n.treePath,e),n.writeTree)}function qv(n,e){return{treePath:n,writeTree:e}}var _d=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;O(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),O(i!==".priority","Only non-priority child changes can be tracked.");let r=this.changeMap.get(i);if(r){let s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(i,Co(i,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(i,Ao(i,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(i,Rr(i,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(i,Co(i,e.snapshotNode,r.oldSnap));else throw _r("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var yd=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},jv=new yd,Po=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new Xt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return tf(this.writes_,e,i)}}getChildAfterChild(e,t,i){let r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ni(this.viewCache_),s=wS(this.writes_,r,t,1,i,e);return s.length===0?null:s[0]}};function TS(n){return{filter:n}}function ES(n,e){O(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),O(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function IS(n,e,t,i,r){let s=new _d,o,a;if(t.type===Ht.OVERWRITE){let u=t;u.source.fromUser?o=vd(n,e,u.path,u.snap,i,r,s):(O(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!ee(u.path),o=Rl(n,e,u.path,u.snap,i,r,a,s))}else if(t.type===Ht.MERGE){let u=t;u.source.fromUser?o=CS(n,e,u.path,u.children,i,r,s):(O(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=wd(n,e,u.path,u.children,i,r,a,s))}else if(t.type===Ht.ACK_USER_WRITE){let u=t;u.revert?o=RS(n,e,u.path,i,r,s):o=SS(n,e,u.path,u.affectedTree,i,r,s)}else if(t.type===Ht.LISTEN_COMPLETE)o=bS(n,e,t.path,i,s);else throw _r("Unknown operation type: "+t.type);let c=s.getChanges();return AS(e,o,c),{viewCache:o,changes:c}}function AS(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=Cl(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&t.push(Ov(Cl(e)))}}function Gv(n,e,t,i,r,s){let o=e.eventCache;if(bl(i,t)!=null)return e;{let a,c;if(ee(t))if(O(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let u=Ni(e),d=u instanceof J?u:J.EMPTY_NODE,p=ef(i,d);a=n.filter.updateFullNode(e.eventCache.getNode(),p,s)}else{let u=Sl(i,Ni(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{let u=Z(t);if(u===".priority"){O(Qn(t)===1,"Can't have a priority with additional path components");let d=o.getNode();c=e.serverCache.getNode();let p=Yy(i,t,d,c);p!=null?a=n.filter.updatePriority(d,p):a=o.getNode()}else{let d=de(t),p;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();let m=Yy(i,t,o.getNode(),c);m!=null?p=o.getNode().getImmediateChild(u).updateChild(d,m):p=o.getNode().getImmediateChild(u)}else p=tf(i,u,e.serverCache);p!=null?a=n.filter.updateChild(o.getNode(),u,p,d,r,s):a=o.getNode()}}return yo(e,a,o.isFullyInitialized()||ee(t),n.filter.filtersNodes())}}function Rl(n,e,t,i,r,s,o,a){let c=e.serverCache,u,d=o?n.filter:n.filter.getIndexedFilter();if(ee(t))u=d.updateFullNode(c.getNode(),i,null);else if(d.filtersNodes()&&!c.isFiltered()){let y=c.getNode().updateChild(t,i);u=d.updateFullNode(c.getNode(),y,null)}else{let y=Z(t);if(!c.isCompleteForPath(t)&&Qn(t)>1)return e;let C=de(t),N=c.getNode().getImmediateChild(y).updateChild(C,i);y===".priority"?u=d.updatePriority(c.getNode(),N):u=d.updateChild(c.getNode(),y,N,C,jv,null)}let p=Mv(e,u,c.isFullyInitialized()||ee(t),d.filtersNodes()),m=new Po(r,p,s);return Gv(n,p,t,r,m,a)}function vd(n,e,t,i,r,s,o){let a=e.eventCache,c,u,d=new Po(r,e,s);if(ee(t))u=n.filter.updateFullNode(e.eventCache.getNode(),i,o),c=yo(e,u,!0,n.filter.filtersNodes());else{let p=Z(t);if(p===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),i),c=yo(e,u,a.isFullyInitialized(),a.isFiltered());else{let m=de(t),y=a.getNode().getImmediateChild(p),C;if(ee(m))C=i;else{let x=d.getCompleteChild(p);x!=null?Wd(m)===".priority"&&x.getChild(Pv(m)).isEmpty()?C=x:C=x.updateChild(m,i):C=J.EMPTY_NODE}if(y.equals(C))c=e;else{let x=n.filter.updateChild(a.getNode(),p,C,m,d,o);c=yo(e,x,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function Jy(n,e){return n.eventCache.isCompleteForChild(e)}function CS(n,e,t,i,r,s,o){let a=e;return i.foreach((c,u)=>{let d=ye(t,c);Jy(e,Z(d))&&(a=vd(n,a,d,u,r,s,o))}),i.foreach((c,u)=>{let d=ye(t,c);Jy(e,Z(d))||(a=vd(n,a,d,u,r,s,o))}),a}function Xy(n,e,t){return t.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function wd(n,e,t,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;ee(t)?u=i:u=new ot(null).setTree(t,i);let d=e.serverCache.getNode();return u.children.inorderTraversal((p,m)=>{if(d.hasChild(p)){let y=e.serverCache.getNode().getImmediateChild(p),C=Xy(n,y,m);c=Rl(n,c,new ce(p),C,r,s,o,a)}}),u.children.inorderTraversal((p,m)=>{let y=!e.serverCache.isCompleteForChild(p)&&m.value===null;if(!d.hasChild(p)&&!y){let C=e.serverCache.getNode().getImmediateChild(p),x=Xy(n,C,m);c=Rl(n,c,new ce(p),x,r,s,o,a)}}),c}function SS(n,e,t,i,r,s,o){if(bl(r,t)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if(ee(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return Rl(n,e,t,c.getNode().getChild(t),r,s,a,o);if(ee(t)){let u=new ot(null);return c.getNode().forEachChild(Yt,(d,p)=>{u=u.set(new ce(d),p)}),wd(n,e,t,u,r,s,a,o)}else return e}else{let u=new ot(null);return i.foreach((d,p)=>{let m=ye(t,d);c.isCompleteForPath(m)&&(u=u.set(d,c.getNode().getChild(m)))}),wd(n,e,t,u,r,s,a,o)}}function bS(n,e,t,i,r){let s=e.serverCache,o=Mv(e,s.getNode(),s.isFullyInitialized()||ee(t),s.isFiltered());return Gv(n,o,t,i,jv,r)}function RS(n,e,t,i,r,s){let o;if(bl(i,t)!=null)return e;{let a=new Po(i,e,r),c=e.eventCache.getNode(),u;if(ee(t)||Z(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=Sl(i,Ni(e));else{let p=e.serverCache.getNode();O(p instanceof J,"serverChildren would be complete if leaf node"),d=ef(i,p)}d=d,u=n.filter.updateFullNode(c,d,s)}else{let d=Z(t),p=tf(i,d,e.serverCache);p==null&&e.serverCache.isCompleteForChild(d)&&(p=c.getImmediateChild(d)),p!=null?u=n.filter.updateChild(c,d,p,de(t),a,s):e.eventCache.getNode().hasChild(d)?u=n.filter.updateChild(c,d,J.EMPTY_NODE,de(t),a,s):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Sl(i,Ni(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,s)))}return o=e.serverCache.isFullyInitialized()||bl(i,le())!=null,yo(e,u,o,n.filter.filtersNodes())}}var Td=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,r=new So(i.getIndex()),s=HC(i);this.processor_=TS(s);let o=t.serverCache,a=t.eventCache,c=r.updateFullNode(J.EMPTY_NODE,o.getNode(),null),u=s.updateFullNode(J.EMPTY_NODE,a.getNode(),null),d=new Xt(c,o.isFullyInitialized(),r.filtersNodes()),p=new Xt(u,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=jl(p,d),this.eventGenerator_=new fd(this.query_)}get query(){return this.query_}};function PS(n){return n.viewCache_.serverCache.getNode()}function xS(n){return Cl(n.viewCache_)}function kS(n,e){let t=Ni(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ee(e)&&!t.getImmediateChild(Z(e)).isEmpty())?t.getChild(e):null}function Zy(n){return n.eventRegistrations_.length===0}function NS(n,e){n.eventRegistrations_.push(e)}function ev(n,e,t){let i=[];if(t){O(e==null,"A cancel should cancel all event registrations.");let r=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return i}function tv(n,e,t,i){e.type===Ht.MERGE&&e.source.queryId!==null&&(O(Ni(n.viewCache_),"We should always have a full cache before handling merges"),O(Cl(n.viewCache_),"Missing event cache, even though we have a server cache"));let r=n.viewCache_,s=IS(n.processor_,r,e,t,i);return ES(n.processor_,s.viewCache),O(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,Kv(n,s.changes,s.viewCache.eventCache.getNode(),null)}function DS(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(pe,(s,o)=>{i.push(Rr(s,o))}),t.isFullyInitialized()&&i.push(Ov(t.getNode())),Kv(n,i,t.getNode(),e)}function Kv(n,e,t,i){let r=i?[i]:n.eventRegistrations_;return iS(n.eventGenerator_,e,t,r)}var Pl,xl=class{constructor(){this.views=new Map}};function VS(n){O(!Pl,"__referenceConstructor has already been defined"),Pl=n}function OS(){return O(Pl,"Reference.ts has not been loaded"),Pl}function MS(n){return n.views.size===0}function nf(n,e,t,i){let r=e.source.queryId;if(r!==null){let s=n.views.get(r);return O(s!=null,"SyncTree gave us an op for an invalid query."),tv(s,e,t,i)}else{let s=[];for(let o of n.views.values())s=s.concat(tv(o,e,t,i));return s}}function zv(n,e,t,i,r){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=Sl(t,r?i:null),c=!1;a?c=!0:i instanceof J?(a=ef(t,i),c=!1):(a=J.EMPTY_NODE,c=!1);let u=jl(new Xt(a,c,!1),new Xt(i,r,!1));return new Td(e,u)}return o}function FS(n,e,t,i,r,s){let o=zv(n,e,i,r,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),NS(o,t),DS(o,t)}function LS(n,e,t,i){let r=e._queryIdentifier,s=[],o=[],a=Hn(n);if(r==="default")for(let[c,u]of n.views.entries())o=o.concat(ev(u,t,i)),Zy(u)&&(n.views.delete(c),u.query._queryParams.loadsAllData()||s.push(u.query));else{let c=n.views.get(r);c&&(o=o.concat(ev(c,t,i)),Zy(c)&&(n.views.delete(r),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!Hn(n)&&s.push(new(OS())(e._repo,e._path)),{removed:s,events:o}}function Wv(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Wn(n,e){let t=null;for(let i of n.views.values())t=t||kS(i,e);return t}function $v(n,e){if(e._queryParams.loadsAllData())return Kl(n);{let i=e._queryIdentifier;return n.views.get(i)}}function Qv(n,e){return $v(n,e)!=null}function Hn(n){return Kl(n)!=null}function Kl(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var kl;function US(n){O(!kl,"__referenceConstructor has already been defined"),kl=n}function BS(){return O(kl,"Reference.ts has not been loaded"),kl}var qS=1,Nl=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ot(null),this.pendingWriteTree_=vS(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function rf(n,e,t,i,r){return aS(n.pendingWriteTree_,e,t,i,r),r?Or(n,new Pr(Jd(),e,t)):[]}function jS(n,e,t,i){lS(n.pendingWriteTree_,e,t,i);let r=ot.fromObject(t);return Or(n,new Ro(Jd(),e,r))}function Kn(n,e,t=!1){let i=cS(n.pendingWriteTree_,e);if(uS(n.pendingWriteTree_,e)){let s=new ot(null);return i.snap!=null?s=s.set(le(),!0):ze(i.children,o=>{s=s.set(new ce(o),!0)}),Or(n,new dd(i.path,s,t))}else return[]}function Lo(n,e,t){return Or(n,new Pr(Xd(),e,t))}function GS(n,e,t){let i=ot.fromObject(t);return Or(n,new Ro(Xd(),e,i))}function KS(n,e){return Or(n,new Al(Xd(),e))}function zS(n,e,t){let i=sf(n,t);if(i){let r=of(i),s=r.path,o=r.queryId,a=st(s,e),c=new Al(Zd(o),a);return af(n,s,c)}else return[]}function Dl(n,e,t,i,r=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||Qv(o,e))){let c=LS(o,e,t,i);MS(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let u=c.removed;if(a=c.events,!r){let d=u.findIndex(m=>m._queryParams.loadsAllData())!==-1,p=n.syncPointTree_.findOnPath(s,(m,y)=>Hn(y));if(d&&!p){let m=n.syncPointTree_.subtree(s);if(!m.isEmpty()){let y=QS(m);for(let C=0;C<y.length;++C){let x=y[C],N=x.query,q=Xv(n,x);n.listenProvider_.startListening(wo(N),xo(n,N),q.hashFn,q.onComplete)}}}!p&&u.length>0&&!i&&(d?n.listenProvider_.stopListening(wo(e),null):u.forEach(m=>{let y=n.queryToTagMap.get(Wl(m));n.listenProvider_.stopListening(wo(m),y)}))}HS(n,u)}return a}function Hv(n,e,t,i){let r=sf(n,i);if(r!=null){let s=of(r),o=s.path,a=s.queryId,c=st(o,e),u=new Pr(Zd(a),c,t);return af(n,o,u)}else return[]}function WS(n,e,t,i){let r=sf(n,i);if(r){let s=of(r),o=s.path,a=s.queryId,c=st(o,e),u=ot.fromObject(t),d=new Ro(Zd(a),c,u);return af(n,o,d)}else return[]}function Ed(n,e,t,i=!1){let r=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(r,(m,y)=>{let C=st(m,r);s=s||Wn(y,C),o=o||Hn(y)});let a=n.syncPointTree_.get(r);a?(o=o||Hn(a),s=s||Wn(a,le())):(a=new xl,n.syncPointTree_=n.syncPointTree_.set(r,a));let c;s!=null?c=!0:(c=!1,s=J.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((y,C)=>{let x=Wn(C,le());x&&(s=s.updateImmediateChild(y,x))}));let u=Qv(a,e);if(!u&&!e._queryParams.loadsAllData()){let m=Wl(e);O(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");let y=YS();n.queryToTagMap.set(m,y),n.tagToQueryMap.set(y,m)}let d=Gl(n.pendingWriteTree_,r),p=FS(a,e,t,d,s,c);if(!u&&!o&&!i){let m=$v(a,e);p=p.concat(JS(n,e,m))}return p}function zl(n,e,t){let r=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let c=st(o,e),u=Wn(a,c);if(u)return u});return Uv(r,e,s,t,!0)}function $S(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(u,d)=>{let p=st(u,t);i=i||Wn(d,p)});let r=n.syncPointTree_.get(t);r?i=i||Wn(r,le()):(r=new xl,n.syncPointTree_=n.syncPointTree_.set(t,r));let s=i!=null,o=s?new Xt(i,!0,!1):null,a=Gl(n.pendingWriteTree_,e._path),c=zv(r,e,a,s?o.getNode():J.EMPTY_NODE,s);return xS(c)}function Or(n,e){return Yv(e,n.syncPointTree_,null,Gl(n.pendingWriteTree_,le()))}function Yv(n,e,t,i){if(ee(n.path))return Jv(n,e,t,i);{let r=e.get(le());t==null&&r!=null&&(t=Wn(r,le()));let s=[],o=Z(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){let u=t?t.getImmediateChild(o):null,d=Bv(i,o);s=s.concat(Yv(a,c,u,d))}return r&&(s=s.concat(nf(r,n,i,t))),s}}function Jv(n,e,t,i){let r=e.get(le());t==null&&r!=null&&(t=Wn(r,le()));let s=[];return e.children.inorderTraversal((o,a)=>{let c=t?t.getImmediateChild(o):null,u=Bv(i,o),d=n.operationForChild(o);d&&(s=s.concat(Jv(d,a,c,u)))}),r&&(s=s.concat(nf(r,n,i,t))),s}function Xv(n,e){let t=e.query,i=xo(n,t);return{hashFn:()=>(PS(e)||J.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?zS(n,t._path,i):KS(n,t._path);{let s=aC(r,t);return Dl(n,t,null,s)}}}}function xo(n,e){let t=Wl(e);return n.queryToTagMap.get(t)}function Wl(n){return n._path.toString()+"$"+n._queryIdentifier}function sf(n,e){return n.tagToQueryMap.get(e)}function of(n){let e=n.indexOf("$");return O(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ce(n.substr(0,e))}}function af(n,e,t){let i=n.syncPointTree_.get(e);O(i,"Missing sync point for query tag that we're tracking");let r=Gl(n.pendingWriteTree_,e);return nf(i,t,r,null)}function QS(n){return n.fold((e,t,i)=>{if(t&&Hn(t))return[Kl(t)];{let r=[];return t&&(r=Wv(t)),ze(i,(s,o)=>{r=r.concat(o)}),r}})}function wo(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(BS())(n._repo,n._path):n}function HS(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let r=Wl(i),s=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(s)}}}function YS(){return qS++}function JS(n,e,t){let i=e._path,r=xo(n,e),s=Xv(n,t),o=n.listenProvider_.startListening(wo(e),r,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(i);if(r)O(!Hn(a.value),"If we're adding a query, it shouldn't be shadowed");else{let c=a.fold((u,d,p)=>{if(!ee(u)&&d&&Hn(d))return[Kl(d).query];{let m=[];return d&&(m=m.concat(Wv(d).map(y=>y.query))),ze(p,(y,C)=>{m=m.concat(C)}),m}});for(let u=0;u<c.length;++u){let d=c[u];n.listenProvider_.stopListening(wo(d),xo(n,d))}}return o}var Id=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Ad=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=ye(this.path_,e);return new n(this.syncTree_,t)}node(){return zl(this.syncTree_,this.path_)}},XS=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},nv=function(n,e,t){if(!n||typeof n!="object")return n;if(O(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return ZS(n[".sv"],e,t);if(typeof n[".sv"]=="object")return eb(n[".sv"],e);O(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},ZS=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:O(!1,"Unexpected server value: "+n)}},eb=function(n,e,t){n.hasOwnProperty("increment")||O(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&O(!1,"Unexpected increment value: "+i);let r=e.node();if(O(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let o=r.getValue();return typeof o!="number"?i:o+i},Zv=function(n,e,t,i){return cf(e,new Ad(t,n),i)},lf=function(n,e,t){return cf(n,new Id(e),t)};function cf(n,e,t){let i=n.getPriority().val(),r=nv(i,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=nv(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new Sr(a,we(r)):n}else{let o=n;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new Sr(r))),o.forEachChild(pe,(a,c)=>{let u=cf(c,e.getImmediateChild(a),t);u!==c&&(s=s.updateImmediateChild(a,u))}),s}}var ko=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function $l(n,e){let t=e instanceof ce?e:new ce(e),i=n,r=Z(t);for(;r!==null;){let s=Un(i.node.children,r)||{children:{},childCount:0};i=new ko(r,i,s),t=de(t),r=Z(t)}return i}function Oi(n){return n.node.value}function uf(n,e){n.node.value=e,Cd(n)}function ew(n){return n.node.childCount>0}function tb(n){return Oi(n)===void 0&&!ew(n)}function Ql(n,e){ze(n.node.children,(t,i)=>{e(new ko(t,n,i))})}function tw(n,e,t,i){t&&!i&&e(n),Ql(n,r=>{tw(r,e,!0,i)}),t&&i&&e(n)}function nb(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function Uo(n){return new ce(n.parent===null?n.name:Uo(n.parent)+"/"+n.name)}function Cd(n){n.parent!==null&&ib(n.parent,n.name,n)}function ib(n,e,t){let i=tb(t),r=At(n.node.children,e);i&&r?(delete n.node.children[e],n.node.childCount--,Cd(n)):!i&&!r&&(n.node.children[e]=t.node,n.node.childCount++,Cd(n))}var rb=/[\[\].#$\/\u0000-\u001F\u007F]/,sb=/[\[\].#$\u0000-\u001F\u007F]/,Mh=10*1024*1024,Hl=function(n){return typeof n=="string"&&n.length!==0&&!rb.test(n)},nw=function(n){return typeof n=="string"&&n.length!==0&&!sb.test(n)},ob=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),nw(n)},No=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Bl(n)||n&&typeof n=="object"&&At(n,".sv")},Zt=function(n,e,t,i){i&&e===void 0||Bo(dt(n,"value"),e,t)},Bo=function(n,e,t){let i=t instanceof ce?new Hh(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Pi(i));if(typeof e=="function")throw new Error(n+"contains a function "+Pi(i)+" with contents = "+e.toString());if(Bl(e))throw new Error(n+"contains "+e.toString()+" "+Pi(i));if(typeof e=="string"&&e.length>Mh/3&&to(e)>Mh)throw new Error(n+"contains a string greater than "+Mh+" utf8 bytes "+Pi(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(ze(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Hl(o)))throw new Error(n+" contains an invalid key ("+o+") "+Pi(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);MC(i,o),Bo(n,a,i),FC(i)}),r&&s)throw new Error(n+' contains ".value" child '+Pi(i)+" in addition to actual children.")}},ab=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];let s=Eo(i);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Hl(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(OC);let r=null;for(t=0;t<e.length;t++){if(i=e[t],r!==null&&St(r,i))throw new Error(n+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},iw=function(n,e,t,i){if(i&&e===void 0)return;let r=dt(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");let s=[];ze(e,(o,a)=>{let c=new ce(o);if(Bo(r,a,ye(t,c)),Wd(c)===".priority"&&!No(a))throw new Error(r+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(c)}),ab(r,s)},hf=function(n,e,t){if(!(t&&e===void 0)){if(Bl(e))throw new Error(dt(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!No(e))throw new Error(dt(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},qo=function(n,e,t,i){if(!(i&&t===void 0)&&!Hl(t))throw new Error(dt(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Mr=function(n,e,t,i){if(!(i&&t===void 0)&&!nw(t))throw new Error(dt(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},lb=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Mr(n,e,t,i)},yt=function(n,e){if(Z(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},rw=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Hl(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!ob(t))throw new Error(dt(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Sd=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Yl(n,e){let t=null;for(let i=0;i<e.length;i++){let r=e[i],s=r.getPath();t!==null&&!$d(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&n.eventLists_.push(t)}function sw(n,e,t){Yl(n,t),ow(n,i=>$d(i,e))}function vt(n,e,t){Yl(n,t),ow(n,i=>St(i,e)||St(e,i))}function ow(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let r=n.eventLists_[i];if(r){let s=r.path;e(s)?(cb(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function cb(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();ki&&Ke("event: "+t.toString()),Dr(i)}}}var aw="repo_interrupt",ub=25,bd=class{constructor(e,t,i,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Sd,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Il(),this.transactionQueueTree_=new ko,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function hb(n,e,t){if(n.stats_=zd(n.repoInfo_),n.forceRestClient_||hC())n.server_=new od(n.repoInfo_,(i,r,s,o)=>{iv(n,i,r,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>rv(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{De(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Qd(n.repoInfo_,e,(i,r,s,o)=>{iv(n,i,r,s,o)},i=>{rv(n,i)},i=>{db(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=fC(n.repoInfo_,()=>new hd(n.stats_,n.server_)),n.infoData_=new ad,n.infoSyncTree_=new Nl({startListening:(i,r,s,o)=>{let a=[],c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=Lo(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),df(n,"connected",!1),n.serverSyncTree_=new Nl({startListening:(i,r,s,o)=>(n.server_.listen(i,s,r,(a,c)=>{let u=o(a,c);vt(n.eventQueue_,i._path,u)}),[]),stopListening:(i,r)=>{n.server_.unlisten(i,r)}})}function lw(n){let t=n.infoData_.getNode(new ce(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function jo(n){return XS({timestamp:lw(n)})}function iv(n,e,t,i,r){n.dataUpdateCount++;let s=new ce(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(i){let c=eo(t,u=>we(u));o=WS(n.serverSyncTree_,s,c,r)}else{let c=we(t);o=Hv(n.serverSyncTree_,s,c,r)}else if(i){let c=eo(t,u=>we(u));o=GS(n.serverSyncTree_,s,c)}else{let c=we(t);o=Lo(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=kr(n,s)),vt(n.eventQueue_,a,o)}function rv(n,e){df(n,"connected",e),e===!1&&mb(n)}function db(n,e){ze(e,(t,i)=>{df(n,t,i)})}function df(n,e,t){let i=new ce("/.info/"+e),r=we(t);n.infoData_.updateSnapshot(i,r);let s=Lo(n.infoSyncTree_,i,r);vt(n.eventQueue_,i,s)}function Jl(n){return n.nextWriteId_++}function fb(n,e,t){let i=$S(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(r=>{let s=we(r).withIndex(e._queryParams.getIndex());Ed(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Lo(n.serverSyncTree_,e._path,s);else{let a=xo(n.serverSyncTree_,e);o=Hv(n.serverSyncTree_,e._path,s,a)}return vt(n.eventQueue_,e._path,o),Dl(n.serverSyncTree_,e,t,null,!0),s},r=>(Fr(n,"get for query "+De(e)+" failed: "+r),Promise.reject(new Error(r))))}function ff(n,e,t,i,r){Fr(n,"set",{path:e.toString(),value:t,priority:i});let s=jo(n),o=we(t,i),a=zl(n.serverSyncTree_,e),c=lf(o,a,s),u=Jl(n),d=rf(n.serverSyncTree_,e,c,u,!0);Yl(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(m,y)=>{let C=m==="ok";C||Ze("set at "+e+" failed: "+m);let x=Kn(n.serverSyncTree_,u,!C);vt(n.eventQueue_,e,x),Yn(n,r,m,y)});let p=mf(n,e);kr(n,p),vt(n.eventQueue_,p,[])}function pb(n,e,t,i){Fr(n,"update",{path:e.toString(),value:t});let r=!0,s=jo(n),o={};if(ze(t,(a,c)=>{r=!1,o[a]=Zv(ye(e,a),we(c),n.serverSyncTree_,s)}),r)Ke("update() called with empty data.  Don't do anything."),Yn(n,i,"ok",void 0);else{let a=Jl(n),c=jS(n.serverSyncTree_,e,o,a);Yl(n.eventQueue_,c),n.server_.merge(e.toString(),t,(u,d)=>{let p=u==="ok";p||Ze("update at "+e+" failed: "+u);let m=Kn(n.serverSyncTree_,a,!p),y=m.length>0?kr(n,e):e;vt(n.eventQueue_,y,m),Yn(n,i,u,d)}),ze(t,u=>{let d=mf(n,ye(e,u));kr(n,d)}),vt(n.eventQueue_,e,[])}}function mb(n){Fr(n,"onDisconnectEvents");let e=jo(n),t=Il();cd(n.onDisconnect_,le(),(r,s)=>{let o=Zv(r,s,n.serverSyncTree_,e);Vr(t,r,o)});let i=[];cd(t,le(),(r,s)=>{i=i.concat(Lo(n.serverSyncTree_,r,s));let o=mf(n,r);kr(n,o)}),n.onDisconnect_=Il(),vt(n.eventQueue_,le(),i)}function gb(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,r)=>{i==="ok"&&ld(n.onDisconnect_,e),Yn(n,t,i,r)})}function sv(n,e,t,i){let r=we(t);n.server_.onDisconnectPut(e.toString(),r.val(!0),(s,o)=>{s==="ok"&&Vr(n.onDisconnect_,e,r),Yn(n,i,s,o)})}function _b(n,e,t,i,r){let s=we(t,i);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&Vr(n.onDisconnect_,e,s),Yn(n,r,o,a)})}function yb(n,e,t,i){if(al(t)){Ke("onDisconnect().update() called with empty data.  Don't do anything."),Yn(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(r,s)=>{r==="ok"&&ze(t,(o,a)=>{let c=we(a);Vr(n.onDisconnect_,ye(e,o),c)}),Yn(n,i,r,s)})}function vb(n,e,t){let i;Z(e._path)===".info"?i=Ed(n.infoSyncTree_,e,t):i=Ed(n.serverSyncTree_,e,t),sw(n.eventQueue_,e._path,i)}function Rd(n,e,t){let i;Z(e._path)===".info"?i=Dl(n.infoSyncTree_,e,t):i=Dl(n.serverSyncTree_,e,t),sw(n.eventQueue_,e._path,i)}function cw(n){n.persistentConnection_&&n.persistentConnection_.interrupt(aw)}function wb(n){n.persistentConnection_&&n.persistentConnection_.resume(aw)}function Fr(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Ke(t,...e)}function Yn(n,e,t,i){e&&Dr(()=>{if(t==="ok")e(null);else{let r=(t||"error").toUpperCase(),s=r;i&&(s+=": "+i);let o=new Error(s);o.code=r,e(o)}})}function Tb(n,e,t,i,r,s){Fr(n,"transaction on "+e);let o={path:e,update:t,onComplete:i,status:null,order:lv(),applyLocally:s,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=pf(n,e,void 0);o.currentInputSnapshot=a;let c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Bo("transaction failed: Data returned ",c,o.path),o.status=0;let u=$l(n.transactionQueueTree_,e),d=Oi(u)||[];d.push(o),uf(u,d);let p;typeof c=="object"&&c!==null&&At(c,".priority")?(p=Un(c,".priority"),O(No(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):p=(zl(n.serverSyncTree_,e)||J.EMPTY_NODE).getPriority().val();let m=jo(n),y=we(c,p),C=lf(y,a,m);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=C,o.currentWriteId=Jl(n);let x=rf(n.serverSyncTree_,e,C,o.currentWriteId,o.applyLocally);vt(n.eventQueue_,e,x),Xl(n,n.transactionQueueTree_)}}function pf(n,e,t){return zl(n.serverSyncTree_,e,t)||J.EMPTY_NODE}function Xl(n,e=n.transactionQueueTree_){if(e||Zl(n,e),Oi(e)){let t=hw(n,e);O(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&Eb(n,Uo(e),t)}else ew(e)&&Ql(e,t=>{Xl(n,t)})}function Eb(n,e,t){let i=t.map(u=>u.currentWriteId),r=pf(n,e,i),s=r,o=r.hash();for(let u=0;u<t.length;u++){let d=t[u];O(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let p=st(e,d.path);s=s.updateChild(p,d.currentOutputSnapshotRaw)}let a=s.val(!0),c=e;n.server_.put(c.toString(),a,u=>{Fr(n,"transaction put response",{path:c.toString(),status:u});let d=[];if(u==="ok"){let p=[];for(let m=0;m<t.length;m++)t[m].status=2,d=d.concat(Kn(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&p.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();Zl(n,$l(n.transactionQueueTree_,e)),Xl(n,n.transactionQueueTree_),vt(n.eventQueue_,e,d);for(let m=0;m<p.length;m++)Dr(p[m])}else{if(u==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{Ze("transaction at "+c.toString()+" failed: "+u);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=u}kr(n,e)}},o)}function kr(n,e){let t=uw(n,e),i=Uo(t),r=hw(n,t);return Ib(n,r,i),i}function Ib(n,e,t){if(e.length===0)return;let i=[],r=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],u=st(t,c.path),d=!1,p;if(O(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,p=c.abortReason,r=r.concat(Kn(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=ub)d=!0,p="maxretry",r=r.concat(Kn(n.serverSyncTree_,c.currentWriteId,!0));else{let m=pf(n,c.path,o);c.currentInputSnapshot=m;let y=e[a].update(m.val());if(y!==void 0){Bo("transaction failed: Data returned ",y,c.path);let C=we(y);typeof y=="object"&&y!=null&&At(y,".priority")||(C=C.updatePriority(m.getPriority()));let N=c.currentWriteId,q=jo(n),j=lf(C,m,q);c.currentOutputSnapshotRaw=C,c.currentOutputSnapshotResolved=j,c.currentWriteId=Jl(n),o.splice(o.indexOf(N),1),r=r.concat(rf(n.serverSyncTree_,c.path,j,c.currentWriteId,c.applyLocally)),r=r.concat(Kn(n.serverSyncTree_,N,!0))}else d=!0,p="nodata",r=r.concat(Kn(n.serverSyncTree_,c.currentWriteId,!0))}vt(n.eventQueue_,t,r),r=[],d&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(p==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(p),!1,null))))}Zl(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Dr(i[a]);Xl(n,n.transactionQueueTree_)}function uw(n,e){let t,i=n.transactionQueueTree_;for(t=Z(e);t!==null&&Oi(i)===void 0;)i=$l(i,t),e=de(e),t=Z(e);return i}function hw(n,e){let t=[];return dw(n,e,t),t.sort((i,r)=>i.order-r.order),t}function dw(n,e,t){let i=Oi(e);if(i)for(let r=0;r<i.length;r++)t.push(i[r]);Ql(e,r=>{dw(n,r,t)})}function Zl(n,e){let t=Oi(e);if(t){let i=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[i]=t[r],i++);t.length=i,uf(e,t.length>0?t:void 0)}Ql(e,i=>{Zl(n,i)})}function mf(n,e){let t=Uo(uw(n,e)),i=$l(n.transactionQueueTree_,e);return nb(i,r=>{Fh(n,r)}),Fh(n,i),tw(i,r=>{Fh(n,r)}),t}function Fh(n,e){let t=Oi(e);if(t){let i=[],r=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(O(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(O(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(Kn(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?uf(e,void 0):t.length=s+1,vt(n.eventQueue_,Uo(e),r);for(let o=0;o<i.length;o++)Dr(i[o])}}function Ab(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let r=t[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function Cb(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Ze(`Invalid query segment '${t}' in query '${n}'`)}return e}var Pd=function(n,e){let t=Sb(n),i=t.namespace;t.domain==="firebase.com"&&Jt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&Jt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||nC();let r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new ml(t.host,t.secure,i,r,e,"",i!==t.subdomain),path:new ce(t.pathString)}},Sb=function(n){let e="",t="",i="",r="",s="",o=!0,a="https",c=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let d=n.indexOf("/");d===-1&&(d=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),e=n.substring(0,Math.min(d,p)),d<p&&(r=Ab(n.substring(d,p)));let m=Cb(n.substring(Math.min(n.length,p)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;let y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{let C=e.indexOf(".");i=e.substring(0,C).toLowerCase(),t=e.substring(C+1),s=i}"ns"in m&&(s=m.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};var ov="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",bb=function(){let n=0,e=[];return function(t){let i=t===n;n=t;let r,s=new Array(8);for(r=7;r>=0;r--)s[r]=ov.charAt(t%64),t=Math.floor(t/64);O(t===0,"Cannot push at time == 0");let o=s.join("");if(i){for(r=11;r>=0&&e[r]===63;r--)e[r]=0;e[r]++}else for(r=0;r<12;r++)e[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)o+=ov.charAt(e[r]);return O(o.length===20,"nextPushId: Length should be 20."),o}}();var Vl=class{constructor(e,t,i,r){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=r}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+De(this.snapshot.exportVal())}},Ol=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Do=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return O(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Ml=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new Ge;return gb(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){yt("OnDisconnect.remove",this._path);let e=new Ge;return sv(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){yt("OnDisconnect.set",this._path),Zt("OnDisconnect.set",e,this._path,!1);let t=new Ge;return sv(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){yt("OnDisconnect.setWithPriority",this._path),Zt("OnDisconnect.setWithPriority",e,this._path,!1),hf("OnDisconnect.setWithPriority",t,!1);let i=new Ge;return _b(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){yt("OnDisconnect.update",this._path),iw("OnDisconnect.update",e,this._path,!1);let t=new Ge;return yb(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var at=class n{constructor(e,t,i,r){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=r}get key(){return ee(this._path)?null:Wd(this._path)}get ref(){return new wt(this._repo,this._path)}get _queryIdentifier(){let e=Wy(this._queryParams),t=Kd(e);return t==="{}"?"default":t}get _queryObject(){return Wy(this._queryParams)}isEqual(e){if(e=ne(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=$d(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+VC(this._path)}};function ec(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Xn(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Yt){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==$n)throw new Error(i);if(typeof e!="string")throw new Error(r)}if(n.hasEnd()){if(n.getIndexEndName()!==wn)throw new Error(i);if(typeof t!="string")throw new Error(r)}}else if(n.getIndex()===pe){if(e!=null&&!No(e)||t!=null&&!No(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(O(n.getIndex()instanceof Io||n.getIndex()===Yd,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function tc(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var wt=class n extends at{constructor(e,t){super(e,t,new bo,!1)}get parent(){let e=Pv(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Nr=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new ce(e),i=Jn(this.ref,e);return new n(this._node.getChild(t),i,pe)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new n(r,Jn(this.ref,i),pe)))}hasChild(e){let t=new ce(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function gf(n,e){return n=ne(n),n._checkNotDeleted("ref"),e!==void 0?Jn(n._root,e):n._root}function _f(n,e){n=ne(n),n._checkNotDeleted("refFromURL");let t=Pd(e,n._repo.repoInfo_.nodeAdmin);rw("refFromURL",t);let i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&Jt("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),gf(n,t.path.toString())}function Jn(n,e){return n=ne(n),Z(n._path)===null?lb("child","path",e,!1):Mr("child","path",e,!1),new wt(n._repo,ye(n._path,e))}function fw(n,e){n=ne(n),yt("push",n._path),Zt("push",e,n._path,!0);let t=lw(n._repo),i=bb(t),r=Jn(n,i),s=Jn(n,i),o;return e!=null?o=nc(s,e).then(()=>s):o=Promise.resolve(s),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function pw(n){return yt("remove",n._path),nc(n,null)}function nc(n,e){n=ne(n),yt("set",n._path),Zt("set",e,n._path,!1);let t=new Ge;return ff(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function mw(n,e){n=ne(n),yt("setPriority",n._path),hf("setPriority",e,!1);let t=new Ge;return ff(n._repo,ye(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function gw(n,e,t){if(yt("setWithPriority",n._path),Zt("setWithPriority",e,n._path,!1),hf("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let i=new Ge;return ff(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function _w(n,e){iw("update",e,n._path,!1);let t=new Ge;return pb(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function yw(n){n=ne(n);let e=new Do(()=>{}),t=new Vo(e);return fb(n._repo,n,t).then(i=>new Nr(i,new wt(n._repo,n._path),n._queryParams.getIndex()))}var Vo=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new Vl("value",this,new Nr(e.snapshotNode,new wt(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Ol(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Fl=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Ol(this,e,t):null}createEvent(e,t){O(e.childName!=null,"Child events should have a childName.");let i=Jn(new wt(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Vl(e.type,this,new Nr(e.snapshotNode,i,r),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function Go(n,e,t,i,r){let s;if(typeof i=="object"&&(s=void 0,r=i),typeof i=="function"&&(s=i),r&&r.onlyOnce){let c=t,u=(d,p)=>{Rd(n._repo,n,a),c(d,p)};u.userCallback=t.userCallback,u.context=t.context,t=u}let o=new Do(t,s||void 0),a=e==="value"?new Vo(o):new Fl(e,o);return vb(n._repo,n,a),()=>Rd(n._repo,n,a)}function ic(n,e,t,i){return Go(n,"value",e,t,i)}function yf(n,e,t,i){return Go(n,"child_added",e,t,i)}function vf(n,e,t,i){return Go(n,"child_changed",e,t,i)}function wf(n,e,t,i){return Go(n,"child_moved",e,t,i)}function Tf(n,e,t,i){return Go(n,"child_removed",e,t,i)}function Ef(n,e,t){let i=null,r=t?new Do(t):null;e==="value"?i=new Vo(r):e&&(i=new Fl(e,r)),Rd(n._repo,n,i)}var Tt=class{},Ll=class extends Tt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Zt("endAt",this._value,e._path,!0);let t=sd(e._queryParams,this._value,this._key);if(tc(t),Xn(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new at(e._repo,e._path,t,e._orderByCalled)}};function vw(n,e){return qo("endAt","key",e,!0),new Ll(n,e)}var xd=class extends Tt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Zt("endBefore",this._value,e._path,!1);let t=ZC(e._queryParams,this._value,this._key);if(tc(t),Xn(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new at(e._repo,e._path,t,e._orderByCalled)}};function ww(n,e){return qo("endBefore","key",e,!0),new xd(n,e)}var Ul=class extends Tt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Zt("startAt",this._value,e._path,!0);let t=rd(e._queryParams,this._value,this._key);if(tc(t),Xn(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new at(e._repo,e._path,t,e._orderByCalled)}};function Tw(n=null,e){return qo("startAt","key",e,!0),new Ul(n,e)}var kd=class extends Tt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Zt("startAfter",this._value,e._path,!1);let t=XC(e._queryParams,this._value,this._key);if(tc(t),Xn(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new at(e._repo,e._path,t,e._orderByCalled)}};function Ew(n,e){return qo("startAfter","key",e,!0),new kd(n,e)}var Nd=class extends Tt{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new at(e._repo,e._path,YC(e._queryParams,this._limit),e._orderByCalled)}};function Iw(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Nd(n)}var Dd=class extends Tt{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new at(e._repo,e._path,JC(e._queryParams,this._limit),e._orderByCalled)}};function Aw(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Dd(n)}var Vd=class extends Tt{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){ec(e,"orderByChild");let t=new ce(this._path);if(ee(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let i=new Io(t),r=ql(e._queryParams,i);return Xn(r),new at(e._repo,e._path,r,!0)}};function Cw(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Mr("orderByChild","path",n,!1),new Vd(n)}var Od=class extends Tt{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){ec(e,"orderByKey");let t=ql(e._queryParams,Yt);return Xn(t),new at(e._repo,e._path,t,!0)}};function Sw(){return new Od}var Md=class extends Tt{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){ec(e,"orderByPriority");let t=ql(e._queryParams,pe);return Xn(t),new at(e._repo,e._path,t,!0)}};function bw(){return new Md}var Fd=class extends Tt{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){ec(e,"orderByValue");let t=ql(e._queryParams,Yd);return Xn(t),new at(e._repo,e._path,t,!0)}};function Rw(){return new Fd}var Ld=class extends Tt{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Zt("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Ll(this._value,this._key)._apply(new Ul(this._value,this._key)._apply(e))}};function Pw(n,e){return qo("equalTo","key",e,!0),new Ld(n,e)}function Rt(n,...e){let t=ne(n);for(let i of e)t=i._apply(t);return t}VS(wt);US(wt);var Rb="FIREBASE_DATABASE_EMULATOR_HOST",Ud={},Pb=!1;function xb(n,e,t,i){n.repoInfo_=new ml(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}function If(n,e,t,i,r){let s=i||n.options.databaseURL;s===void 0&&(n.options.projectId||Jt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ke("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Pd(s,r),a=o.repoInfo,c,u;typeof process<"u"&&process.env&&(u=process.env[Rb]),u?(c=!0,s=`http://${u}?ns=${a.namespace}`,o=Pd(s,r),a=o.repoInfo):c=!o.repoInfo.secure;let d=r&&c?new _o(_o.OWNER):new Gh(n.name,n.options,e);rw("Invalid Firebase Database URL",o),ee(o.path)||Jt("Database URL must point to the root of a Firebase Database (not including a child path).");let p=Nb(a,n,d,new jh(n.name,t));return new Bd(p,n)}function kb(n,e){let t=Ud[e];(!t||t[n.key]!==n)&&Jt(`Database ${e}(${n.repoInfo_}) has already been deleted.`),cw(n),delete t[n.key]}function Nb(n,e,t,i){let r=Ud[e.name];r||(r={},Ud[e.name]=r);let s=r[n.toURLString()];return s&&Jt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new bd(n,Pb,t,i),r[n.toURLString()]=s,s}var Bd=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(hb(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new wt(this._repo,le())),this._rootInternal}_delete(){return this._rootInternal!==null&&(kb(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Jt("Cannot call "+e+" on a deleted database.")}};function xw(){Rv.IS_TRANSPORT_INITIALIZED&&Ze("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function kw(){xw(),To.forceDisallow()}function Nw(){xw(),Er.forceDisallow(),To.forceAllow()}function Dw(n,e,t,i={}){n=ne(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Jt("Cannot call useEmulator() after instance has already been initialized.");let r=n._repoInternal,s;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&Jt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new _o(_o.OWNER);else if(i.mockUserToken){let o=typeof i.mockUserToken=="string"?i.mockUserToken:rl(i.mockUserToken,n.app.options.projectId);s=new _o(o)}xb(r,e,t,s)}function Vw(n){n=ne(n),n._checkNotDeleted("goOffline"),cw(n._repo)}function Ow(n){n=ne(n),n._checkNotDeleted("goOnline"),wb(n._repo)}function Mw(n,e){uv(n,e)}function Db(n){Gd(cl),bi(new _t("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return If(i,r,s,t)},"PUBLIC").setMultipleInstances(!0)),Ot(Py,xy,n),Ot(Py,xy,"esm2017")}var Vb={".sv":"timestamp"};function Fw(){return Vb}function Lw(n){return{".sv":{increment:n}}}var qd=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function Uw(n,e,t){var i;if(n=ne(n),yt("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let r=(i=t?.applyLocally)!==null&&i!==void 0?i:!0,s=new Ge,o=(c,u,d)=>{let p=null;c?s.reject(c):(p=new Nr(d,new wt(n._repo,n._path),pe),s.resolve(new qd(u,p)))},a=ic(n,()=>{});return Tb(n._repo,n._path,e,o,a,r),s.promise}Qd.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Qd.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Db();var Ob="@firebase/database-compat",Mb="1.0.8";var Fb=new Bn("@firebase/database-compat"),Bw=function(n){let e="FIREBASE WARNING: "+n;Fb.warn(e)};var Lb=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error(dt(n,e)+"must be a boolean.")},Ub=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(dt(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var Af=class{constructor(e){this._delegate=e}cancel(e){$("OnDisconnect.cancel",0,1,arguments.length),Ue("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){$("OnDisconnect.remove",0,1,arguments.length),Ue("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){$("OnDisconnect.set",1,2,arguments.length),Ue("OnDisconnect.set","onComplete",t,!0);let i=this._delegate.set(e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){$("OnDisconnect.setWithPriority",2,3,arguments.length),Ue("OnDisconnect.setWithPriority","onComplete",i,!0);let r=this._delegate.setWithPriority(e,t);return i&&r.then(()=>i(null),s=>i(s)),r}update(e,t){if($("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,Bw("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ue("OnDisconnect.update","onComplete",t,!0);let i=this._delegate.update(e);return t&&i.then(()=>t(null),r=>t(r)),i}};var Cf=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return $("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var Mi=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return $("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return $("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return $("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return $("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return $("DataSnapshot.child",0,1,arguments.length),e=String(e),Mr("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return $("DataSnapshot.hasChild",1,1,arguments.length),Mr("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return $("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return $("DataSnapshot.forEach",1,1,arguments.length),Ue("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return $("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return $("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return $("DataSnapshot.ref",0,0,arguments.length),new Tn(this._database,this._delegate.ref)}get ref(){return this.getRef()}},rc=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,r){var s;$("Query.on",2,4,arguments.length),Ue("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",i,r),a=(u,d)=>{t.call(o.context,new Mi(this.database,u),d)};a.userCallback=t,a.context=o.context;let c=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return ic(this._delegate,a,c),t;case"child_added":return yf(this._delegate,a,c),t;case"child_removed":return Tf(this._delegate,a,c),t;case"child_changed":return vf(this._delegate,a,c),t;case"child_moved":return wf(this._delegate,a,c),t;default:throw new Error(dt("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if($("Query.off",0,3,arguments.length),Ub("Query.off",e,!0),Ue("Query.off","callback",t,!0),vh("Query.off","context",i,!0),t){let r=()=>{};r.userCallback=t,r.context=i,Ef(this._delegate,e,r)}else Ef(this._delegate,e)}get(){return yw(this._delegate).then(e=>new Mi(this.database,e))}once(e,t,i,r){$("Query.once",1,4,arguments.length),Ue("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",i,r),o=new Ge,a=(u,d)=>{let p=new Mi(this.database,u);t&&t.call(s.context,p,d),o.resolve(p)};a.userCallback=t,a.context=s.context;let c=u=>{s.cancel&&s.cancel.call(s.context,u),o.reject(u)};switch(e){case"value":ic(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":yf(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":Tf(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":vf(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":wf(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error(dt("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return $("Query.limitToFirst",1,1,arguments.length),new n(this.database,Rt(this._delegate,Iw(e)))}limitToLast(e){return $("Query.limitToLast",1,1,arguments.length),new n(this.database,Rt(this._delegate,Aw(e)))}orderByChild(e){return $("Query.orderByChild",1,1,arguments.length),new n(this.database,Rt(this._delegate,Cw(e)))}orderByKey(){return $("Query.orderByKey",0,0,arguments.length),new n(this.database,Rt(this._delegate,Sw()))}orderByPriority(){return $("Query.orderByPriority",0,0,arguments.length),new n(this.database,Rt(this._delegate,bw()))}orderByValue(){return $("Query.orderByValue",0,0,arguments.length),new n(this.database,Rt(this._delegate,Rw()))}startAt(e=null,t){return $("Query.startAt",0,2,arguments.length),new n(this.database,Rt(this._delegate,Tw(e,t)))}startAfter(e=null,t){return $("Query.startAfter",0,2,arguments.length),new n(this.database,Rt(this._delegate,Ew(e,t)))}endAt(e=null,t){return $("Query.endAt",0,2,arguments.length),new n(this.database,Rt(this._delegate,vw(e,t)))}endBefore(e=null,t){return $("Query.endBefore",0,2,arguments.length),new n(this.database,Rt(this._delegate,ww(e,t)))}equalTo(e,t){return $("Query.equalTo",1,2,arguments.length),new n(this.database,Rt(this._delegate,Pw(e,t)))}toString(){return $("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return $("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if($("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){let r={cancel:void 0,context:void 0};if(t&&i)r.cancel=t,Ue(e,"cancel",r.cancel,!0),r.context=i,vh(e,"context",r.context,!0);else if(t)if(typeof t=="object"&&t!==null)r.context=t;else if(typeof t=="function")r.cancel=t;else throw new Error(dt(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return r}get ref(){return new Tn(this.database,new wt(this._delegate._repo,this._delegate._path))}},Tn=class n extends rc{constructor(e,t){super(e,new at(t._repo,t._path,new bo,!1)),this.database=e,this._delegate=t}getKey(){return $("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return $("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,Jn(this._delegate,e))}getParent(){$("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return $("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){$("Reference.set",1,2,arguments.length),Ue("Reference.set","onComplete",t,!0);let i=nc(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}update(e,t){if($("Reference.update",1,2,arguments.length),Array.isArray(e)){let r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,Bw("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}yt("Reference.update",this._delegate._path),Ue("Reference.update","onComplete",t,!0);let i=_w(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){$("Reference.setWithPriority",2,3,arguments.length),Ue("Reference.setWithPriority","onComplete",i,!0);let r=gw(this._delegate,e,t);return i&&r.then(()=>i(null),s=>i(s)),r}remove(e){$("Reference.remove",0,1,arguments.length),Ue("Reference.remove","onComplete",e,!0);let t=pw(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){$("Reference.transaction",1,3,arguments.length),Ue("Reference.transaction","transactionUpdate",e,!1),Ue("Reference.transaction","onComplete",t,!0),Lb("Reference.transaction","applyLocally",i,!0);let r=Uw(this._delegate,e,{applyLocally:i}).then(s=>new Cf(s.committed,new Mi(this.database,s.snapshot)));return t&&r.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),r}setPriority(e,t){$("Reference.setPriority",1,2,arguments.length),Ue("Reference.setPriority","onComplete",t,!0);let i=mw(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}push(e,t){$("Reference.push",0,2,arguments.length),Ue("Reference.push","onComplete",t,!0);let i=fw(this._delegate,e),r=i.then(o=>new n(this.database,o));t&&r.then(()=>t(null),o=>t(o));let s=new n(this.database,i);return s.then=r.then.bind(r),s.catch=r.catch.bind(r,void 0),s}onDisconnect(){return yt("Reference.onDisconnect",this._delegate._path),new Af(new Ml(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Fi=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:kw,forceLongPolling:Nw}}useEmulator(e,t,i={}){Dw(this._delegate,e,t,i)}ref(e){if($("database.ref",0,1,arguments.length),e instanceof Tn){let t=_f(this._delegate,e.toString());return new Tn(this,t)}else{let t=gf(this._delegate,e);return new Tn(this,t)}}refFromURL(e){$("database.refFromURL",1,1,arguments.length);let i=_f(this._delegate,e);return new Tn(this,i)}goOffline(){return $("database.goOffline",0,0,arguments.length),Vw(this._delegate)}goOnline(){return $("database.goOnline",0,0,arguments.length),Ow(this._delegate)}};Fi.ServerValue={TIMESTAMP:Fw(),increment:n=>Lw(n)};function Bb({app:n,url:e,version:t,customAuthImpl:i,customAppCheckImpl:r,namespace:s,nodeAdmin:o=!1}){Gd(t);let a=new wh("database-standalone"),c=new ll("auth-internal",a);c.setComponent(new _t("auth-internal",()=>i,"PRIVATE"));let u;return r&&(u=new ll("app-check-internal",a),u.setComponent(new _t("app-check-internal",()=>r,"PRIVATE"))),{instance:new Fi(If(n,c,u,e,o),n),namespace:s}}var qb=Object.freeze({__proto__:null,initStandalone:Bb});var jb=Fi.ServerValue;function Gb(n){n.INTERNAL.registerComponent(new _t("database-compat",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new Fi(r,i)},"PUBLIC").setServiceProps({Reference:Tn,Query:rc,Database:Fi,DataSnapshot:Mi,enableLogging:Mw,INTERNAL:qb,ServerValue:jb}).setMultipleInstances(!0)),n.registerVersion(Ob,Mb)}Gb(Be);function Ko(n,e,t="on",i=pr){return new Mn(r=>{let s=null;return s=n[t](e,(o,a)=>{i.schedule(()=>{r.next({snapshot:o,prevKey:a})}),t==="once"&&i.schedule(()=>r.complete())},o=>{i.schedule(()=>r.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(Ce(r=>{let{snapshot:s,prevKey:o}=r,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),j_())}function Kb(n){return typeof n=="string"}function zb(n){return typeof n.exportVal=="function"}function zw(n){return n==null}function Ww(n){return typeof n.set=="function"}function qw(n,e){return Ww(e)?e:n.ref(e)}function $w(n,e){if(Kb(n))return e.stringCase();if(Ww(n))return e.firebaseCase();if(zb(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function Qw(n){return(zw(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function Hw(n,e,t){e=Qw(e);let i=e.map(r=>Ko(n,r,"on",t));return zs(...i)}function Wb(n,e,t){let i=Hw(n,e).pipe(Ai((r,s)=>[...r,s],[]));return Qb(n,i,t)}function $b(n,e){return Ko(n,"value","on",e).pipe(Ce(t=>{let i;return t.payload.forEach(r=>(i=r.key,!1)),{data:t,lastKeyToLoad:i}}))}function Qb(n,e,t){return $b(n,t).pipe(z_(e),Ce(([r,s])=>{let o=r.lastKeyToLoad,a=s.map(c=>c.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),G_(r=>r.loadedKeys.indexOf(r.lastKeyToLoad)===-1),Ce(r=>r.actions))}function jw(n,e){return function(i,r){return $w(i,{stringCase:()=>n.child(i)[e](r),firebaseCase:()=>i[e](r),snapshotCase:()=>i.ref[e](r)})}}function Hb(n){return function(t){return t?$w(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function Yb(n,e,t){return Ko(n,"value","once",t).pipe(pn(i=>{let r=[zt(i)];return e.forEach(s=>r.push(Ko(n,s,"on",t))),zs(...r).pipe(Ai(Xb,[]))}),Ha())}function Yw(n,e){let t=n.length;for(let i=0;i<t;i++)if(n[i].payload.key===e)return i;return-1}function Jb(n,e){if(zw(e))return 0;{let t=Yw(n,e);return t===-1?n.length:t+1}}function Xb(n,e){let{payload:t,prevKey:i,key:r}=e,s=Yw(n,r),o=Jb(n,i);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(c=>{let u={payload:c,type:"value",prevKey:a,key:c.key};return a=c.key,n=[...n,u],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==i&&(n=n.filter(c=>c.payload.key!==t.key),n.splice(o,0,e));else{if(i==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===r?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function Gw(n,e,t){return e=Qw(e),Yb(n,e,t)}function Zb(n,e){let t=e.schedulers.outsideAngular,i=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:jw(i,"update"),set:jw(i,"set"),push:r=>i.push(r),remove:Hb(i),snapshotChanges(r){return Gw(n,r,t).pipe(be)},stateChanges(r){return Hw(n,r,t).pipe(be)},auditTrail(r){return Wb(n,r,t).pipe(be)},valueChanges(r,s){return Gw(n,r,t).pipe(Ce(a=>a.map(c=>s&&s.idField?Dt(Ae({},c.payload.val()),{[s.idField]:c.key}):c.payload.val())),be)}}}function Kw(n,e){return function(){return Ko(n,"value","on",e)}}function eR(n,e){return{query:n,snapshotChanges(){return Kw(n,e.schedulers.outsideAngular)().pipe(be)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return Kw(n,e.schedulers.outsideAngular)().pipe(be,Ce(i=>i.payload.exists()?i.payload.val():null))}}}var tR=new Ne("angularfire2.realtimeDatabaseURL"),nR=new Ne("angularfire2.database.use-emulator"),iR=(()=>{class n{schedulers;database;constructor(t,i,r,s,o,a,c,u,d,p,m,y,C,x,N){this.schedulers=a;let q=c,j=Ri(t,o,i);u&&co(j,o,d,m,y,C,p,x),this.database=wr(`${j.name}.database.${r}`,"AngularFireDatabase",j.name,()=>{let M=o.runOutsideAngular(()=>j.database(r||void 0));return q&&M.useEmulator(...q),M},[q])}list(t,i){let r=this.schedulers.ngZone.runOutsideAngular(()=>qw(this.database,t)),s=r;return i&&(s=i(r)),Zb(s,this)}object(t){let i=this.schedulers.ngZone.runOutsideAngular(()=>qw(this.database,t));return eR(i,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(i){return new(i||n)(K(qn),K(jn,8),K(tR,8),K(Ln),K(mt),K(vr),K(nR,8),K(uo,8),K(io,8),K(ro,8),K(so,8),K(oo,8),K(ao,8),K(lo,8),K(yn,8))};static \u0275prov=ht({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),lN=(()=>{class n{constructor(){Be.registerVersion("angularfire",vn.full,"rtdb-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=$t({type:n});static \u0275inj=Wt({providers:[iR]})}return n})();var Jw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Xw={};var Zn,Sf;(function(){var n;function e(T,_){function w(){}w.prototype=_.prototype,T.D=_.prototype,T.prototype=new w,T.prototype.constructor=T,T.C=function(E,I,S){for(var v=Array(arguments.length-2),hn=2;hn<arguments.length;hn++)v[hn-2]=arguments[hn];return _.prototype[I].apply(E,v)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(T,_,w){w||(w=0);var E=Array(16);if(typeof _=="string")for(var I=0;16>I;++I)E[I]=_.charCodeAt(w++)|_.charCodeAt(w++)<<8|_.charCodeAt(w++)<<16|_.charCodeAt(w++)<<24;else for(I=0;16>I;++I)E[I]=_[w++]|_[w++]<<8|_[w++]<<16|_[w++]<<24;_=T.g[0],w=T.g[1],I=T.g[2];var S=T.g[3],v=_+(S^w&(I^S))+E[0]+3614090360&4294967295;_=w+(v<<7&4294967295|v>>>25),v=S+(I^_&(w^I))+E[1]+3905402710&4294967295,S=_+(v<<12&4294967295|v>>>20),v=I+(w^S&(_^w))+E[2]+606105819&4294967295,I=S+(v<<17&4294967295|v>>>15),v=w+(_^I&(S^_))+E[3]+3250441966&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(S^w&(I^S))+E[4]+4118548399&4294967295,_=w+(v<<7&4294967295|v>>>25),v=S+(I^_&(w^I))+E[5]+1200080426&4294967295,S=_+(v<<12&4294967295|v>>>20),v=I+(w^S&(_^w))+E[6]+2821735955&4294967295,I=S+(v<<17&4294967295|v>>>15),v=w+(_^I&(S^_))+E[7]+4249261313&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(S^w&(I^S))+E[8]+1770035416&4294967295,_=w+(v<<7&4294967295|v>>>25),v=S+(I^_&(w^I))+E[9]+2336552879&4294967295,S=_+(v<<12&4294967295|v>>>20),v=I+(w^S&(_^w))+E[10]+4294925233&4294967295,I=S+(v<<17&4294967295|v>>>15),v=w+(_^I&(S^_))+E[11]+2304563134&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(S^w&(I^S))+E[12]+1804603682&4294967295,_=w+(v<<7&4294967295|v>>>25),v=S+(I^_&(w^I))+E[13]+4254626195&4294967295,S=_+(v<<12&4294967295|v>>>20),v=I+(w^S&(_^w))+E[14]+2792965006&4294967295,I=S+(v<<17&4294967295|v>>>15),v=w+(_^I&(S^_))+E[15]+1236535329&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(I^S&(w^I))+E[1]+4129170786&4294967295,_=w+(v<<5&4294967295|v>>>27),v=S+(w^I&(_^w))+E[6]+3225465664&4294967295,S=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(S^_))+E[11]+643717713&4294967295,I=S+(v<<14&4294967295|v>>>18),v=w+(S^_&(I^S))+E[0]+3921069994&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^S&(w^I))+E[5]+3593408605&4294967295,_=w+(v<<5&4294967295|v>>>27),v=S+(w^I&(_^w))+E[10]+38016083&4294967295,S=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(S^_))+E[15]+3634488961&4294967295,I=S+(v<<14&4294967295|v>>>18),v=w+(S^_&(I^S))+E[4]+3889429448&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^S&(w^I))+E[9]+568446438&4294967295,_=w+(v<<5&4294967295|v>>>27),v=S+(w^I&(_^w))+E[14]+3275163606&4294967295,S=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(S^_))+E[3]+4107603335&4294967295,I=S+(v<<14&4294967295|v>>>18),v=w+(S^_&(I^S))+E[8]+1163531501&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^S&(w^I))+E[13]+2850285829&4294967295,_=w+(v<<5&4294967295|v>>>27),v=S+(w^I&(_^w))+E[2]+4243563512&4294967295,S=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(S^_))+E[7]+1735328473&4294967295,I=S+(v<<14&4294967295|v>>>18),v=w+(S^_&(I^S))+E[12]+2368359562&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(w^I^S)+E[5]+4294588738&4294967295,_=w+(v<<4&4294967295|v>>>28),v=S+(_^w^I)+E[8]+2272392833&4294967295,S=_+(v<<11&4294967295|v>>>21),v=I+(S^_^w)+E[11]+1839030562&4294967295,I=S+(v<<16&4294967295|v>>>16),v=w+(I^S^_)+E[14]+4259657740&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^S)+E[1]+2763975236&4294967295,_=w+(v<<4&4294967295|v>>>28),v=S+(_^w^I)+E[4]+1272893353&4294967295,S=_+(v<<11&4294967295|v>>>21),v=I+(S^_^w)+E[7]+4139469664&4294967295,I=S+(v<<16&4294967295|v>>>16),v=w+(I^S^_)+E[10]+3200236656&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^S)+E[13]+681279174&4294967295,_=w+(v<<4&4294967295|v>>>28),v=S+(_^w^I)+E[0]+3936430074&4294967295,S=_+(v<<11&4294967295|v>>>21),v=I+(S^_^w)+E[3]+3572445317&4294967295,I=S+(v<<16&4294967295|v>>>16),v=w+(I^S^_)+E[6]+76029189&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^S)+E[9]+3654602809&4294967295,_=w+(v<<4&4294967295|v>>>28),v=S+(_^w^I)+E[12]+3873151461&4294967295,S=_+(v<<11&4294967295|v>>>21),v=I+(S^_^w)+E[15]+530742520&4294967295,I=S+(v<<16&4294967295|v>>>16),v=w+(I^S^_)+E[2]+3299628645&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(I^(w|~S))+E[0]+4096336452&4294967295,_=w+(v<<6&4294967295|v>>>26),v=S+(w^(_|~I))+E[7]+1126891415&4294967295,S=_+(v<<10&4294967295|v>>>22),v=I+(_^(S|~w))+E[14]+2878612391&4294967295,I=S+(v<<15&4294967295|v>>>17),v=w+(S^(I|~_))+E[5]+4237533241&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~S))+E[12]+1700485571&4294967295,_=w+(v<<6&4294967295|v>>>26),v=S+(w^(_|~I))+E[3]+2399980690&4294967295,S=_+(v<<10&4294967295|v>>>22),v=I+(_^(S|~w))+E[10]+4293915773&4294967295,I=S+(v<<15&4294967295|v>>>17),v=w+(S^(I|~_))+E[1]+2240044497&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~S))+E[8]+1873313359&4294967295,_=w+(v<<6&4294967295|v>>>26),v=S+(w^(_|~I))+E[15]+4264355552&4294967295,S=_+(v<<10&4294967295|v>>>22),v=I+(_^(S|~w))+E[6]+2734768916&4294967295,I=S+(v<<15&4294967295|v>>>17),v=w+(S^(I|~_))+E[13]+1309151649&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~S))+E[4]+4149444226&4294967295,_=w+(v<<6&4294967295|v>>>26),v=S+(w^(_|~I))+E[11]+3174756917&4294967295,S=_+(v<<10&4294967295|v>>>22),v=I+(_^(S|~w))+E[2]+718787259&4294967295,I=S+(v<<15&4294967295|v>>>17),v=w+(S^(I|~_))+E[9]+3951481745&4294967295,T.g[0]=T.g[0]+_&4294967295,T.g[1]=T.g[1]+(I+(v<<21&4294967295|v>>>11))&4294967295,T.g[2]=T.g[2]+I&4294967295,T.g[3]=T.g[3]+S&4294967295}i.prototype.u=function(T,_){_===void 0&&(_=T.length);for(var w=_-this.blockSize,E=this.B,I=this.h,S=0;S<_;){if(I==0)for(;S<=w;)r(this,T,S),S+=this.blockSize;if(typeof T=="string"){for(;S<_;)if(E[I++]=T.charCodeAt(S++),I==this.blockSize){r(this,E),I=0;break}}else for(;S<_;)if(E[I++]=T[S++],I==this.blockSize){r(this,E),I=0;break}}this.h=I,this.o+=_},i.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var _=1;_<T.length-8;++_)T[_]=0;var w=8*this.o;for(_=T.length-8;_<T.length;++_)T[_]=w&255,w/=256;for(this.u(T),T=Array(16),_=w=0;4>_;++_)for(var E=0;32>E;E+=8)T[w++]=this.g[_]>>>E&255;return T};function s(T,_){var w=a;return Object.prototype.hasOwnProperty.call(w,T)?w[T]:w[T]=_(T)}function o(T,_){this.h=_;for(var w=[],E=!0,I=T.length-1;0<=I;I--){var S=T[I]|0;E&&S==_||(w[I]=S,E=!1)}this.g=w}var a={};function c(T){return-128<=T&&128>T?s(T,function(_){return new o([_|0],0>_?-1:0)}):new o([T|0],0>T?-1:0)}function u(T){if(isNaN(T)||!isFinite(T))return p;if(0>T)return N(u(-T));for(var _=[],w=1,E=0;T>=w;E++)_[E]=T/w|0,w*=4294967296;return new o(_,0)}function d(T,_){if(T.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(T.charAt(0)=="-")return N(d(T.substring(1),_));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=u(Math.pow(_,8)),E=p,I=0;I<T.length;I+=8){var S=Math.min(8,T.length-I),v=parseInt(T.substring(I,I+S),_);8>S?(S=u(Math.pow(_,S)),E=E.j(S).add(u(v))):(E=E.j(w),E=E.add(u(v)))}return E}var p=c(0),m=c(1),y=c(16777216);n=o.prototype,n.m=function(){if(x(this))return-N(this).m();for(var T=0,_=1,w=0;w<this.g.length;w++){var E=this.i(w);T+=(0<=E?E:4294967296+E)*_,_*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(C(this))return"0";if(x(this))return"-"+N(this).toString(T);for(var _=u(Math.pow(T,6)),w=this,E="";;){var I=W(w,_).g;w=q(w,I.j(_));var S=((0<w.g.length?w.g[0]:w.h)>>>0).toString(T);if(w=I,C(w))return S+E;for(;6>S.length;)S="0"+S;E=S+E}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function C(T){if(T.h!=0)return!1;for(var _=0;_<T.g.length;_++)if(T.g[_]!=0)return!1;return!0}function x(T){return T.h==-1}n.l=function(T){return T=q(this,T),x(T)?-1:C(T)?0:1};function N(T){for(var _=T.g.length,w=[],E=0;E<_;E++)w[E]=~T.g[E];return new o(w,~T.h).add(m)}n.abs=function(){return x(this)?N(this):this},n.add=function(T){for(var _=Math.max(this.g.length,T.g.length),w=[],E=0,I=0;I<=_;I++){var S=E+(this.i(I)&65535)+(T.i(I)&65535),v=(S>>>16)+(this.i(I)>>>16)+(T.i(I)>>>16);E=v>>>16,S&=65535,v&=65535,w[I]=v<<16|S}return new o(w,w[w.length-1]&-2147483648?-1:0)};function q(T,_){return T.add(N(_))}n.j=function(T){if(C(this)||C(T))return p;if(x(this))return x(T)?N(this).j(N(T)):N(N(this).j(T));if(x(T))return N(this.j(N(T)));if(0>this.l(y)&&0>T.l(y))return u(this.m()*T.m());for(var _=this.g.length+T.g.length,w=[],E=0;E<2*_;E++)w[E]=0;for(E=0;E<this.g.length;E++)for(var I=0;I<T.g.length;I++){var S=this.i(E)>>>16,v=this.i(E)&65535,hn=T.i(I)>>>16,Ss=T.i(I)&65535;w[2*E+2*I]+=v*Ss,j(w,2*E+2*I),w[2*E+2*I+1]+=S*Ss,j(w,2*E+2*I+1),w[2*E+2*I+1]+=v*hn,j(w,2*E+2*I+1),w[2*E+2*I+2]+=S*hn,j(w,2*E+2*I+2)}for(E=0;E<_;E++)w[E]=w[2*E+1]<<16|w[2*E];for(E=_;E<2*_;E++)w[E]=0;return new o(w,0)};function j(T,_){for(;(T[_]&65535)!=T[_];)T[_+1]+=T[_]>>>16,T[_]&=65535,_++}function M(T,_){this.g=T,this.h=_}function W(T,_){if(C(_))throw Error("division by zero");if(C(T))return new M(p,p);if(x(T))return _=W(N(T),_),new M(N(_.g),N(_.h));if(x(_))return _=W(T,N(_)),new M(N(_.g),_.h);if(30<T.g.length){if(x(T)||x(_))throw Error("slowDivide_ only works with positive integers.");for(var w=m,E=_;0>=E.l(T);)w=H(w),E=H(E);var I=Y(w,1),S=Y(E,1);for(E=Y(E,2),w=Y(w,2);!C(E);){var v=S.add(E);0>=v.l(T)&&(I=I.add(w),S=v),E=Y(E,1),w=Y(w,1)}return _=q(T,I.j(_)),new M(I,_)}for(I=p;0<=T.l(_);){for(w=Math.max(1,Math.floor(T.m()/_.m())),E=Math.ceil(Math.log(w)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),S=u(w),v=S.j(_);x(v)||0<v.l(T);)w-=E,S=u(w),v=S.j(_);C(S)&&(S=m),I=I.add(S),T=q(T,v)}return new M(I,T)}n.A=function(T){return W(this,T).h},n.and=function(T){for(var _=Math.max(this.g.length,T.g.length),w=[],E=0;E<_;E++)w[E]=this.i(E)&T.i(E);return new o(w,this.h&T.h)},n.or=function(T){for(var _=Math.max(this.g.length,T.g.length),w=[],E=0;E<_;E++)w[E]=this.i(E)|T.i(E);return new o(w,this.h|T.h)},n.xor=function(T){for(var _=Math.max(this.g.length,T.g.length),w=[],E=0;E<_;E++)w[E]=this.i(E)^T.i(E);return new o(w,this.h^T.h)};function H(T){for(var _=T.g.length+1,w=[],E=0;E<_;E++)w[E]=T.i(E)<<1|T.i(E-1)>>>31;return new o(w,T.h)}function Y(T,_){var w=_>>5;_%=32;for(var E=T.g.length-w,I=[],S=0;S<E;S++)I[S]=0<_?T.i(S+w)>>>_|T.i(S+w+1)<<32-_:T.i(S+w);return new o(I,T.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,Sf=Xw.Md5=i,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,Zn=Xw.Integer=o}).apply(typeof Jw<"u"?Jw:typeof self<"u"?self:typeof window<"u"?window:{});var sc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},En={};var bf,rR,Lr,Rf,zo,oc,Pf,xf,kf;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,f){return l==Array.prototype||l==Object.prototype||(l[h]=f.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof sc=="object"&&sc];for(var h=0;h<l.length;++h){var f=l[h];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var i=t(this);function r(l,h){if(h)e:{var f=i;l=l.split(".");for(var g=0;g<l.length-1;g++){var A=l[g];if(!(A in f))break e;f=f[A]}l=l[l.length-1],g=f[l],h=h(g),h!=g&&h!=null&&e(f,l,{configurable:!0,writable:!0,value:h})}}function s(l,h){l instanceof String&&(l+="");var f=0,g=!1,A={next:function(){if(!g&&f<l.length){var R=f++;return{value:h(R,l[R]),done:!1}}return g=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}r("Array.prototype.values",function(l){return l||function(){return s(this,function(h,f){return f})}});var o=o||{},a=this||self;function c(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function u(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function d(l,h,f){return l.call.apply(l.bind,arguments)}function p(l,h,f){if(!l)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,g),l.apply(h,A)}}return function(){return l.apply(h,arguments)}}function m(l,h,f){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:p,m.apply(null,arguments)}function y(l,h){var f=Array.prototype.slice.call(arguments,1);return function(){var g=f.slice();return g.push.apply(g,arguments),l.apply(this,g)}}function C(l,h){function f(){}f.prototype=h.prototype,l.aa=h.prototype,l.prototype=new f,l.prototype.constructor=l,l.Qb=function(g,A,R){for(var F=Array(arguments.length-2),he=2;he<arguments.length;he++)F[he-2]=arguments[he];return h.prototype[A].apply(g,F)}}function x(l){let h=l.length;if(0<h){let f=Array(h);for(let g=0;g<h;g++)f[g]=l[g];return f}return[]}function N(l,h){for(let f=1;f<arguments.length;f++){let g=arguments[f];if(c(g)){let A=l.length||0,R=g.length||0;l.length=A+R;for(let F=0;F<R;F++)l[A+F]=g[F]}else l.push(g)}}class q{constructor(h,f){this.i=h,this.j=f,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function j(l){return/^[\s\xa0]*$/.test(l)}function M(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function W(l){return W[" "](l),l}W[" "]=function(){};var H=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function Y(l,h,f){for(let g in l)h.call(f,l[g],g,l)}function T(l,h){for(let f in l)h.call(void 0,l[f],f,l)}function _(l){let h={};for(let f in l)h[f]=l[f];return h}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(l,h){let f,g;for(let A=1;A<arguments.length;A++){g=arguments[A];for(f in g)l[f]=g[f];for(let R=0;R<w.length;R++)f=w[R],Object.prototype.hasOwnProperty.call(g,f)&&(l[f]=g[f])}}function I(l){var h=1;l=l.split(":");let f=[];for(;0<h&&l.length;)f.push(l.shift()),h--;return l.length&&f.push(l.join(":")),f}function S(l){a.setTimeout(()=>{throw l},0)}function v(){var l=Pu;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class hn{constructor(){this.h=this.g=null}add(h,f){let g=Ss.get();g.set(h,f),this.h?this.h.next=g:this.g=g,this.h=g}}var Ss=new q(()=>new M0,l=>l.reset());class M0{constructor(){this.next=this.g=this.h=null}set(h,f){this.h=h,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let bs,Rs=!1,Pu=new hn,Lg=()=>{let l=a.Promise.resolve(void 0);bs=()=>{l.then(F0)}};var F0=()=>{for(var l;l=v();){try{l.h.call(l.g)}catch(f){S(f)}var h=Ss;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}Rs=!1};function Nn(){this.s=this.s,this.C=this.C}Nn.prototype.s=!1,Nn.prototype.ma=function(){this.s||(this.s=!0,this.N())},Nn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function He(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}He.prototype.h=function(){this.defaultPrevented=!0};var L0=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let f=()=>{};a.addEventListener("test",f,h),a.removeEventListener("test",f,h)}catch{}return l}();function Ps(l,h){if(He.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var f=this.type=l.type,g=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(H){e:{try{W(h.nodeName);var A=!0;break e}catch{}A=!1}A||(h=null)}}else f=="mouseover"?h=l.fromElement:f=="mouseout"&&(h=l.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:U0[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&Ps.aa.h.call(this)}}C(Ps,He);var U0={2:"touch",3:"pen",4:"mouse"};Ps.prototype.h=function(){Ps.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var xs="closure_listenable_"+(1e6*Math.random()|0),B0=0;function q0(l,h,f,g,A){this.listener=l,this.proxy=null,this.src=h,this.type=f,this.capture=!!g,this.ha=A,this.key=++B0,this.da=this.fa=!1}function Na(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Da(l){this.src=l,this.g={},this.h=0}Da.prototype.add=function(l,h,f,g,A){var R=l.toString();l=this.g[R],l||(l=this.g[R]=[],this.h++);var F=ku(l,h,g,A);return-1<F?(h=l[F],f||(h.fa=!1)):(h=new q0(h,this.src,R,!!g,A),h.fa=f,l.push(h)),h};function xu(l,h){var f=h.type;if(f in l.g){var g=l.g[f],A=Array.prototype.indexOf.call(g,h,void 0),R;(R=0<=A)&&Array.prototype.splice.call(g,A,1),R&&(Na(h),l.g[f].length==0&&(delete l.g[f],l.h--))}}function ku(l,h,f,g){for(var A=0;A<l.length;++A){var R=l[A];if(!R.da&&R.listener==h&&R.capture==!!f&&R.ha==g)return A}return-1}var Nu="closure_lm_"+(1e6*Math.random()|0),Du={};function Ug(l,h,f,g,A){if(g&&g.once)return qg(l,h,f,g,A);if(Array.isArray(h)){for(var R=0;R<h.length;R++)Ug(l,h[R],f,g,A);return null}return f=Fu(f),l&&l[xs]?l.K(h,f,u(g)?!!g.capture:!!g,A):Bg(l,h,f,!1,g,A)}function Bg(l,h,f,g,A,R){if(!h)throw Error("Invalid event type");var F=u(A)?!!A.capture:!!A,he=Ou(l);if(he||(l[Nu]=he=new Da(l)),f=he.add(h,f,g,F,R),f.proxy)return f;if(g=j0(),f.proxy=g,g.src=l,g.listener=f,l.addEventListener)L0||(A=F),A===void 0&&(A=!1),l.addEventListener(h.toString(),g,A);else if(l.attachEvent)l.attachEvent(Gg(h.toString()),g);else if(l.addListener&&l.removeListener)l.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return f}function j0(){function l(f){return h.call(l.src,l.listener,f)}let h=G0;return l}function qg(l,h,f,g,A){if(Array.isArray(h)){for(var R=0;R<h.length;R++)qg(l,h[R],f,g,A);return null}return f=Fu(f),l&&l[xs]?l.L(h,f,u(g)?!!g.capture:!!g,A):Bg(l,h,f,!0,g,A)}function jg(l,h,f,g,A){if(Array.isArray(h))for(var R=0;R<h.length;R++)jg(l,h[R],f,g,A);else g=u(g)?!!g.capture:!!g,f=Fu(f),l&&l[xs]?(l=l.i,h=String(h).toString(),h in l.g&&(R=l.g[h],f=ku(R,f,g,A),-1<f&&(Na(R[f]),Array.prototype.splice.call(R,f,1),R.length==0&&(delete l.g[h],l.h--)))):l&&(l=Ou(l))&&(h=l.g[h.toString()],l=-1,h&&(l=ku(h,f,g,A)),(f=-1<l?h[l]:null)&&Vu(f))}function Vu(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[xs])xu(h.i,l);else{var f=l.type,g=l.proxy;h.removeEventListener?h.removeEventListener(f,g,l.capture):h.detachEvent?h.detachEvent(Gg(f),g):h.addListener&&h.removeListener&&h.removeListener(g),(f=Ou(h))?(xu(f,l),f.h==0&&(f.src=null,h[Nu]=null)):Na(l)}}}function Gg(l){return l in Du?Du[l]:Du[l]="on"+l}function G0(l,h){if(l.da)l=!0;else{h=new Ps(h,this);var f=l.listener,g=l.ha||l.src;l.fa&&Vu(l),l=f.call(g,h)}return l}function Ou(l){return l=l[Nu],l instanceof Da?l:null}var Mu="__closure_events_fn_"+(1e9*Math.random()>>>0);function Fu(l){return typeof l=="function"?l:(l[Mu]||(l[Mu]=function(h){return l.handleEvent(h)}),l[Mu])}function Ye(){Nn.call(this),this.i=new Da(this),this.M=this,this.F=null}C(Ye,Nn),Ye.prototype[xs]=!0,Ye.prototype.removeEventListener=function(l,h,f,g){jg(this,l,h,f,g)};function nt(l,h){var f,g=l.F;if(g)for(f=[];g;g=g.F)f.push(g);if(l=l.M,g=h.type||h,typeof h=="string")h=new He(h,l);else if(h instanceof He)h.target=h.target||l;else{var A=h;h=new He(g,l),E(h,A)}if(A=!0,f)for(var R=f.length-1;0<=R;R--){var F=h.g=f[R];A=Va(F,g,!0,h)&&A}if(F=h.g=l,A=Va(F,g,!0,h)&&A,A=Va(F,g,!1,h)&&A,f)for(R=0;R<f.length;R++)F=h.g=f[R],A=Va(F,g,!1,h)&&A}Ye.prototype.N=function(){if(Ye.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var f=l.g[h],g=0;g<f.length;g++)Na(f[g]);delete l.g[h],l.h--}}this.F=null},Ye.prototype.K=function(l,h,f,g){return this.i.add(String(l),h,!1,f,g)},Ye.prototype.L=function(l,h,f,g){return this.i.add(String(l),h,!0,f,g)};function Va(l,h,f,g){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var A=!0,R=0;R<h.length;++R){var F=h[R];if(F&&!F.da&&F.capture==f){var he=F.listener,We=F.ha||F.src;F.fa&&xu(l.i,F),A=he.call(We,g)!==!1&&A}}return A&&!g.defaultPrevented}function Kg(l,h,f){if(typeof l=="function")f&&(l=m(l,f));else if(l&&typeof l.handleEvent=="function")l=m(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(l,h||0)}function zg(l){l.g=Kg(()=>{l.g=null,l.i&&(l.i=!1,zg(l))},l.l);let h=l.h;l.h=null,l.m.apply(null,h)}class K0 extends Nn{constructor(h,f){super(),this.m=h,this.l=f,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:zg(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ks(l){Nn.call(this),this.h=l,this.g={}}C(ks,Nn);var Wg=[];function $g(l){Y(l.g,function(h,f){this.g.hasOwnProperty(f)&&Vu(h)},l),l.g={}}ks.prototype.N=function(){ks.aa.N.call(this),$g(this)},ks.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Lu=a.JSON.stringify,z0=a.JSON.parse,W0=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function Uu(){}Uu.prototype.h=null;function Qg(l){return l.h||(l.h=l.i())}function Hg(){}var Ns={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Bu(){He.call(this,"d")}C(Bu,He);function qu(){He.call(this,"c")}C(qu,He);var vi={},Yg=null;function Oa(){return Yg=Yg||new Ye}vi.La="serverreachability";function Jg(l){He.call(this,vi.La,l)}C(Jg,He);function Ds(l){let h=Oa();nt(h,new Jg(h))}vi.STAT_EVENT="statevent";function Xg(l,h){He.call(this,vi.STAT_EVENT,l),this.stat=h}C(Xg,He);function it(l){let h=Oa();nt(h,new Xg(h,l))}vi.Ma="timingevent";function Zg(l,h){He.call(this,vi.Ma,l),this.size=h}C(Zg,He);function Vs(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},h)}function Os(){this.g=!0}Os.prototype.xa=function(){this.g=!1};function $0(l,h,f,g,A,R){l.info(function(){if(l.g)if(R)for(var F="",he=R.split("&"),We=0;We<he.length;We++){var ae=he[We].split("=");if(1<ae.length){var Je=ae[0];ae=ae[1];var Xe=Je.split("_");F=2<=Xe.length&&Xe[1]=="type"?F+(Je+"="+ae+"&"):F+(Je+"=redacted&")}}else F=null;else F=R;return"XMLHTTP REQ ("+g+") [attempt "+A+"]: "+h+`
`+f+`
`+F})}function Q0(l,h,f,g,A,R,F){l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+A+"]: "+h+`
`+f+`
`+R+" "+F})}function ur(l,h,f,g){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+Y0(l,f)+(g?" "+g:"")})}function H0(l,h){l.info(function(){return"TIMEOUT: "+h})}Os.prototype.info=function(){};function Y0(l,h){if(!l.g)return h;if(!h)return null;try{var f=JSON.parse(h);if(f){for(l=0;l<f.length;l++)if(Array.isArray(f[l])){var g=f[l];if(!(2>g.length)){var A=g[1];if(Array.isArray(A)&&!(1>A.length)){var R=A[0];if(R!="noop"&&R!="stop"&&R!="close")for(var F=1;F<A.length;F++)A[F]=""}}}}return Lu(f)}catch{return h}}var Ma={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},e_={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ju;function Fa(){}C(Fa,Uu),Fa.prototype.g=function(){return new XMLHttpRequest},Fa.prototype.i=function(){return{}},ju=new Fa;function Dn(l,h,f,g){this.j=l,this.i=h,this.l=f,this.R=g||1,this.U=new ks(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new t_}function t_(){this.i=null,this.g="",this.h=!1}var n_={},Gu={};function Ku(l,h,f){l.L=1,l.v=qa(dn(h)),l.m=f,l.P=!0,i_(l,null)}function i_(l,h){l.F=Date.now(),La(l),l.A=dn(l.v);var f=l.A,g=l.R;Array.isArray(g)||(g=[String(g)]),__(f.i,"t",g),l.C=0,f=l.j.J,l.h=new t_,l.g=O_(l.j,f?h:null,!l.m),0<l.O&&(l.M=new K0(m(l.Y,l,l.g),l.O)),h=l.U,f=l.g,g=l.ca;var A="readystatechange";Array.isArray(A)||(A&&(Wg[0]=A.toString()),A=Wg);for(var R=0;R<A.length;R++){var F=Ug(f,A[R],g||h.handleEvent,!1,h.h||h);if(!F)break;h.g[F.key]=F}h=l.H?_(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),Ds(),$0(l.i,l.u,l.A,l.l,l.R,l.m)}Dn.prototype.ca=function(l){l=l.target;let h=this.M;h&&fn(l)==3?h.j():this.Y(l)},Dn.prototype.Y=function(l){try{if(l==this.g)e:{let Xe=fn(this.g);var h=this.g.Ba();let fr=this.g.Z();if(!(3>Xe)&&(Xe!=3||this.g&&(this.h.h||this.g.oa()||A_(this.g)))){this.J||Xe!=4||h==7||(h==8||0>=fr?Ds(3):Ds(2)),zu(this);var f=this.g.Z();this.X=f;t:if(r_(this)){var g=A_(this.g);l="";var A=g.length,R=fn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){wi(this),Ms(this);var F="";break t}this.h.i=new a.TextDecoder}for(h=0;h<A;h++)this.h.h=!0,l+=this.h.i.decode(g[h],{stream:!(R&&h==A-1)});g.length=0,this.h.g+=l,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=f==200,Q0(this.i,this.u,this.A,this.l,this.R,Xe,f),this.o){if(this.T&&!this.K){t:{if(this.g){var he,We=this.g;if((he=We.g?We.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(he)){var ae=he;break t}}ae=null}if(f=ae)ur(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Wu(this,f);else{this.o=!1,this.s=3,it(12),wi(this),Ms(this);break e}}if(this.P){f=!0;let Nt;for(;!this.J&&this.C<F.length;)if(Nt=J0(this,F),Nt==Gu){Xe==4&&(this.s=4,it(14),f=!1),ur(this.i,this.l,null,"[Incomplete Response]");break}else if(Nt==n_){this.s=4,it(15),ur(this.i,this.l,F,"[Invalid Chunk]"),f=!1;break}else ur(this.i,this.l,Nt,null),Wu(this,Nt);if(r_(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Xe!=4||F.length!=0||this.h.h||(this.s=1,it(16),f=!1),this.o=this.o&&f,!f)ur(this.i,this.l,F,"[Invalid Chunked Response]"),wi(this),Ms(this);else if(0<F.length&&!this.W){this.W=!0;var Je=this.j;Je.g==this&&Je.ba&&!Je.M&&(Je.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Xu(Je),Je.M=!0,it(11))}}else ur(this.i,this.l,F,null),Wu(this,F);Xe==4&&wi(this),this.o&&!this.J&&(Xe==4?k_(this.j,this):(this.o=!1,La(this)))}else pA(this.g),f==400&&0<F.indexOf("Unknown SID")?(this.s=3,it(12)):(this.s=0,it(13)),wi(this),Ms(this)}}}catch{}finally{}};function r_(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function J0(l,h){var f=l.C,g=h.indexOf(`
`,f);return g==-1?Gu:(f=Number(h.substring(f,g)),isNaN(f)?n_:(g+=1,g+f>h.length?Gu:(h=h.slice(g,g+f),l.C=g+f,h)))}Dn.prototype.cancel=function(){this.J=!0,wi(this)};function La(l){l.S=Date.now()+l.I,s_(l,l.I)}function s_(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Vs(m(l.ba,l),h)}function zu(l){l.B&&(a.clearTimeout(l.B),l.B=null)}Dn.prototype.ba=function(){this.B=null;let l=Date.now();0<=l-this.S?(H0(this.i,this.A),this.L!=2&&(Ds(),it(17)),wi(this),this.s=2,Ms(this)):s_(this,this.S-l)};function Ms(l){l.j.G==0||l.J||k_(l.j,l)}function wi(l){zu(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,$g(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function Wu(l,h){try{var f=l.j;if(f.G!=0&&(f.g==l||$u(f.h,l))){if(!l.K&&$u(f.h,l)&&f.G==3){try{var g=f.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var A=g;if(A[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<l.F)Wa(f),Ka(f);else break e;Ju(f),it(18)}}else f.za=A[1],0<f.za-f.T&&37500>A[2]&&f.F&&f.v==0&&!f.C&&(f.C=Vs(m(f.Za,f),6e3));if(1>=l_(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else Ei(f,11)}else if((l.K||f.g==l)&&Wa(f),!j(h))for(A=f.Da.g.parse(h),h=0;h<A.length;h++){let ae=A[h];if(f.T=ae[0],ae=ae[1],f.G==2)if(ae[0]=="c"){f.K=ae[1],f.ia=ae[2];let Je=ae[3];Je!=null&&(f.la=Je,f.j.info("VER="+f.la));let Xe=ae[4];Xe!=null&&(f.Aa=Xe,f.j.info("SVER="+f.Aa));let fr=ae[5];fr!=null&&typeof fr=="number"&&0<fr&&(g=1.5*fr,f.L=g,f.j.info("backChannelRequestTimeoutMs_="+g)),g=f;let Nt=l.g;if(Nt){let Qa=Nt.g?Nt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Qa){var R=g.h;R.g||Qa.indexOf("spdy")==-1&&Qa.indexOf("quic")==-1&&Qa.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(Qu(R,R.h),R.h=null))}if(g.D){let Zu=Nt.g?Nt.g.getResponseHeader("X-HTTP-Session-Id"):null;Zu&&(g.ya=Zu,ge(g.I,g.D,Zu))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-l.F,f.j.info("Handshake RTT: "+f.R+"ms")),g=f;var F=l;if(g.qa=V_(g,g.J?g.ia:null,g.W),F.K){c_(g.h,F);var he=F,We=g.L;We&&(he.I=We),he.B&&(zu(he),La(he)),g.g=F}else P_(g);0<f.i.length&&za(f)}else ae[0]!="stop"&&ae[0]!="close"||Ei(f,7);else f.G==3&&(ae[0]=="stop"||ae[0]=="close"?ae[0]=="stop"?Ei(f,7):Yu(f):ae[0]!="noop"&&f.l&&f.l.ta(ae),f.v=0)}}Ds(4)}catch{}}var X0=class{constructor(l,h){this.g=l,this.map=h}};function o_(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function a_(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function l_(l){return l.h?1:l.g?l.g.size:0}function $u(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function Qu(l,h){l.g?l.g.add(h):l.h=h}function c_(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}o_.prototype.cancel=function(){if(this.i=u_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function u_(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(let f of l.g.values())h=h.concat(f.D);return h}return x(l.i)}function Z0(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(c(l)){for(var h=[],f=l.length,g=0;g<f;g++)h.push(l[g]);return h}h=[],f=0;for(g in l)h[f++]=l[g];return h}function eA(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(c(l)||typeof l=="string"){var h=[];l=l.length;for(var f=0;f<l;f++)h.push(f);return h}h=[],f=0;for(let g in l)h[f++]=g;return h}}}function h_(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(c(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var f=eA(l),g=Z0(l),A=g.length,R=0;R<A;R++)h.call(void 0,g[R],f&&f[R],l)}var d_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tA(l,h){if(l){l=l.split("&");for(var f=0;f<l.length;f++){var g=l[f].indexOf("="),A=null;if(0<=g){var R=l[f].substring(0,g);A=l[f].substring(g+1)}else R=l[f];h(R,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Ti(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof Ti){this.h=l.h,Ua(this,l.j),this.o=l.o,this.g=l.g,Ba(this,l.s),this.l=l.l;var h=l.i,f=new Us;f.i=h.i,h.g&&(f.g=new Map(h.g),f.h=h.h),f_(this,f),this.m=l.m}else l&&(h=String(l).match(d_))?(this.h=!1,Ua(this,h[1]||"",!0),this.o=Fs(h[2]||""),this.g=Fs(h[3]||"",!0),Ba(this,h[4]),this.l=Fs(h[5]||"",!0),f_(this,h[6]||"",!0),this.m=Fs(h[7]||"")):(this.h=!1,this.i=new Us(null,this.h))}Ti.prototype.toString=function(){var l=[],h=this.j;h&&l.push(Ls(h,p_,!0),":");var f=this.g;return(f||h=="file")&&(l.push("//"),(h=this.o)&&l.push(Ls(h,p_,!0),"@"),l.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&l.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&l.push("/"),l.push(Ls(f,f.charAt(0)=="/"?rA:iA,!0))),(f=this.i.toString())&&l.push("?",f),(f=this.m)&&l.push("#",Ls(f,oA)),l.join("")};function dn(l){return new Ti(l)}function Ua(l,h,f){l.j=f?Fs(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function Ba(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function f_(l,h,f){h instanceof Us?(l.i=h,aA(l.i,l.h)):(f||(h=Ls(h,sA)),l.i=new Us(h,l.h))}function ge(l,h,f){l.i.set(h,f)}function qa(l){return ge(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Fs(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Ls(l,h,f){return typeof l=="string"?(l=encodeURI(l).replace(h,nA),f&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function nA(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var p_=/[#\/\?@]/g,iA=/[#\?:]/g,rA=/[#\?]/g,sA=/[#\?@]/g,oA=/#/g;function Us(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function Vn(l){l.g||(l.g=new Map,l.h=0,l.i&&tA(l.i,function(h,f){l.add(decodeURIComponent(h.replace(/\+/g," ")),f)}))}n=Us.prototype,n.add=function(l,h){Vn(this),this.i=null,l=hr(this,l);var f=this.g.get(l);return f||this.g.set(l,f=[]),f.push(h),this.h+=1,this};function m_(l,h){Vn(l),h=hr(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function g_(l,h){return Vn(l),h=hr(l,h),l.g.has(h)}n.forEach=function(l,h){Vn(this),this.g.forEach(function(f,g){f.forEach(function(A){l.call(h,A,g,this)},this)},this)},n.na=function(){Vn(this);let l=Array.from(this.g.values()),h=Array.from(this.g.keys()),f=[];for(let g=0;g<h.length;g++){let A=l[g];for(let R=0;R<A.length;R++)f.push(h[g])}return f},n.V=function(l){Vn(this);let h=[];if(typeof l=="string")g_(this,l)&&(h=h.concat(this.g.get(hr(this,l))));else{l=Array.from(this.g.values());for(let f=0;f<l.length;f++)h=h.concat(l[f])}return h},n.set=function(l,h){return Vn(this),this.i=null,l=hr(this,l),g_(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},n.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function __(l,h,f){m_(l,h),0<f.length&&(l.i=null,l.g.set(hr(l,h),x(f)),l.h+=f.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],h=Array.from(this.g.keys());for(var f=0;f<h.length;f++){var g=h[f];let R=encodeURIComponent(String(g)),F=this.V(g);for(g=0;g<F.length;g++){var A=R;F[g]!==""&&(A+="="+encodeURIComponent(String(F[g]))),l.push(A)}}return this.i=l.join("&")};function hr(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function aA(l,h){h&&!l.j&&(Vn(l),l.i=null,l.g.forEach(function(f,g){var A=g.toLowerCase();g!=A&&(m_(this,g),__(this,A,f))},l)),l.j=h}function lA(l,h){let f=new Os;if(a.Image){let g=new Image;g.onload=y(On,f,"TestLoadImage: loaded",!0,h,g),g.onerror=y(On,f,"TestLoadImage: error",!1,h,g),g.onabort=y(On,f,"TestLoadImage: abort",!1,h,g),g.ontimeout=y(On,f,"TestLoadImage: timeout",!1,h,g),a.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=l}else h(!1)}function cA(l,h){let f=new Os,g=new AbortController,A=setTimeout(()=>{g.abort(),On(f,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:g.signal}).then(R=>{clearTimeout(A),R.ok?On(f,"TestPingServer: ok",!0,h):On(f,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(A),On(f,"TestPingServer: error",!1,h)})}function On(l,h,f,g,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),g(f)}catch{}}function uA(){this.g=new W0}function hA(l,h,f){let g=f||"";try{h_(l,function(A,R){let F=A;u(A)&&(F=Lu(A)),h.push(g+R+"="+encodeURIComponent(F))})}catch(A){throw h.push(g+"type="+encodeURIComponent("_badmap")),A}}function Bs(l){this.l=l.Ub||null,this.j=l.eb||!1}C(Bs,Uu),Bs.prototype.g=function(){return new ja(this.l,this.j)},Bs.prototype.i=function(l){return function(){return l}}({});function ja(l,h){Ye.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(ja,Ye),n=ja.prototype,n.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,js(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,qs(this)),this.readyState=0},n.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,js(this)),this.g&&(this.readyState=3,js(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;y_(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function y_(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}n.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?qs(this):js(this),this.readyState==3&&y_(this)}},n.Ra=function(l){this.g&&(this.response=this.responseText=l,qs(this))},n.Qa=function(l){this.g&&(this.response=l,qs(this))},n.ga=function(){this.g&&qs(this)};function qs(l){l.readyState=4,l.l=null,l.j=null,l.v=null,js(l)}n.setRequestHeader=function(l,h){this.u.append(l,h)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],h=this.h.entries();for(var f=h.next();!f.done;)f=f.value,l.push(f[0]+": "+f[1]),f=h.next();return l.join(`\r
`)};function js(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(ja.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function v_(l){let h="";return Y(l,function(f,g){h+=g,h+=":",h+=f,h+=`\r
`}),h}function Hu(l,h,f){e:{for(g in f){var g=!1;break e}g=!0}g||(f=v_(f),typeof l=="string"?f!=null&&encodeURIComponent(String(f)):ge(l,h,f))}function Ie(l){Ye.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(Ie,Ye);var dA=/^https?$/i,fA=["POST","PUT"];n=Ie.prototype,n.Ha=function(l){this.J=l},n.ea=function(l,h,f,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ju.g(),this.v=this.o?Qg(this.o):Qg(ju),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(R){w_(this,R);return}if(l=f||"",f=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var A in g)f.set(A,g[A]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let R of g.keys())f.set(R,g.get(R));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(f.keys()).find(R=>R.toLowerCase()=="content-type"),A=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(fA,h,void 0))||g||A||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[R,F]of f)this.g.setRequestHeader(R,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{I_(this),this.u=!0,this.g.send(l),this.u=!1}catch(R){w_(this,R)}};function w_(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,T_(l),Ga(l)}function T_(l){l.A||(l.A=!0,nt(l,"complete"),nt(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,nt(this,"complete"),nt(this,"abort"),Ga(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ga(this,!0)),Ie.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?E_(this):this.bb())},n.bb=function(){E_(this)};function E_(l){if(l.h&&typeof o<"u"&&(!l.v[1]||fn(l)!=4||l.Z()!=2)){if(l.u&&fn(l)==4)Kg(l.Ea,0,l);else if(nt(l,"readystatechange"),fn(l)==4){l.h=!1;try{let F=l.Z();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var f;if(!(f=h)){var g;if(g=F===0){var A=String(l.D).match(d_)[1]||null;!A&&a.self&&a.self.location&&(A=a.self.location.protocol.slice(0,-1)),g=!dA.test(A?A.toLowerCase():"")}f=g}if(f)nt(l,"complete"),nt(l,"success");else{l.m=6;try{var R=2<fn(l)?l.g.statusText:""}catch{R=""}l.l=R+" ["+l.Z()+"]",T_(l)}}finally{Ga(l)}}}}function Ga(l,h){if(l.g){I_(l);let f=l.g,g=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||nt(l,"ready");try{f.onreadystatechange=g}catch{}}}function I_(l){l.I&&(a.clearTimeout(l.I),l.I=null)}n.isActive=function(){return!!this.g};function fn(l){return l.g?l.g.readyState:0}n.Z=function(){try{return 2<fn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),z0(h)}};function A_(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function pA(l){let h={};l=(l.g&&2<=fn(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<l.length;g++){if(j(l[g]))continue;var f=I(l[g]);let A=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();let R=h[A]||[];h[A]=R,R.push(f)}T(h,function(g){return g.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Gs(l,h,f){return f&&f.internalChannelParams&&f.internalChannelParams[l]||h}function C_(l){this.Aa=0,this.i=[],this.j=new Os,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Gs("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Gs("baseRetryDelayMs",5e3,l),this.cb=Gs("retryDelaySeedMs",1e4,l),this.Wa=Gs("forwardChannelMaxRetries",2,l),this.wa=Gs("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new o_(l&&l.concurrentRequestLimit),this.Da=new uA,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=C_.prototype,n.la=8,n.G=1,n.connect=function(l,h,f,g){it(0),this.W=l,this.H=h||{},f&&g!==void 0&&(this.H.OSID=f,this.H.OAID=g),this.F=this.X,this.I=V_(this,null,this.W),za(this)};function Yu(l){if(S_(l),l.G==3){var h=l.U++,f=dn(l.I);if(ge(f,"SID",l.K),ge(f,"RID",h),ge(f,"TYPE","terminate"),Ks(l,f),h=new Dn(l,l.j,h),h.L=2,h.v=qa(dn(f)),f=!1,a.navigator&&a.navigator.sendBeacon)try{f=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!f&&a.Image&&(new Image().src=h.v,f=!0),f||(h.g=O_(h.j,null),h.g.ea(h.v)),h.F=Date.now(),La(h)}D_(l)}function Ka(l){l.g&&(Xu(l),l.g.cancel(),l.g=null)}function S_(l){Ka(l),l.u&&(a.clearTimeout(l.u),l.u=null),Wa(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function za(l){if(!a_(l.h)&&!l.s){l.s=!0;var h=l.Ga;bs||Lg(),Rs||(bs(),Rs=!0),Pu.add(h,l),l.B=0}}function mA(l,h){return l_(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Vs(m(l.Ga,l,h),N_(l,l.B)),l.B++,!0)}n.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;let A=new Dn(this,this.j,l),R=this.o;if(this.S&&(R?(R=_(R),E(R,this.S)):R=this.S),this.m!==null||this.O||(A.H=R,R=null),this.P)e:{for(var h=0,f=0;f<this.i.length;f++){t:{var g=this.i[f];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=f;break e}if(h===4096||f===this.i.length-1){h=f+1;break e}}h=1e3}else h=1e3;h=R_(this,A,h),f=dn(this.I),ge(f,"RID",l),ge(f,"CVER",22),this.D&&ge(f,"X-HTTP-Session-Id",this.D),Ks(this,f),R&&(this.O?h="headers="+encodeURIComponent(String(v_(R)))+"&"+h:this.m&&Hu(f,this.m,R)),Qu(this.h,A),this.Ua&&ge(f,"TYPE","init"),this.P?(ge(f,"$req",h),ge(f,"SID","null"),A.T=!0,Ku(A,f,null)):Ku(A,f,h),this.G=2}}else this.G==3&&(l?b_(this,l):this.i.length==0||a_(this.h)||b_(this))};function b_(l,h){var f;h?f=h.l:f=l.U++;let g=dn(l.I);ge(g,"SID",l.K),ge(g,"RID",f),ge(g,"AID",l.T),Ks(l,g),l.m&&l.o&&Hu(g,l.m,l.o),f=new Dn(l,l.j,f,l.B+1),l.m===null&&(f.H=l.o),h&&(l.i=h.D.concat(l.i)),h=R_(l,f,1e3),f.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Qu(l.h,f),Ku(f,g,h)}function Ks(l,h){l.H&&Y(l.H,function(f,g){ge(h,g,f)}),l.l&&h_({},function(f,g){ge(h,g,f)})}function R_(l,h,f){f=Math.min(l.i.length,f);var g=l.l?m(l.l.Na,l.l,l):null;e:{var A=l.i;let R=-1;for(;;){let F=["count="+f];R==-1?0<f?(R=A[0].g,F.push("ofs="+R)):R=0:F.push("ofs="+R);let he=!0;for(let We=0;We<f;We++){let ae=A[We].g,Je=A[We].map;if(ae-=R,0>ae)R=Math.max(0,A[We].g-100),he=!1;else try{hA(Je,F,"req"+ae+"_")}catch{g&&g(Je)}}if(he){g=F.join("&");break e}}}return l=l.i.splice(0,f),h.D=l,g}function P_(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;bs||Lg(),Rs||(bs(),Rs=!0),Pu.add(h,l),l.v=0}}function Ju(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Vs(m(l.Fa,l),N_(l,l.v)),l.v++,!0)}n.Fa=function(){if(this.u=null,x_(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Vs(m(this.ab,this),l)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,it(10),Ka(this),x_(this))};function Xu(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function x_(l){l.g=new Dn(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=dn(l.qa);ge(h,"RID","rpc"),ge(h,"SID",l.K),ge(h,"AID",l.T),ge(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&ge(h,"TO",l.ja),ge(h,"TYPE","xmlhttp"),Ks(l,h),l.m&&l.o&&Hu(h,l.m,l.o),l.L&&(l.g.I=l.L);var f=l.g;l=l.ia,f.L=1,f.v=qa(dn(h)),f.m=null,f.P=!0,i_(f,l)}n.Za=function(){this.C!=null&&(this.C=null,Ka(this),Ju(this),it(19))};function Wa(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function k_(l,h){var f=null;if(l.g==h){Wa(l),Xu(l),l.g=null;var g=2}else if($u(l.h,h))f=h.D,c_(l.h,h),g=1;else return;if(l.G!=0){if(h.o)if(g==1){f=h.m?h.m.length:0,h=Date.now()-h.F;var A=l.B;g=Oa(),nt(g,new Zg(g,f)),za(l)}else P_(l);else if(A=h.s,A==3||A==0&&0<h.X||!(g==1&&mA(l,h)||g==2&&Ju(l)))switch(f&&0<f.length&&(h=l.h,h.i=h.i.concat(f)),A){case 1:Ei(l,5);break;case 4:Ei(l,10);break;case 3:Ei(l,6);break;default:Ei(l,2)}}}function N_(l,h){let f=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(f*=2),f*h}function Ei(l,h){if(l.j.info("Error code "+h),h==2){var f=m(l.fb,l),g=l.Xa;let A=!g;g=new Ti(g||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ua(g,"https"),qa(g),A?lA(g.toString(),f):cA(g.toString(),f)}else it(2);l.G=0,l.l&&l.l.sa(h),D_(l),S_(l)}n.fb=function(l){l?(this.j.info("Successfully pinged google.com"),it(2)):(this.j.info("Failed to ping google.com"),it(1))};function D_(l){if(l.G=0,l.ka=[],l.l){let h=u_(l.h);(h.length!=0||l.i.length!=0)&&(N(l.ka,h),N(l.ka,l.i),l.h.i.length=0,x(l.i),l.i.length=0),l.l.ra()}}function V_(l,h,f){var g=f instanceof Ti?dn(f):new Ti(f);if(g.g!="")h&&(g.g=h+"."+g.g),Ba(g,g.s);else{var A=a.location;g=A.protocol,h=h?h+"."+A.hostname:A.hostname,A=+A.port;var R=new Ti(null);g&&Ua(R,g),h&&(R.g=h),A&&Ba(R,A),f&&(R.l=f),g=R}return f=l.D,h=l.ya,f&&h&&ge(g,f,h),ge(g,"VER",l.la),Ks(l,g),g}function O_(l,h,f){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new Ie(new Bs({eb:f})):new Ie(l.pa),h.Ha(l.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function M_(){}n=M_.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function $a(){}$a.prototype.g=function(l,h){return new pt(l,h)};function pt(l,h){Ye.call(this),this.g=new C_(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!j(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!j(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new dr(this)}C(pt,Ye),pt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},pt.prototype.close=function(){Yu(this.g)},pt.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var f={};f.__data__=l,l=f}else this.u&&(f={},f.__data__=Lu(l),l=f);h.i.push(new X0(h.Ya++,l)),h.G==3&&za(h)},pt.prototype.N=function(){this.g.l=null,delete this.j,Yu(this.g),delete this.g,pt.aa.N.call(this)};function F_(l){Bu.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(let f in h){l=f;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}C(F_,Bu);function L_(){qu.call(this),this.status=1}C(L_,qu);function dr(l){this.g=l}C(dr,M_),dr.prototype.ua=function(){nt(this.g,"a")},dr.prototype.ta=function(l){nt(this.g,new F_(l))},dr.prototype.sa=function(l){nt(this.g,new L_)},dr.prototype.ra=function(){nt(this.g,"b")},$a.prototype.createWebChannel=$a.prototype.g,pt.prototype.send=pt.prototype.o,pt.prototype.open=pt.prototype.m,pt.prototype.close=pt.prototype.close,kf=En.createWebChannelTransport=function(){return new $a},xf=En.getStatEventTarget=function(){return Oa()},Pf=En.Event=vi,oc=En.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ma.NO_ERROR=0,Ma.TIMEOUT=8,Ma.HTTP_ERROR=6,zo=En.ErrorCode=Ma,e_.COMPLETE="complete",Rf=En.EventType=e_,Hg.EventType=Ns,Ns.OPEN="a",Ns.CLOSE="b",Ns.ERROR="c",Ns.MESSAGE="d",Ye.prototype.listen=Ye.prototype.K,Lr=En.WebChannel=Hg,rR=En.FetchXmlHttpFactory=Bs,Ie.prototype.listenOnce=Ie.prototype.L,Ie.prototype.getLastError=Ie.prototype.Ka,Ie.prototype.getLastErrorCode=Ie.prototype.Ba,Ie.prototype.getStatus=Ie.prototype.Z,Ie.prototype.getResponseJson=Ie.prototype.Oa,Ie.prototype.getResponseText=Ie.prototype.oa,Ie.prototype.send=Ie.prototype.ea,Ie.prototype.setWithCredentials=Ie.prototype.Ha,bf=En.XhrIo=Ie}).apply(typeof sc<"u"?sc:typeof self<"u"?self:typeof window<"u"?window:{});var Zw="@firebase/firestore";var Me=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Me.UNAUTHENTICATED=new Me(null),Me.GOOGLE_CREDENTIALS=new Me("google-credentials-uid"),Me.FIRST_PARTY=new Me("first-party-uid"),Me.MOCK_USER=new Me("mock-user");var ms="10.14.0";var oi=new Bn("@firebase/firestore");function Gr(){return oi.logLevel}function nE(n){oi.setLogLevel(n)}function V(n,...e){if(oi.logLevel<=Ct.DEBUG){let t=e.map(Mm);oi.debug(`Firestore (${ms}): ${n}`,...t)}}function Re(n,...e){if(oi.logLevel<=Ct.ERROR){let t=e.map(Mm);oi.error(`Firestore (${ms}): ${n}`,...t)}}function Ut(n,...e){if(oi.logLevel<=Ct.WARN){let t=e.map(Mm);oi.warn(`Firestore (${ms}): ${n}`,...t)}}function Mm(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function B(n="Unexpected state"){let e=`FIRESTORE (${ms}) INTERNAL ASSERTION FAILED: `+n;throw Re(e),new Error(e)}function G(n,e){n||B()}function iE(n,e){n||B()}function L(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},D=class extends ry{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var qe=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var gc=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Ff=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Me.UNAUTHENTICATED))}shutdown(){}},Lf=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Uf=class{constructor(e){this.t=e,this.currentUser=Me.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){G(this.o===void 0);let i=this.i,r=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve(),s=new qe;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new qe,e.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>k(this,null,function*(){yield c.promise,yield r(this.currentUser)}))},a=c=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new qe)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(G(typeof i.accessToken=="string"),new gc(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return G(e===null||typeof e=="string"),new Me(e)}},Bf=class{constructor(e,t,i){this.l=e,this.h=t,this.P=i,this.type="FirstParty",this.user=Me.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},qf=class{constructor(e,t,i){this.l=e,this.h=t,this.P=i}getToken(){return Promise.resolve(new Bf(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Me.FIRST_PARTY))}shutdown(){}invalidateToken(){}},jf=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Gf=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){G(this.o===void 0);let i=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};let r=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?r(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G(typeof t.token=="string"),this.R=t.token,new jf(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function sR(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}var _c=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,i="";for(;i.length<20;){let r=sR(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%e.length))}return i}};function Q(n,e){return n<e?-1:n>e?1:0}function Xr(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}function rE(n){return n+"\0"}var Te=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new D(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new n(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var z=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Te(0,0))}static max(){return new n(new Te(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var yc=class n{constructor(e,t,i){t===void 0?t=0:t>e.length&&B(),i===void 0?i=e.length-t:i>e.length-t&&B(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let i=Math.min(e.length,t.length);for(let r=0;r<i;r++){let s=e.get(r),o=t.get(r);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},se=class n extends yc{construct(e,t,i){return new n(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let i of e){if(i.indexOf("//")>=0)throw new D(P.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new n(t)}static emptyPath(){return new n([])}},oR=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Pe=class n extends yc{construct(e,t,i){return new n(e,t,i)}static isValidIdentifier(e){return oR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],i="",r=0,s=()=>{if(i.length===0)throw new D(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""},o=!1;for(;r<e.length;){let a=e[r];if(a==="\\"){if(r+1===e.length)throw new D(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new D(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=c,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new D(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var U=class n{constructor(e){this.path=e}static fromPath(e){return new n(se.fromString(e))}static fromName(e){return new n(se.fromString(e).popFirst(5))}static empty(){return new n(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new se(e.slice()))}};var Zr=class{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}};function Kf(n){return n.fields.find(e=>e.kind===2)}function Ui(n){return n.fields.filter(e=>e.kind!==2)}Zr.UNKNOWN_ID=-1;var Hr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var ia=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,xt.min())}};function sE(n,e){let t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=z.fromTimestamp(i===1e9?new Te(t+1,0):new Te(t,i));return new xt(r,U.empty(),e)}function oE(n){return new xt(n.readTime,n.key,-1)}var xt=class n{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new n(z.min(),U.empty(),-1)}static max(){return new n(z.max(),U.empty(),-1)}};function Fm(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=U.comparator(n.documentKey,e.documentKey),t!==0?t:Q(n.largestBatchId,e.largestBatchId))}var aE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",vc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function gi(n){return k(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==aE)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var b=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,i)=>{t(e)})}static reject(e){return new n((t,i)=>{i(e)})}static waitFor(e){return new n((t,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&t()},c=>i(c))}),o=!0,s===r&&t()})}static or(e){let t=n.resolve(!1);for(let i of e)t=t.next(r=>r?n.resolve(r):i());return t}static forEach(e,t){let i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new n((i,r)=>{let s=e.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let u=c;t(e[u]).next(d=>{o[u]=d,++a,a===s&&i(o)},d=>r(d))}})}static doWhile(e,t){return new n((i,r)=>{let s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}};var wc=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new qe,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new zi(e,t.error)):this.V.resolve()},this.transaction.onerror=i=>{let r=Lm(i.target.error);this.V.reject(new zi(e,r))}}static open(e,t,i,r){try{return new n(t,e.transaction(r,i))}catch(s){throw new zi(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(V("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Wf(t)}},ai=class n{constructor(e,t,i){this.name=e,this.version=t,this.p=i,n.S(Zs())===12.2&&Re("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return V("SimpleDb","Removing database:",e),Bi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!sl())return!1;if(n.v())return!0;let e=Zs(),t=n.S(e),i=0<t&&t<10,r=lE(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}M(e){return k(this,null,function*(){return this.db||(V("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,i)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{let o=s.target.result;t(o)},r.onblocked=()=>{i(new zi(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{let o=s.target.error;o.name==="VersionError"?i(new D(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new D(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new zi(e,o))},r.onupgradeneeded=s=>{V("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,r.transaction,s.oldVersion,this.version).next(()=>{V("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,i,r){return k(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=wc.open(this.db,e,s?"readonly":"readwrite",i),c=r(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),b.reject(u))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(V("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function lE(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var zf=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Bi(this.B.delete())}},zi=class extends D{constructor(e,t){super(P.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function _i(n){return n.name==="IndexedDbTransactionError"}var Wf=class{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(V("SimpleDb","PUT",this.store.name,e,t),i=this.store.put(t,e)):(V("SimpleDb","PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),Bi(i)}add(e){return V("SimpleDb","ADD",this.store.name,e,e),Bi(this.store.add(e))}get(e){return Bi(this.store.get(e)).next(t=>(t===void 0&&(t=null),V("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return V("SimpleDb","DELETE",this.store.name,e),Bi(this.store.delete(e))}count(){return V("SimpleDb","COUNT",this.store.name),Bi(this.store.count())}U(e,t){let i=this.options(e,t),r=i.index?this.store.index(i.index):this.store;if(typeof r.getAll=="function"){let s=r.getAll(i.range);return new b((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(i),o=[];return this.W(s,(a,c)=>{o.push(c)}).next(()=>o)}}G(e,t){let i=this.store.getAll(e,t===null?void 0:t);return new b((r,s)=>{i.onerror=o=>{s(o.target.error)},i.onsuccess=o=>{r(o.target.result)}})}j(e,t){V("SimpleDb","DELETE ALL",this.store.name);let i=this.options(e,t);i.H=!1;let r=this.cursor(i);return this.W(r,(s,o,a)=>a.delete())}J(e,t){let i;t?i=e:(i={},t=e);let r=this.cursor(i);return this.W(r,t)}Y(e){let t=this.cursor({});return new b((i,r)=>{t.onerror=s=>{let o=Lm(s.target.error);r(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():i()}):i()}})}W(e,t){let i=[];return new b((r,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void r();let c=new zf(a),u=t(a.primaryKey,a.value,c);if(u instanceof b){let d=u.catch(p=>(c.done(),b.reject(p)));i.push(d)}c.isDone?r():c.K===null?a.continue():a.continue(c.K)}}).next(()=>b.waitFor(i))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let i=this.store.index(e.index);return e.H?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Bi(n){return new b((e,t)=>{n.onsuccess=i=>{let r=i.target.result;e(r)},n.onerror=i=>{let r=Lm(i.target.error);t(r)}})}var eT=!1;function Lm(n){let e=ai.S(Zs());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let i=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return eT||(eT=!0,setTimeout(()=>{throw i},0)),i}}return n}var $f=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){V("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>k(this,null,function*(){this.task=null;try{V("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){_i(t)?V("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield gi(t)}yield this.X(6e4)}))}},Qf=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return k(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let i=new Set,r=t,s=!0;return b.doWhile(()=>s===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!i.has(o))return V("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,r).next(a=>{r-=a,i.add(o)});s=!1})).next(()=>t-r)}ne(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(r,s)).next(a=>(V("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let i=e;return t.changes.forEach((r,s)=>{let o=oE(s);Fm(o,i)>0&&(i=o)}),new xt(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Et=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.ie(r),this.se=r=>i.writeSequenceNumber(r))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function Aa(n){return n==null}function ra(n){return n===0&&1/n==-1/0}function cE(n){return typeof n=="number"&&Number.isInteger(n)&&!ra(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function lt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=tT(e)),e=aR(n.get(t),e);return tT(e)}function aR(n,e){let t=e,i=n.length;for(let r=0;r<i;r++){let s=n.charAt(r);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function tT(n){return n+""}function en(n){let e=n.length;if(G(e>=2),e===2)return G(n.charAt(0)===""&&n.charAt(1)===""),se.emptyPath();let t=e-2,i=[],r="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&B(),n.charAt(o+1)){case"":let a=n.substring(s,o),c;r.length===0?c=a:(r+=a,c=r,r=""),i.push(c);break;case"":r+=n.substring(s,o),r+="\0";break;case"":r+=n.substring(s,o+1);break;default:B()}s=o+2}return new se(i)}var nT=["userId","batchId"];function hc(n,e){return[n,lt(e)]}function uE(n,e,t){return[n,lt(e),t]}var lR={},cR=["prefixPath","collectionGroup","readTime","documentId"],uR=["prefixPath","collectionGroup","documentId"],hR=["collectionGroup","readTime","prefixPath","documentId"],dR=["canonicalId","targetId"],fR=["targetId","path"],pR=["path","targetId"],mR=["collectionId","parent"],gR=["indexId","uid"],_R=["uid","sequenceNumber"],yR=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],vR=["indexId","uid","orderedDocumentKey"],wR=["userId","collectionPath","documentId"],TR=["userId","collectionPath","largestBatchId"],ER=["userId","collectionGroup","largestBatchId"],hE=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],IR=[...hE,"documentOverlays"],dE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],fE=dE,Um=[...fE,"indexConfiguration","indexState","indexEntries"],AR=Um,CR=[...Um,"globals"];var sa=class extends vc{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function je(n,e){let t=L(n);return ai.F(t._e,e)}function iT(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ir(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function pE(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var _e=class n{constructor(e,t){this.comparator=e,this.root=t||nn.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nn.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){let r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){let e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Qr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Qr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Qr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Qr(this.root,e,this.comparator,!0)}},Qr=class{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},nn=class n{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i??n.RED,this.left=r??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new n(e??this.key,t??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this,s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return n.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw B();let e=this.left.check();if(e!==this.right.check())throw B();return e+(this.isRed()?0:1)}};nn.EMPTY=null,nn.RED=!0,nn.BLACK=!1;nn.EMPTY=new class{constructor(){this.size=0}get key(){throw B()}get value(){throw B()}get color(){throw B()}get left(){throw B()}get right(){throw B()}copy(e,t,i,r,s){return this}insert(e,t,i){return new nn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var fe=class n{constructor(e){this.comparator=e,this.data=new _e(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){let i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){let r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Tc(this.data.getIterator())}getIteratorFrom(e){return new Tc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Tc=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Ur(n){return n.hasNext()?n.getNext():void 0}var It=class n{constructor(e){this.fields=e,e.sort(Pe.comparator)}static empty(){return new n([])}unionWith(e){let t=new fe(Pe.comparator);for(let i of this.fields)t=t.add(i);for(let i of e)t=t.add(i);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Xr(this.fields,e.fields,(t,i)=>t.isEqual(i))}};var Ec=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function mE(){return typeof atob<"u"}var ke=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ec("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(r){let s="";for(let o=0;o<r.length;++o)s+=String.fromCharCode(r[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ke.EMPTY_BYTE_STRING=new ke("");var SR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Cn(n){if(G(!!n),typeof n=="string"){let e=0,t=SR.exec(n);if(G(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}let i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ve(n.seconds),nanos:ve(n.nanos)}}function ve(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function li(n){return typeof n=="string"?ke.fromBase64String(n):ke.fromUint8Array(n)}function fu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Bm(n){let e=n.mapValue.fields.__previous_value__;return fu(e)?Bm(e):e}function oa(n){let e=Cn(n.mapValue.fields.__local_write_time__.timestampValue);return new Te(e.seconds,e.nanos)}var Hf=class{constructor(e,t,i,r,s,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},ci=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var ri={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},dc={nullValue:"NULL_VALUE"};function Wi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?fu(n)?4:gE(n)?9007199254740991:pu(n)?10:11:B()}function on(n,e){if(n===e)return!0;let t=Wi(n);if(t!==Wi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return oa(n).isEqual(oa(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;let o=Cn(r.timestampValue),a=Cn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,s){return li(r.bytesValue).isEqual(li(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return ve(r.geoPointValue.latitude)===ve(s.geoPointValue.latitude)&&ve(r.geoPointValue.longitude)===ve(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return ve(r.integerValue)===ve(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){let o=ve(r.doubleValue),a=ve(s.doubleValue);return o===a?ra(o)===ra(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Xr(n.arrayValue.values||[],e.arrayValue.values||[],on);case 10:case 11:return function(r,s){let o=r.mapValue.fields||{},a=s.mapValue.fields||{};if(iT(o)!==iT(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!on(o[c],a[c])))return!1;return!0}(n,e);default:return B()}}function aa(n,e){return(n.values||[]).find(t=>on(t,e))!==void 0}function ui(n,e){if(n===e)return 0;let t=Wi(n),i=Wi(e);if(t!==i)return Q(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=ve(s.integerValue||s.doubleValue),c=ve(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return rT(n.timestampValue,e.timestampValue);case 4:return rT(oa(n),oa(e));case 5:return Q(n.stringValue,e.stringValue);case 6:return function(s,o){let a=li(s),c=li(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let d=Q(a[u],c[u]);if(d!==0)return d}return Q(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=Q(ve(s.latitude),ve(o.latitude));return a!==0?a:Q(ve(s.longitude),ve(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return sT(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,c,u,d;let p=s.fields||{},m=o.fields||{},y=(a=p.value)===null||a===void 0?void 0:a.arrayValue,C=(c=m.value)===null||c===void 0?void 0:c.arrayValue,x=Q(((u=y?.values)===null||u===void 0?void 0:u.length)||0,((d=C?.values)===null||d===void 0?void 0:d.length)||0);return x!==0?x:sT(y,C)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===ri.mapValue&&o===ri.mapValue)return 0;if(s===ri.mapValue)return 1;if(o===ri.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),u=o.fields||{},d=Object.keys(u);c.sort(),d.sort();for(let p=0;p<c.length&&p<d.length;++p){let m=Q(c[p],d[p]);if(m!==0)return m;let y=ui(a[c[p]],u[d[p]]);if(y!==0)return y}return Q(c.length,d.length)}(n.mapValue,e.mapValue);default:throw B()}}function rT(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Q(n,e);let t=Cn(n),i=Cn(e),r=Q(t.seconds,i.seconds);return r!==0?r:Q(t.nanos,i.nanos)}function sT(n,e){let t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){let s=ui(t[r],i[r]);if(s)return s}return Q(t.length,i.length)}function es(n){return Yf(n)}function Yf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let i=Cn(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return li(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return U.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",r=!0;for(let s of t.values||[])r?r=!1:i+=",",i+=Yf(s);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){let i=Object.keys(t.fields||{}).sort(),r="{",s=!0;for(let o of i)s?s=!1:r+=",",r+=`${o}:${Yf(t.fields[o])}`;return r+"}"}(n.mapValue):B()}function $i(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Jf(n){return!!n&&"integerValue"in n}function la(n){return!!n&&"arrayValue"in n}function oT(n){return!!n&&"nullValue"in n}function aT(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function fc(n){return!!n&&"mapValue"in n}function pu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Xo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return ir(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=Xo(i)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Xo(n.arrayValue.values[t]);return e}return Object.assign({},n)}function gE(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var _E={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function bR(n){return"nullValue"in n?dc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?$i(ci.empty(),U.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?pu(n)?_E:{mapValue:{}}:B()}function RR(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?$i(ci.empty(),U.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?_E:"mapValue"in n?pu(n)?{mapValue:{}}:ri:B()}function lT(n,e){let t=ui(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function cT(n,e){let t=ui(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var tt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!fc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Xo(t)}setAll(e){let t=Pe.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let c=this.getFieldsMap(t);this.applyChanges(c,i,r),i={},r=[],t=a.popLast()}o?i[a.lastSegment()]=Xo(o):r.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){let t=this.field(e.popLast());fc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return on(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];fc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){ir(t,(r,s)=>e[r]=s);for(let r of i)delete e[r]}clone(){return new n(Xo(this.value))}};function yE(n){let e=[];return ir(n.fields,(t,i)=>{let r=new Pe([t]);if(fc(i)){let s=yE(i.mapValue).fields;if(s.length===0)e.push(r);else for(let o of s)e.push(r.child(o))}else e.push(r)}),new It(e)}var Fe=class n{constructor(e,t,i,r,s,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,z.min(),z.min(),z.min(),tt.empty(),0)}static newFoundDocument(e,t,i,r){return new n(e,1,t,z.min(),i,r,0)}static newNoDocument(e,t){return new n(e,2,t,z.min(),z.min(),tt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,z.min(),z.min(),tt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=tt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=tt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var an=class{constructor(e,t){this.position=e,this.inclusive=t}};function uT(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){let s=e[r],o=n.position[r];if(s.field.isKeyField()?i=U.comparator(U.fromName(o.referenceValue),t.key):i=ui(o,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function hT(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!on(n.position[t],e.position[t]))return!1;return!0}var Qi=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function PR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Ic=class{},ie=class n extends Ic{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new ep(e,t,i):t==="array-contains"?new ip(e,i):t==="in"?new Ac(e,i):t==="not-in"?new rp(e,i):t==="array-contains-any"?new sp(e,i):new n(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new tp(e,i):new np(e,i)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ui(t,this.value)):t!==null&&Wi(this.value)===Wi(t)&&this.matchesComparison(ui(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return B()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ue=class n extends Ic{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return ts(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function ts(n){return n.op==="and"}function Xf(n){return n.op==="or"}function qm(n){return vE(n)&&ts(n)}function vE(n){for(let e of n.filters)if(e instanceof ue)return!1;return!0}function Zf(n){if(n instanceof ie)return n.field.canonicalString()+n.op.toString()+es(n.value);if(qm(n))return n.filters.map(e=>Zf(e)).join(",");{let e=n.filters.map(t=>Zf(t)).join(",");return`${n.op}(${e})`}}function wE(n,e){return n instanceof ie?function(i,r){return r instanceof ie&&i.op===r.op&&i.field.isEqual(r.field)&&on(i.value,r.value)}(n,e):n instanceof ue?function(i,r){return r instanceof ue&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,o,a)=>s&&wE(o,r.filters[a]),!0):!1}(n,e):void B()}function TE(n,e){let t=n.filters.concat(e);return ue.create(t,n.op)}function EE(n){return n instanceof ie?function(t){return`${t.field.canonicalString()} ${t.op} ${es(t.value)}`}(n):n instanceof ue?function(t){return t.op.toString()+" {"+t.getFilters().map(EE).join(" ,")+"}"}(n):"Filter"}var ep=class extends ie{constructor(e,t,i){super(e,t,i),this.key=U.fromName(i.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},tp=class extends ie{constructor(e,t){super(e,"in",t),this.keys=IE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},np=class extends ie{constructor(e,t){super(e,"not-in",t),this.keys=IE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function IE(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>U.fromName(i.referenceValue))}var ip=class extends ie{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return la(t)&&aa(t.arrayValue,this.value)}},Ac=class extends ie{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&aa(this.value.arrayValue,t)}},rp=class extends ie{constructor(e,t){super(e,"not-in",t)}matches(e){if(aa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!aa(this.value.arrayValue,t)}},sp=class extends ie{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!la(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>aa(this.value.arrayValue,i))}};var op=class{constructor(e,t=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function ap(n,e=null,t=[],i=[],r=null,s=null,o=null){return new op(n,e,t,i,r,s,o)}function Hi(n){let e=L(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>Zf(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),Aa(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>es(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>es(i)).join(",")),e.ue=t}return e.ue}function Ca(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!PR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!wE(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!hT(n.startAt,e.startAt)&&hT(n.endAt,e.endAt)}function Cc(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Sc(n,e){return n.filters.filter(t=>t instanceof ie&&t.field.isEqual(e))}function dT(n,e,t){let i=dc,r=!0;for(let s of Sc(n,e)){let o=dc,a=!0;switch(s.op){case"<":case"<=":o=bR(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=dc}lT({value:i,inclusive:r},{value:o,inclusive:a})<0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];lT({value:i,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(i=o,r=t.inclusive);break}}return{value:i,inclusive:r}}function fT(n,e,t){let i=ri,r=!0;for(let s of Sc(n,e)){let o=ri,a=!0;switch(s.op){case">=":case">":o=RR(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=ri}cT({value:i,inclusive:r},{value:o,inclusive:a})>0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];cT({value:i,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(i=o,r=t.inclusive);break}}return{value:i,inclusive:r}}var Bt=class{constructor(e,t=null,i=[],r=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function AE(n,e,t,i,r,s,o,a){return new Bt(n,e,t,i,r,s,o,a)}function gs(n){return new Bt(n)}function pT(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function jm(n){return n.collectionGroup!==null}function Yr(n){let e=L(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new fe(Pe.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Qi(s,i))}),t.has(Pe.keyField().canonicalString())||e.ce.push(new Qi(Pe.keyField(),i))}return e.ce}function ct(n){let e=L(n);return e.le||(e.le=xR(e,Yr(n))),e.le}function xR(n,e){if(n.limitType==="F")return ap(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new Qi(r.field,s)});let t=n.endAt?new an(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new an(n.startAt.position,n.startAt.inclusive):null;return ap(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function lp(n,e){let t=n.filters.concat([e]);return new Bt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function bc(n,e,t){return new Bt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Sa(n,e){return Ca(ct(n),ct(e))&&n.limitType===e.limitType}function CE(n){return`${Hi(ct(n))}|lt:${n.limitType}`}function Kr(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(r=>EE(r)).join(", ")}]`),Aa(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(r=>es(r)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(r=>es(r)).join(",")),`Target(${i})`}(ct(n))}; limitType=${n.limitType})`}function ba(n,e){return e.isFoundDocument()&&function(i,r){let s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):U.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(n,e)&&function(i,r){for(let s of Yr(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(n,e)&&function(i,r){for(let s of i.filters)if(!s.matches(r))return!1;return!0}(n,e)&&function(i,r){return!(i.startAt&&!function(o,a,c){let u=uT(o,a,c);return o.inclusive?u<=0:u<0}(i.startAt,Yr(i),r)||i.endAt&&!function(o,a,c){let u=uT(o,a,c);return o.inclusive?u>=0:u>0}(i.endAt,Yr(i),r))}(n,e)}function SE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function bE(n){return(e,t)=>{let i=!1;for(let r of Yr(n)){let s=kR(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function kR(n,e,t){let i=n.field.isKeyField()?U.comparator(e.key,t.key):function(s,o,a){let c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?ui(c,u):B()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return B()}}var ln=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(let[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ir(this.inner,(t,i)=>{for(let[r,s]of i)e(r,s)})}isEmpty(){return pE(this.inner)}size(){return this.innerSize}};var NR=new _e(U.comparator);function ft(){return NR}var RE=new _e(U.comparator);function Yo(...n){let e=RE;for(let t of n)e=e.insert(t.key,t);return e}function PE(n){let e=RE;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function tn(){return Zo()}function xE(){return Zo()}function Zo(){return new ln(n=>n.toString(),(n,e)=>n.isEqual(e))}var DR=new _e(U.comparator),VR=new fe(U.comparator);function X(...n){let e=VR;for(let t of n)e=e.add(t);return e}var OR=new fe(Q);function Gm(){return OR}function Km(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ra(e)?"-0":e}}function kE(n){return{integerValue:""+n}}function NE(n,e){return cE(e)?kE(e):Km(n,e)}var ns=class{constructor(){this._=void 0}};function MR(n,e,t){return n instanceof hi?function(r,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&fu(s)&&(s=Bm(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Sn?VE(n,e):n instanceof bn?OE(n,e):function(r,s){let o=DE(r,s),a=mT(o)+mT(r.Pe);return Jf(o)&&Jf(r.Pe)?kE(a):Km(r.serializer,a)}(n,e)}function FR(n,e,t){return n instanceof Sn?VE(n,e):n instanceof bn?OE(n,e):t}function DE(n,e){return n instanceof di?function(i){return Jf(i)||function(s){return!!s&&"doubleValue"in s}(i)}(e)?e:{integerValue:0}:null}var hi=class extends ns{},Sn=class extends ns{constructor(e){super(),this.elements=e}};function VE(n,e){let t=ME(e);for(let i of n.elements)t.some(r=>on(r,i))||t.push(i);return{arrayValue:{values:t}}}var bn=class extends ns{constructor(e){super(),this.elements=e}};function OE(n,e){let t=ME(e);for(let i of n.elements)t=t.filter(r=>!on(r,i));return{arrayValue:{values:t}}}var di=class extends ns{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function mT(n){return ve(n.integerValue||n.doubleValue)}function ME(n){return la(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Yi=class{constructor(e,t){this.field=e,this.transform=t}};function LR(n,e){return n.field.isEqual(e.field)&&function(i,r){return i instanceof Sn&&r instanceof Sn||i instanceof bn&&r instanceof bn?Xr(i.elements,r.elements,on):i instanceof di&&r instanceof di?on(i.Pe,r.Pe):i instanceof hi&&r instanceof hi}(n.transform,e.transform)}var cp=class{constructor(e,t){this.version=e,this.transformResults=t}},Se=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function pc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var is=class{};function FE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new pi(n.key,Se.none()):new fi(n.key,n.data,Se.none());{let t=n.data,i=tt.empty(),r=new fe(Pe.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new qt(n.key,i,new It(r.toArray()),Se.none())}}function UR(n,e,t){n instanceof fi?function(r,s,o){let a=r.value.clone(),c=_T(r.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof qt?function(r,s,o){if(!pc(r.precondition,s))return void s.convertToUnknownDocument(o.version);let a=_T(r.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(LE(r)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(r,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function ea(n,e,t,i){return n instanceof fi?function(s,o,a,c){if(!pc(s.precondition,o))return a;let u=s.value.clone(),d=yT(s.fieldTransforms,c,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,i):n instanceof qt?function(s,o,a,c){if(!pc(s.precondition,o))return a;let u=yT(s.fieldTransforms,c,o),d=o.data;return d.setAll(LE(s)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(n,e,t,i):function(s,o,a){return pc(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function BR(n,e){let t=null;for(let i of n.fieldTransforms){let r=e.data.field(i.field),s=DE(i.transform,r||null);s!=null&&(t===null&&(t=tt.empty()),t.set(i.field,s))}return t||null}function gT(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&Xr(i,r,(s,o)=>LR(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var fi=class extends is{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}},qt=class extends is{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function LE(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let i=n.data.field(t);e.set(t,i)}}),e}function _T(n,e,t){let i=new Map;G(n.length===t.length);for(let r=0;r<t.length;r++){let s=n[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,FR(o,a,t[r]))}return i}function yT(n,e,t){let i=new Map;for(let r of n){let s=r.transform,o=t.data.field(r.field);i.set(r.field,MR(s,o,e))}return i}var pi=class extends is{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ca=class extends is{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ua=class{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){let i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];s.key.isEqual(e.key)&&UR(s,e,i[r])}}applyToLocalView(e,t){for(let i of this.baseMutations)i.key.isEqual(e.key)&&(t=ea(i,e,t,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(e.key)&&(t=ea(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let i=xE();return this.mutations.forEach(r=>{let s=e.get(r.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(r.key)?null:a;let c=FE(o,a);c!==null&&i.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(z.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),X())}isEqual(e){return this.batchId===e.batchId&&Xr(this.mutations,e.mutations,(t,i)=>gT(t,i))&&Xr(this.baseMutations,e.baseMutations,(t,i)=>gT(t,i))}},up=class n{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){G(e.mutations.length===i.length);let r=function(){return DR}(),s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new n(e,t,i,r)}};var ha=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var hp=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ve,re;function UE(n){switch(n){default:return B();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function BE(n){if(n===void 0)return Re("GRPC error has no .code"),P.UNKNOWN;switch(n){case Ve.OK:return P.OK;case Ve.CANCELLED:return P.CANCELLED;case Ve.UNKNOWN:return P.UNKNOWN;case Ve.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case Ve.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case Ve.INTERNAL:return P.INTERNAL;case Ve.UNAVAILABLE:return P.UNAVAILABLE;case Ve.UNAUTHENTICATED:return P.UNAUTHENTICATED;case Ve.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case Ve.NOT_FOUND:return P.NOT_FOUND;case Ve.ALREADY_EXISTS:return P.ALREADY_EXISTS;case Ve.PERMISSION_DENIED:return P.PERMISSION_DENIED;case Ve.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case Ve.ABORTED:return P.ABORTED;case Ve.OUT_OF_RANGE:return P.OUT_OF_RANGE;case Ve.UNIMPLEMENTED:return P.UNIMPLEMENTED;case Ve.DATA_LOSS:return P.DATA_LOSS;default:return B()}}(re=Ve||(Ve={}))[re.OK=0]="OK",re[re.CANCELLED=1]="CANCELLED",re[re.UNKNOWN=2]="UNKNOWN",re[re.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",re[re.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",re[re.NOT_FOUND=5]="NOT_FOUND",re[re.ALREADY_EXISTS=6]="ALREADY_EXISTS",re[re.PERMISSION_DENIED=7]="PERMISSION_DENIED",re[re.UNAUTHENTICATED=16]="UNAUTHENTICATED",re[re.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",re[re.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",re[re.ABORTED=10]="ABORTED",re[re.OUT_OF_RANGE=11]="OUT_OF_RANGE",re[re.UNIMPLEMENTED=12]="UNIMPLEMENTED",re[re.INTERNAL=13]="INTERNAL",re[re.UNAVAILABLE=14]="UNAVAILABLE",re[re.DATA_LOSS=15]="DATA_LOSS";var vT=null;function qE(){return new TextEncoder}var qR=new Zn([4294967295,4294967295],0);function wT(n){let e=qE().encode(n),t=new Sf;return t.update(e),new Uint8Array(t.digest())}function TT(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Zn([t,i],0),new Zn([r,s],0)]}var dp=class n{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Ki(`Invalid padding: ${t}`);if(i<0)throw new Ki(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Ki(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Ki(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Zn.fromNumber(this.Ie)}Ee(e,t,i){let r=e.add(t.multiply(Zn.fromNumber(i)));return r.compare(qR)===1&&(r=new Zn([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=wT(e),[i,r]=TT(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(i,r,s);if(!this.de(o))return!1}return!0}static create(e,t,i){let r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,r,t);return i.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=wT(e),[i,r]=TT(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(i,r,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}},Ki=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var da=class n{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){let r=new Map;return r.set(e,fa.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new n(z.min(),r,new _e(Q),ft(),X())}},fa=class n{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new n(i,t,X(),X(),X())}};var Jr=class{constructor(e,t,i,r){this.Re=e,this.removedTargetIds=t,this.key=i,this.Ve=r}},Rc=class{constructor(e,t){this.targetId=e,this.me=t}},Pc=class{constructor(e,t,i=ke.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}},xc=class{constructor(){this.fe=0,this.ge=IT(),this.pe=ke.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=X(),t=X(),i=X();return this.ge.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:B()}}),new fa(this.pe,this.ye,e,t,i)}Ce(){this.we=!1,this.ge=IT()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,G(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},fp=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=ft(),this.qe=ET(),this.Qe=new _e(Q)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let i=this.Ge(t);switch(e.state){case 0:this.ze(t)&&i.De(e.resumeToken);break;case 1:i.Oe(),i.Se||i.Ce(),i.De(e.resumeToken);break;case 2:i.Oe(),i.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(i.Ne(),i.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),i.De(e.resumeToken));break;default:B()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((i,r)=>{this.ze(r)&&t(r)})}He(e){let t=e.targetId,i=e.me.count,r=this.Je(t);if(r){let s=r.target;if(Cc(s))if(i===0){let o=new U(s.path);this.Ue(t,o,Fe.newNoDocument(o,z.min()))}else G(i===1);else{let o=this.Ye(t);if(o!==i){let a=this.Ze(e),c=a?this.Xe(a,e,o):1;if(c!==0){this.je(t);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}vT?.et(function(d,p,m,y,C){var x,N,q,j,M,W;let H={localCacheCount:d,existenceFilterCount:p.count,databaseId:m.database,projectId:m.projectId},Y=p.unchangedNames;return Y&&(H.bloomFilter={applied:C===0,hashCount:(x=Y?.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(j=(q=(N=Y?.bits)===null||N===void 0?void 0:N.bitmap)===null||q===void 0?void 0:q.length)!==null&&j!==void 0?j:0,padding:(W=(M=Y?.bits)===null||M===void 0?void 0:M.padding)!==null&&W!==void 0?W:0,mightContain:T=>{var _;return(_=y?.mightContain(T))!==null&&_!==void 0&&_}}),H}(o,e.me,this.Le.tt(),a,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t,o,a;try{o=li(i).toUint8Array()}catch(c){if(c instanceof Ec)return Ut("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new dp(o,r,s)}catch(c){return Ut(c instanceof Ki?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Ie===0?null:a}Xe(e,t,i){return t.me.count===i-this.nt(e,t.targetId)?0:2}nt(e,t){let i=this.Le.getRemoteKeysForTarget(t),r=0;return i.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),r++)}),r}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&Cc(a.target)){let c=new U(a.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,Fe.newNoDocument(c,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let i=X();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.Je(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(i=i.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let r=new da(e,t,this.Qe,this.ke,i);return this.ke=ft(),this.qe=ET(),this.Qe=new _e(Q),r}$e(e,t){if(!this.ze(e))return;let i=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,i),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,i){if(!this.ze(e))return;let r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),i&&(this.ke=this.ke.insert(t,i))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new xc,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new fe(Q),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new xc),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function ET(){return new _e(U.comparator)}function IT(){return new _e(U.comparator)}var jR={asc:"ASCENDING",desc:"DESCENDING"},GR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},KR={and:"AND",or:"OR"},pp=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function mp(n,e){return n.useProto3Json||Aa(e)?e:{value:e}}function rs(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function jE(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function zR(n,e){return rs(n,e.toTimestamp())}function xe(n){return G(!!n),z.fromTimestamp(function(t){let i=Cn(t);return new Te(i.seconds,i.nanos)}(n))}function zm(n,e){return gp(n,e).canonicalString()}function gp(n,e){let t=function(r){return new se(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function GE(n){let e=se.fromString(n);return G(ZE(e)),e}function pa(n,e){return zm(n.databaseId,e.path)}function rn(n,e){let t=GE(e);if(t.get(1)!==n.databaseId.projectId)throw new D(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new U(WE(t))}function KE(n,e){return zm(n.databaseId,e)}function zE(n){let e=GE(n);return e.length===4?se.emptyPath():WE(e)}function _p(n){return new se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function WE(n){return G(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function AT(n,e,t){return{name:pa(n,e),fields:t.value.mapValue.fields}}function $E(n,e,t){let i=rn(n,e.name),r=xe(e.updateTime),s=e.createTime?xe(e.createTime):z.min(),o=new tt({mapValue:{fields:e.fields}}),a=Fe.newFoundDocument(i,r,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function WR(n,e){return"found"in e?function(i,r){G(!!r.found),r.found.name,r.found.updateTime;let s=rn(i,r.found.name),o=xe(r.found.updateTime),a=r.found.createTime?xe(r.found.createTime):z.min(),c=new tt({mapValue:{fields:r.found.fields}});return Fe.newFoundDocument(s,o,a,c)}(n,e):"missing"in e?function(i,r){G(!!r.missing),G(!!r.readTime);let s=rn(i,r.missing),o=xe(r.readTime);return Fe.newNoDocument(s,o)}(n,e):B()}function $R(n,e){let t;if("targetChange"in e){e.targetChange;let i=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:B()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(u,d){return u.useProto3Json?(G(d===void 0||typeof d=="string"),ke.fromBase64String(d||"")):(G(d===void 0||d instanceof Buffer||d instanceof Uint8Array),ke.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let d=u.code===void 0?P.UNKNOWN:BE(u.code);return new D(d,u.message||"")}(o);t=new Pc(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;let i=e.documentChange;i.document,i.document.name,i.document.updateTime;let r=rn(n,i.document.name),s=xe(i.document.updateTime),o=i.document.createTime?xe(i.document.createTime):z.min(),a=new tt({mapValue:{fields:i.document.fields}}),c=Fe.newFoundDocument(r,s,o,a),u=i.targetIds||[],d=i.removedTargetIds||[];t=new Jr(u,d,c.key,c)}else if("documentDelete"in e){e.documentDelete;let i=e.documentDelete;i.document;let r=rn(n,i.document),s=i.readTime?xe(i.readTime):z.min(),o=Fe.newNoDocument(r,s),a=i.removedTargetIds||[];t=new Jr([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let i=e.documentRemove;i.document;let r=rn(n,i.document),s=i.removedTargetIds||[];t=new Jr([],s,r,null)}else{if(!("filter"in e))return B();{e.filter;let i=e.filter;i.targetId;let{count:r=0,unchangedNames:s}=i,o=new hp(r,s),a=i.targetId;t=new Rc(a,o)}}return t}function ma(n,e){let t;if(e instanceof fi)t={update:AT(n,e.key,e.value)};else if(e instanceof pi)t={delete:pa(n,e.key)};else if(e instanceof qt)t={update:AT(n,e.key,e.data),updateMask:ZR(e.fieldMask)};else{if(!(e instanceof ca))return B();t={verify:pa(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(s,o){let a=o.transform;if(a instanceof hi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Sn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof bn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof di)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw B()}(0,i))),e.precondition.isNone||(t.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:zR(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:B()}(n,e.precondition)),t}function yp(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Se.updateTime(xe(s.updateTime)):s.exists!==void 0?Se.exists(s.exists):Se.none()}(e.currentDocument):Se.none(),i=e.updateTransforms?e.updateTransforms.map(r=>function(o,a){let c=null;if("setToServerValue"in a)G(a.setToServerValue==="REQUEST_TIME"),c=new hi;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];c=new Sn(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];c=new bn(d)}else"increment"in a?c=new di(o,a.increment):B();let u=Pe.fromServerFormat(a.fieldPath);return new Yi(u,c)}(n,r)):[];if(e.update){e.update.name;let r=rn(n,e.update.name),s=new tt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(c){let u=c.fieldPaths||[];return new It(u.map(d=>Pe.fromServerFormat(d)))}(e.updateMask);return new qt(r,s,o,t,i)}return new fi(r,s,t,i)}if(e.delete){let r=rn(n,e.delete);return new pi(r,t)}if(e.verify){let r=rn(n,e.verify);return new ca(r,t)}return B()}function QR(n,e){return n&&n.length>0?(G(e!==void 0),n.map(t=>function(r,s){let o=r.updateTime?xe(r.updateTime):xe(s);return o.isEqual(z.min())&&(o=xe(s)),new cp(o,r.transformResults||[])}(t,e))):[]}function QE(n,e){return{documents:[KE(n,e.path)]}}function HE(n,e){let t={structuredQuery:{}},i=e.path,r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=KE(n,r);let s=function(u){if(u.length!==0)return XE(ue.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(d=>function(m){return{field:zr(m.field),direction:YR(m.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=mp(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:r}}function YE(n){let e=zE(n.parent),t=n.structuredQuery,i=t.from?t.from.length:0,r=null;if(i>0){G(i===1);let d=t.from[0];d.allDescendants?r=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(p){let m=JE(p);return m instanceof ue&&qm(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(p){return p.map(m=>function(C){return new Qi(Wr(C.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(p){let m;return m=typeof p=="object"?p.value:p,Aa(m)?null:m}(t.limit));let c=null;t.startAt&&(c=function(p){let m=!!p.before,y=p.values||[];return new an(y,m)}(t.startAt));let u=null;return t.endAt&&(u=function(p){let m=!p.before,y=p.values||[];return new an(y,m)}(t.endAt)),AE(e,r,o,s,a,"F",c,u)}function HR(n,e){let t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function JE(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let i=Wr(t.unaryFilter.field);return ie.create(i,"==",{doubleValue:NaN});case"IS_NULL":let r=Wr(t.unaryFilter.field);return ie.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Wr(t.unaryFilter.field);return ie.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Wr(t.unaryFilter.field);return ie.create(o,"!=",{nullValue:"NULL_VALUE"});default:return B()}}(n):n.fieldFilter!==void 0?function(t){return ie.create(Wr(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return B()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ue.create(t.compositeFilter.filters.map(i=>JE(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return B()}}(t.compositeFilter.op))}(n):B()}function YR(n){return jR[n]}function JR(n){return GR[n]}function XR(n){return KR[n]}function zr(n){return{fieldPath:n.canonicalString()}}function Wr(n){return Pe.fromServerFormat(n.fieldPath)}function XE(n){return n instanceof ie?function(t){if(t.op==="=="){if(aT(t.value))return{unaryFilter:{field:zr(t.field),op:"IS_NAN"}};if(oT(t.value))return{unaryFilter:{field:zr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(aT(t.value))return{unaryFilter:{field:zr(t.field),op:"IS_NOT_NAN"}};if(oT(t.value))return{unaryFilter:{field:zr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zr(t.field),op:JR(t.op),value:t.value}}}(n):n instanceof ue?function(t){let i=t.getFilters().map(r=>XE(r));return i.length===1?i[0]:{compositeFilter:{op:XR(t.op),filters:i}}}(n):B()}function ZR(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ZE(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var ss=class n{constructor(e,t,i,r,s=z.min(),o=z.min(),a=ke.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var kc=class{constructor(e){this.ct=e}};function eP(n,e){let t;if(e.document)t=$E(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let i=U.fromSegments(e.noDocument.path),r=Xi(e.noDocument.readTime);t=Fe.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return B();{let i=U.fromSegments(e.unknownDocument.path),r=Xi(e.unknownDocument.version);t=Fe.newUnknownDocument(i,r)}}return e.readTime&&t.setReadTime(function(r){let s=new Te(r[0],r[1]);return z.fromTimestamp(s)}(e.readTime)),t}function CT(n,e){let t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Nc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=function(s,o){return{name:pa(s,o.key),fields:o.data.value.mapValue.fields,updateTime:rs(s,o.version.toTimestamp()),createTime:rs(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:Ji(e.version)};else{if(!e.isUnknownDocument())return B();i.unknownDocument={path:t.path.toArray(),version:Ji(e.version)}}return i}function Nc(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ji(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Xi(n){let e=new Te(n.seconds,n.nanoseconds);return z.fromTimestamp(e)}function qi(n,e){let t=(e.baseMutations||[]).map(s=>yp(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let i=e.mutations.map(s=>yp(n.ct,s)),r=Te.fromMillis(e.localWriteTimeMs);return new ua(e.batchId,r,t,i)}function Jo(n){let e=Xi(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Xi(n.lastLimboFreeSnapshotVersion):z.min(),i;return i=function(s){return s.documents!==void 0}(n.query)?function(s){return G(s.documents.length===1),ct(gs(zE(s.documents[0])))}(n.query):function(s){return ct(YE(s))}(n.query),new ss(i,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,ke.fromBase64String(n.resumeToken))}function eI(n,e){let t=Ji(e.snapshotVersion),i=Ji(e.lastLimboFreeSnapshotVersion),r;r=Cc(e.target)?QE(n.ct,e.target):HE(n.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Hi(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function Wm(n){let e=YE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?bc(e,e.limit,"L"):e}function Nf(n,e){return new ha(e.largestBatchId,yp(n.ct,e.overlayMutation))}function ST(n,e){let t=e.path.lastSegment();return[n,lt(e.path.popLast()),t]}function bT(n,e,t,i){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ji(i.readTime),documentKey:lt(i.documentKey.path),largestBatchId:i.largestBatchId}}var vp=class{getBundleMetadata(e,t){return RT(e).get(t).next(i=>{if(i)return function(s){return{id:s.bundleId,createTime:Xi(s.createTime),version:s.version}}(i)})}saveBundleMetadata(e,t){return RT(e).put(function(r){return{bundleId:r.id,createTime:Ji(xe(r.createTime)),version:r.version}}(t))}getNamedQuery(e,t){return PT(e).get(t).next(i=>{if(i)return function(s){return{name:s.name,query:Wm(s.bundledQuery),readTime:Xi(s.readTime)}}(i)})}saveNamedQuery(e,t){return PT(e).put(function(r){return{name:r.name,readTime:Ji(xe(r.readTime)),bundledQuery:r.bundledQuery}}(t))}};function RT(n){return je(n,"bundles")}function PT(n){return je(n,"namedQueries")}var Dc=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let i=t.uid||"";return new n(e,i)}getOverlay(e,t){return Wo(e).get(ST(this.userId,t)).next(i=>i?Nf(this.serializer,i):null)}getOverlays(e,t){let i=tn();return b.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){let r=[];return i.forEach((s,o)=>{let a=new ha(t,o);r.push(this.ht(e,a))}),b.waitFor(r)}removeOverlaysForBatchId(e,t,i){let r=new Set;t.forEach(o=>r.add(lt(o.getCollectionPath())));let s=[];return r.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);s.push(Wo(e).j("collectionPathOverlayIndex",a))}),b.waitFor(s)}getOverlaysForCollection(e,t,i){let r=tn(),s=lt(t),o=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Wo(e).U("collectionPathOverlayIndex",o).next(a=>{for(let c of a){let u=Nf(this.serializer,c);r.set(u.getKey(),u)}return r})}getOverlaysForCollectionGroup(e,t,i,r){let s=tn(),o,a=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Wo(e).J({index:"collectionGroupOverlayIndex",range:a},(c,u,d)=>{let p=Nf(this.serializer,u);s.size()<r||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):d.done()}).next(()=>s)}ht(e,t){return Wo(e).put(function(r,s,o){let[a,c,u]=ST(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:ma(r.ct,o.mutation)}}(this.serializer,this.userId,t))}};function Wo(n){return je(n,"documentOverlays")}var wp=class{Pt(e){return je(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let i=t?.value;return i?ke.fromUint8Array(i):ke.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var In=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(ve(e.integerValue));else if("doubleValue"in e){let i=ve(e.doubleValue);isNaN(i)?this.dt(t,13):(this.dt(t,15),ra(i)?t.At(0):t.At(i))}else if("timestampValue"in e){let i=e.timestampValue;this.dt(t,20),typeof i=="string"&&(i=Cn(i)),t.Rt(`${i.seconds||""}`),t.At(i.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(li(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let i=e.geoPointValue;this.dt(t,45),t.At(i.latitude||0),t.At(i.longitude||0)}else"mapValue"in e?gE(e)?this.dt(t,Number.MAX_SAFE_INTEGER):pu(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):B()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let i=e.fields||{};this.dt(t,55);for(let r of Object.keys(i))this.Vt(r,t),this.Tt(i[r],t)}wt(e,t){var i,r;let s=e.fields||{};this.dt(t,53);let o="value",a=((r=(i=s[o].arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.length)||0;this.dt(t,15),t.At(ve(a)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let i=e.values||[];this.dt(t,50);for(let r of i)this.Tt(r,t)}yt(e,t){this.dt(t,37),U.fromName(e).path.forEach(i=>{this.dt(t,60),this.Dt(i,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};In.vt=new In;function tP(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function xT(n){let e=64-function(i){let r=0;for(let s=0;s<8;++s){let o=tP(255&i[s]);if(r+=o,o!==8)break}return r}(n);return Math.ceil(e/8)}var Tp=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.Ft(i.value),i=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.Ot(i.value),i=t.next();this.Nt()}Lt(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.Ft(i);else if(i<2048)this.Ft(960|i>>>6),this.Ft(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i);else{let r=t.codePointAt(0);this.Ft(240|r>>>18),this.Ft(128|63&r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r)}}this.Mt()}Bt(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.Ot(i);else if(i<2048)this.Ot(960|i>>>6),this.Ot(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i);else{let r=t.codePointAt(0);this.Ot(240|r>>>18),this.Ot(128|63&r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r)}}this.Nt()}kt(e){let t=this.qt(e),i=xT(t);this.Qt(1+i),this.buffer[this.position++]=255&i;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Kt(e){let t=this.qt(e),i=xT(t);this.Qt(1+i),this.buffer[this.position++]=~(255&i);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),i=(128&t[0])!=0;t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);let r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}},Ep=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},Ip=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},ji=class{constructor(){this.jt=new Tp,this.Ht=new Ep(this.jt),this.Jt=new Ip(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var Gi=class n{constructor(e,t,i,r){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=r}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new n(this.indexId,this.documentKey,this.arrayValue,i)}};function ei(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=kT(n.arrayValue,e.arrayValue),t!==0?t:(t=kT(n.directionalValue,e.directionalValue),t!==0?t:U.comparator(n.documentKey,e.documentKey)))}function kT(n,e){for(let t=0;t<n.length&&t<e.length;++t){let i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}var Vc=class{constructor(e){this.Xt=new fe((t,i)=>Pe.comparator(t.field,i.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let i=t;i.isInequality()?this.Xt=this.Xt.add(i):this.tn.push(i)}}get nn(){return this.Xt.size>1}rn(e){if(G(e.collectionGroup===this.collectionId),this.nn)return!1;let t=Kf(e);if(t!==void 0&&!this.sn(t))return!1;let i=Ui(e),r=new Set,s=0,o=0;for(;s<i.length&&this.sn(i[s]);++s)r=r.add(i[s].fieldPath.canonicalString());if(s===i.length)return!0;if(this.Xt.size>0){let a=this.Xt.getIterator().getNext();if(!r.has(a.field.canonicalString())){let c=i[s];if(!this.on(a,c)||!this._n(this.en[o++],c))return!1}++s}for(;s<i.length;++s){let a=i[s];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new fe(Pe.comparator),t=[];for(let i of this.tn)if(!i.field.isKeyField())if(i.op==="array-contains"||i.op==="array-contains-any")t.push(new Hr(i.field,2));else{if(e.has(i.field))continue;e=e.add(i.field),t.push(new Hr(i.field,0))}for(let i of this.en)i.field.isKeyField()||e.has(i.field)||(e=e.add(i.field),t.push(new Hr(i.field,i.dir==="asc"?0:1)));return new Zr(Zr.UNKNOWN_ID,this.collectionId,t,ia.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let i=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===i}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function tI(n){var e,t;if(G(n instanceof ie||n instanceof ue),n instanceof ie){if(n instanceof Ac){let r=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ie.create(n.field,"==",s)))||[];return ue.create(r,"or")}return n}let i=n.filters.map(r=>tI(r));return ue.create(i,n.op)}function nP(n){if(n.getFilters().length===0)return[];let e=Sp(tI(n));return G(nI(e)),Ap(e)||Cp(e)?[e]:e.getFilters()}function Ap(n){return n instanceof ie}function Cp(n){return n instanceof ue&&qm(n)}function nI(n){return Ap(n)||Cp(n)||function(t){if(t instanceof ue&&Xf(t)){for(let i of t.getFilters())if(!Ap(i)&&!Cp(i))return!1;return!0}return!1}(n)}function Sp(n){if(G(n instanceof ie||n instanceof ue),n instanceof ie)return n;if(n.filters.length===1)return Sp(n.filters[0]);let e=n.filters.map(i=>Sp(i)),t=ue.create(e,n.op);return t=Oc(t),nI(t)?t:(G(t instanceof ue),G(ts(t)),G(t.filters.length>1),t.filters.reduce((i,r)=>$m(i,r)))}function $m(n,e){let t;return G(n instanceof ie||n instanceof ue),G(e instanceof ie||e instanceof ue),t=n instanceof ie?e instanceof ie?function(r,s){return ue.create([r,s],"and")}(n,e):NT(n,e):e instanceof ie?NT(e,n):function(r,s){if(G(r.filters.length>0&&s.filters.length>0),ts(r)&&ts(s))return TE(r,s.getFilters());let o=Xf(r)?r:s,a=Xf(r)?s:r,c=o.filters.map(u=>$m(u,a));return ue.create(c,"or")}(n,e),Oc(t)}function NT(n,e){if(ts(e))return TE(e,n.getFilters());{let t=e.filters.map(i=>$m(n,i));return ue.create(t,"or")}}function Oc(n){if(G(n instanceof ie||n instanceof ue),n instanceof ie)return n;let e=n.getFilters();if(e.length===1)return Oc(e[0]);if(vE(n))return n;let t=e.map(r=>Oc(r)),i=[];return t.forEach(r=>{r instanceof ie?i.push(r):r instanceof ue&&(r.op===n.op?i.push(...r.filters):i.push(r))}),i.length===1?i[0]:ue.create(i,n.op)}var bp=class{constructor(){this.un=new ga}addToCollectionParentIndex(e,t){return this.un.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(xt.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(xt.min())}updateCollectionGroup(e,t,i){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}},ga=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new fe(se.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new fe(se.comparator)).toArray()}};var ac=new Uint8Array(0),Rp=class{constructor(e,t){this.databaseId=t,this.cn=new ga,this.ln=new ln(i=>Hi(i),(i,r)=>Ca(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:i,parent:lt(r)};return DT(e).put(s)}return b.resolve()}getCollectionParents(e,t){let i=[],r=IDBKeyRange.bound([t,""],[rE(t),""],!1,!0);return DT(e).U(r).next(s=>{for(let o of s){if(o.collectionId!==t)break;i.push(en(o.parent))}return i})}addFieldIndex(e,t){let i=$o(e),r=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete r.indexId;let s=i.add(r);if(t.indexState){let o=qr(e);return s.next(a=>{o.put(bT(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let i=$o(e),r=qr(e),s=Br(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=$o(e),i=Br(e),r=qr(e);return t.j().next(()=>i.j()).next(()=>r.j())}createTargetIndexes(e,t){return b.forEach(this.hn(t),i=>this.getIndexType(e,i).next(r=>{if(r===0||r===1){let s=new Vc(i).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let i=Br(e),r=!0,s=new Map;return b.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{r&&(r=!!a),s.set(o,a)})).next(()=>{if(r){let o=X(),a=[];return b.forEach(s,(c,u)=>{V("IndexedDbIndexManager",`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(c)} to execute ${Hi(t)}`);let d=function(M,W){let H=Kf(W);if(H===void 0)return null;for(let Y of Sc(M,H.fieldPath))switch(Y.op){case"array-contains-any":return Y.value.arrayValue.values||[];case"array-contains":return[Y.value]}return null}(u,c),p=function(M,W){let H=new Map;for(let Y of Ui(W))for(let T of Sc(M,Y.fieldPath))switch(T.op){case"==":case"in":H.set(Y.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return H.set(Y.fieldPath.canonicalString(),T.value),Array.from(H.values())}return null}(u,c),m=function(M,W){let H=[],Y=!0;for(let T of Ui(W)){let _=T.kind===0?dT(M,T.fieldPath,M.startAt):fT(M,T.fieldPath,M.startAt);H.push(_.value),Y&&(Y=_.inclusive)}return new an(H,Y)}(u,c),y=function(M,W){let H=[],Y=!0;for(let T of Ui(W)){let _=T.kind===0?fT(M,T.fieldPath,M.endAt):dT(M,T.fieldPath,M.endAt);H.push(_.value),Y&&(Y=_.inclusive)}return new an(H,Y)}(u,c),C=this.In(c,u,m),x=this.In(c,u,y),N=this.Tn(c,u,p),q=this.En(c.indexId,d,C,m.inclusive,x,y.inclusive,N);return b.forEach(q,j=>i.G(j,t.limit).next(M=>{M.forEach(W=>{let H=U.fromSegments(W.documentKey);o.has(H)||(o=o.add(H),a.push(H))})}))}).next(()=>a)}return b.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=nP(ue.create(e.filters,"and")).map(i=>ap(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,i,r,s,o,a){let c=(t!=null?t.length:1)*Math.max(i.length,s.length),u=c/(t!=null?t.length:1),d=[];for(let p=0;p<c;++p){let m=t?this.dn(t[p/u]):ac,y=this.An(e,m,i[p%u],r),C=this.Rn(e,m,s[p%u],o),x=a.map(N=>this.An(e,m,N,!0));d.push(...this.createRange(y,C,x))}return d}An(e,t,i,r){let s=new Gi(e,U.empty(),t,i);return r?s:s.Zt()}Rn(e,t,i,r){let s=new Gi(e,U.empty(),t,i);return r?s.Zt():s}Pn(e,t){let i=new Vc(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let o=null;for(let a of s)i.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let i=2,r=this.hn(t);return b.forEach(r,s=>this.Pn(e,s).next(o=>{o?i!==0&&o.fields.length<function(c){let u=new fe(Pe.comparator),d=!1;for(let p of c.filters)for(let m of p.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?d=!0:u=u.add(m.field));for(let p of c.orderBy)p.field.isKeyField()||(u=u.add(p.field));return u.size+(d?1:0)}(s)&&(i=1):i=0})).next(()=>function(o){return o.limit!==null}(t)&&r.length>1&&i===2?1:i)}Vn(e,t){let i=new ji;for(let r of Ui(e)){let s=t.data.field(r.fieldPath);if(s==null)return null;let o=i.Yt(r.kind);In.vt.It(s,o)}return i.zt()}dn(e){let t=new ji;return In.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let i=new ji;return In.vt.It($i(this.databaseId,t),i.Yt(function(s){let o=Ui(s);return o.length===0?0:o[o.length-1].kind}(e))),i.zt()}Tn(e,t,i){if(i===null)return[];let r=[];r.push(new ji);let s=0;for(let o of Ui(e)){let a=i[s++];for(let c of r)if(this.fn(t,o.fieldPath)&&la(a))r=this.gn(r,o,a);else{let u=c.Yt(o.kind);In.vt.It(a,u)}}return this.pn(r)}In(e,t,i){return this.Tn(e,t,i.position)}pn(e){let t=[];for(let i=0;i<e.length;++i)t[i]=e[i].zt();return t}gn(e,t,i){let r=[...e],s=[];for(let o of i.arrayValue.values||[])for(let a of r){let c=new ji;c.seed(a.zt()),In.vt.It(o,c.Yt(t.kind)),s.push(c)}return s}fn(e,t){return!!e.filters.find(i=>i instanceof ie&&i.field.isEqual(t)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(e,t){let i=$o(e),r=qr(e);return(t?i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):i.U()).next(s=>{let o=[];return b.forEach(s,a=>r.get([a.indexId,this.uid]).next(c=>{o.push(function(d,p){let m=p?new ia(p.sequenceNumber,new xt(Xi(p.readTime),new U(en(p.documentKey)),p.largestBatchId)):ia.empty(),y=d.fields.map(([C,x])=>new Hr(Pe.fromServerFormat(C),x));return new Zr(d.indexId,d.collectionGroup,y,m)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((i,r)=>{let s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return s!==0?s:Q(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){let r=$o(e),s=qr(e);return this.yn(e).next(o=>r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>b.forEach(a,c=>s.put(bT(c.indexId,this.uid,o,i)))))}updateIndexEntries(e,t){let i=new Map;return b.forEach(t,(r,s)=>{let o=i.get(r.collectionGroup);return(o?b.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(a=>(i.set(r.collectionGroup,a),b.forEach(a,c=>this.wn(e,r,c).next(u=>{let d=this.Sn(s,c);return u.isEqual(d)?b.resolve():this.bn(e,s,c,u,d)}))))})}Dn(e,t,i,r){return Br(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.mn(i,t.key),documentKey:t.key.path.toArray()})}vn(e,t,i,r){return Br(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.mn(i,t.key),t.key.path.toArray()])}wn(e,t,i){let r=Br(e),s=new fe(ei);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([i.indexId,this.uid,this.mn(i,t)])},(o,a)=>{s=s.add(new Gi(i.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}Sn(e,t){let i=new fe(ei),r=this.Vn(t,e);if(r==null)return i;let s=Kf(t);if(s!=null){let o=e.data.field(s.fieldPath);if(la(o))for(let a of o.arrayValue.values||[])i=i.add(new Gi(t.indexId,e.key,this.dn(a),r))}else i=i.add(new Gi(t.indexId,e.key,ac,r));return i}bn(e,t,i,r,s){V("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(c,u,d,p,m){let y=c.getIterator(),C=u.getIterator(),x=Ur(y),N=Ur(C);for(;x||N;){let q=!1,j=!1;if(x&&N){let M=d(x,N);M<0?j=!0:M>0&&(q=!0)}else x!=null?j=!0:q=!0;q?(p(N),N=Ur(C)):j?(m(x),x=Ur(y)):(x=Ur(y),N=Ur(C))}}(r,s,ei,a=>{o.push(this.Dn(e,t,i,a))},a=>{o.push(this.vn(e,t,i,a))}),b.waitFor(o)}yn(e){let t=1;return qr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,r,s)=>{s.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((o,a)=>ei(o,a)).filter((o,a,c)=>!a||ei(o,c[a-1])!==0);let r=[];r.push(e);for(let o of i){let a=ei(o,e),c=ei(o,t);if(a===0)r[0]=e.Zt();else if(a>0&&c<0)r.push(o),r.push(o.Zt());else if(c>0)break}r.push(t);let s=[];for(let o=0;o<r.length;o+=2){if(this.Cn(r[o],r[o+1]))return[];let a=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,ac,[]],c=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,ac,[]];s.push(IDBKeyRange.bound(a,c))}return s}Cn(e,t){return ei(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(VT)}getMinOffset(e,t){return b.mapArray(this.hn(t),i=>this.Pn(e,i).next(r=>r||B())).next(VT)}};function DT(n){return je(n,"collectionParents")}function Br(n){return je(n,"indexEntries")}function $o(n){return je(n,"indexConfiguration")}function qr(n){return je(n,"indexState")}function VT(n){G(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){let r=n[i].indexState.offset;Fm(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new xt(e.readTime,e.documentKey,t)}var OT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pt=class n{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function iI(n,e,t){let i=n.store("mutations"),r=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,c=i.J({range:o},(d,p,m)=>(a++,m.delete()));s.push(c.next(()=>{G(a===1)}));let u=[];for(let d of t.mutations){let p=uE(e,d.key.path,t.batchId);s.push(r.delete(p)),u.push(d.key)}return b.waitFor(s).next(()=>u)}function Mc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw B();e=n.noDocument}return JSON.stringify(e).length}Pt.DEFAULT_COLLECTION_PERCENTILE=10,Pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pt.DEFAULT=new Pt(41943040,Pt.DEFAULT_COLLECTION_PERCENTILE,Pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pt.DISABLED=new Pt(-1,0,0);var Fc=class n{constructor(e,t,i,r){this.userId=e,this.serializer=t,this.indexManager=i,this.referenceDelegate=r,this.Fn={}}static lt(e,t,i,r){G(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,i,r)}checkEmpty(e){let t=!0,i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ti(e).J({index:"userMutationsIndex",range:i},(r,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,i,r){let s=$r(e),o=ti(e);return o.add({}).next(a=>{G(typeof a=="number");let c=new ua(a,t,i,r),u=function(y,C,x){let N=x.baseMutations.map(j=>ma(y.ct,j)),q=x.mutations.map(j=>ma(y.ct,j));return{userId:C,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:N,mutations:q}}(this.serializer,this.userId,c),d=[],p=new fe((m,y)=>Q(m.canonicalString(),y.canonicalString()));for(let m of r){let y=uE(this.userId,m.key.path,a);p=p.add(m.key.path.popLast()),d.push(o.put(u)),d.push(s.put(y,lR))}return p.forEach(m=>{d.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Fn[a]=c.keys()}),b.waitFor(d).next(()=>c)})}lookupMutationBatch(e,t){return ti(e).get(t).next(i=>i?(G(i.userId===this.userId),qi(this.serializer,i)):null)}Mn(e,t){return this.Fn[t]?b.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){let r=i.keys();return this.Fn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]),s=null;return ti(e).J({index:"userMutationsIndex",range:r},(o,a,c)=>{a.userId===this.userId&&(G(a.batchId>=i),s=qi(this.serializer,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),i=-1;return ti(e).J({index:"userMutationsIndex",range:t,reverse:!0},(r,s,o)=>{i=s.batchId,o.done()}).next(()=>i)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ti(e).U("userMutationsIndex",t).next(i=>i.map(r=>qi(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){let i=hc(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return $r(e).J({range:r},(o,a,c)=>{let[u,d,p]=o,m=en(d);if(u===this.userId&&t.path.isEqual(m))return ti(e).get(p).next(y=>{if(!y)throw B();G(y.userId===this.userId),s.push(qi(this.serializer,y))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new fe(Q),r=[];return t.forEach(s=>{let o=hc(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=$r(e).J({range:a},(u,d,p)=>{let[m,y,C]=u,x=en(y);m===this.userId&&s.path.isEqual(x)?i=i.add(C):p.done()});r.push(c)}),b.waitFor(r).next(()=>this.xn(e,i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=hc(this.userId,i),o=IDBKeyRange.lowerBound(s),a=new fe(Q);return $r(e).J({range:o},(c,u,d)=>{let[p,m,y]=c,C=en(m);p===this.userId&&i.isPrefixOf(C)?C.length===r&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){let i=[],r=[];return t.forEach(s=>{r.push(ti(e).get(s).next(o=>{if(o===null)throw B();G(o.userId===this.userId),i.push(qi(this.serializer,o))}))}),b.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return iI(e._e,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),b.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return b.resolve();let i=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),r=[];return $r(e).J({range:i},(s,o,a)=>{if(s[0]===this.userId){let c=en(s[1]);r.push(c)}else a.done()}).next(()=>{G(r.length===0)})})}containsKey(e,t){return rI(e,this.userId,t)}Nn(e){return sI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function rI(n,e,t){let i=hc(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i),o=!1;return $r(n).J({range:s,H:!0},(a,c,u)=>{let[d,p,m]=a;d===e&&p===r&&(o=!0),u.done()}).next(()=>o)}function ti(n){return je(n,"mutations")}function $r(n){return je(n,"documentMutations")}function sI(n){return je(n,"mutationQueues")}var os=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var Pp=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let i=new os(t.highestTargetId);return t.highestTargetId=i.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>z.fromTimestamp(new Te(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.qn(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Qn(e,r)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(i=>(i.targetCount+=1,this.$n(t,i),this.Qn(e,i))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>jr(e).delete(t.targetId)).next(()=>this.qn(e)).next(i=>(G(i.targetCount>0),i.targetCount-=1,this.Qn(e,i)))}removeTargets(e,t,i){let r=0,s=[];return jr(e).J((o,a)=>{let c=Jo(a);c.sequenceNumber<=t&&i.get(c.targetId)===null&&(r++,s.push(this.removeTargetData(e,c)))}).next(()=>b.waitFor(s)).next(()=>r)}forEachTarget(e,t){return jr(e).J((i,r)=>{let s=Jo(r);t(s)})}qn(e){return MT(e).get("targetGlobalKey").next(t=>(G(t!==null),t))}Qn(e,t){return MT(e).put("targetGlobalKey",t)}Kn(e,t){return jr(e).put(eI(this.serializer,t))}$n(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let i=Hi(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]),s=null;return jr(e).J({range:r,index:"queryTargetsIndex"},(o,a,c)=>{let u=Jo(a);Ca(t,u.target)&&(s=u,c.done())}).next(()=>s)}addMatchingKeys(e,t,i){let r=[],s=ni(e);return t.forEach(o=>{let a=lt(o.path);r.push(s.put({targetId:i,path:a})),r.push(this.referenceDelegate.addReference(e,i,o))}),b.waitFor(r)}removeMatchingKeys(e,t,i){let r=ni(e);return b.forEach(t,s=>{let o=lt(s.path);return b.waitFor([r.delete([i,o]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){let i=ni(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){let i=IDBKeyRange.bound([t],[t+1],!1,!0),r=ni(e),s=X();return r.J({range:i,H:!0},(o,a,c)=>{let u=en(o[1]),d=new U(u);s=s.add(d)}).next(()=>s)}containsKey(e,t){let i=lt(t.path),r=IDBKeyRange.bound([i],[rE(i)],!1,!0),s=0;return ni(e).J({index:"documentTargetsIndex",H:!0,range:r},([o,a],c,u)=>{o!==0&&(s++,u.done())}).next(()=>s>0)}ot(e,t){return jr(e).get(t).next(i=>i?Jo(i):null)}};function jr(n){return je(n,"targets")}function MT(n){return je(n,"targetGlobal")}function ni(n){return je(n,"targetDocuments")}function FT([n,e],[t,i]){let r=Q(n,t);return r===0?Q(e,i):r}var xp=class{constructor(e){this.Un=e,this.buffer=new fe(FT),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let i=this.buffer.last();FT(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}},kp=class{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){V("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>k(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){_i(t)?V("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield gi(t)}yield this.Hn(3e5)}))}},Np=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return b.resolve(Et.oe);let i=new xp(t);return this.Jn.forEachTarget(e,r=>i.zn(r.sequenceNumber)).next(()=>this.Jn.Zn(e,r=>i.zn(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.Jn.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(OT)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),OT):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let i,r,s,o,a,c,u,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),r=this.params.maximumSequenceNumbersToCollect):r=p,o=Date.now(),this.nthSequenceNumber(e,r))).next(p=>(i=p,a=Date.now(),this.removeTargets(e,i,t))).next(p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(e,i))).next(p=>(u=Date.now(),Gr()<=Ct.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${s} targets in `+(c-a)+`ms
	Removed ${p} documents in `+(u-c)+`ms
Total Duration: ${u-d}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:p})))}};function iP(n,e){return new Np(n,e)}var Dp=class{constructor(e,t){this.db=e,this.garbageCollector=iP(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}er(e){let t=0;return this.Zn(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(i,r)=>t(r))}addReference(e,t,i){return lc(e,i)}removeReference(e,t,i){return lc(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return lc(e,t)}nr(e,t){return function(r,s){let o=!1;return sI(r).Y(a=>rI(r,a,s).next(c=>(c&&(o=!0),b.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],s=0;return this.tr(e,(o,a)=>{if(a<=t){let c=this.nr(e,o).next(u=>{if(!u)return s++,i.getEntry(e,o).next(()=>(i.removeEntry(o,z.min()),ni(e).delete(function(p){return[0,lt(p.path)]}(o))))});r.push(c)}}).next(()=>b.waitFor(r)).next(()=>i.apply(e)).next(()=>s)}removeTarget(e,t){let i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return lc(e,t)}tr(e,t){let i=ni(e),r,s=Et.oe;return i.J({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:u})=>{o===0?(s!==Et.oe&&t(new U(en(r)),s),s=u,r=c):s=Et.oe}).next(()=>{s!==Et.oe&&t(new U(en(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function lc(n,e){return ni(n).put(function(i,r){return{targetId:0,path:lt(i.path),sequenceNumber:r}}(e,n.currentSequenceNumber))}var Lc=class{constructor(){this.changes=new ln(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Fe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let i=this.changes.get(t);return i!==void 0?b.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Vp=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return Li(e).put(i)}removeEntry(e,t,i){return Li(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Nc(o),a[a.length-1]]}(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.rr(e,i)))}getEntry(e,t){let i=Fe.newInvalidDocument(t);return Li(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Qo(t))},(r,s)=>{i=this.ir(t,s)}).next(()=>i)}sr(e,t){let i={size:0,document:Fe.newInvalidDocument(t)};return Li(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Qo(t))},(r,s)=>{i={document:this.ir(t,s),size:Mc(s)}}).next(()=>i)}getEntries(e,t){let i=ft();return this._r(e,t,(r,s)=>{let o=this.ir(r,s);i=i.insert(r,o)}).next(()=>i)}ar(e,t){let i=ft(),r=new _e(U.comparator);return this._r(e,t,(s,o)=>{let a=this.ir(s,o);i=i.insert(s,a),r=r.insert(s,Mc(o))}).next(()=>({documents:i,ur:r}))}_r(e,t,i){if(t.isEmpty())return b.resolve();let r=new fe(BT);t.forEach(c=>r=r.add(c));let s=IDBKeyRange.bound(Qo(r.first()),Qo(r.last())),o=r.getIterator(),a=o.getNext();return Li(e).J({index:"documentKeyIndex",range:s},(c,u,d)=>{let p=U.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&BT(a,p)<0;)i(a,null),a=o.getNext();a&&a.isEqual(p)&&(i(a,u),a=o.hasNext()?o.getNext():null),a?d.$(Qo(a)):d.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,i,r,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Nc(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Li(e).U(IDBKeyRange.bound(a,c,!0)).next(u=>{s?.incrementDocumentReadCount(u.length);let d=ft();for(let p of u){let m=this.ir(U.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);m.isFoundDocument()&&(ba(t,m)||r.has(m.key))&&(d=d.insert(m.key,m))}return d})}getAllFromCollectionGroup(e,t,i,r){let s=ft(),o=UT(t,i),a=UT(t,xt.max());return Li(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,u,d)=>{let p=this.ir(U.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);s=s.insert(p.key,p),s.size===r&&d.done()}).next(()=>s)}newChangeBuffer(e){return new Op(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return LT(e).get("remoteDocumentGlobalKey").next(t=>(G(!!t),t))}rr(e,t){return LT(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let i=eP(this.serializer,t);if(!(i.isNoDocument()&&i.version.isEqual(z.min())))return i}return Fe.newInvalidDocument(e)}};function oI(n){return new Vp(n)}var Op=class extends Lc{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new ln(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){let t=[],i=0,r=new fe((s,o)=>Q(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,a.readTime)),o.isValidDocument()){let c=CT(this.cr.serializer,o);r=r.add(s.path.popLast());let u=Mc(c);i+=u-a.size,t.push(this.cr.addEntry(e,s,c))}else if(i-=a.size,this.trackRemovals){let c=CT(this.cr.serializer,o.convertToNoDocument(z.min()));t.push(this.cr.addEntry(e,s,c))}}),r.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,i)),b.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(i=>(this.lr.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:i,ur:r})=>(r.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:i.get(s).readTime})}),i))}};function LT(n){return je(n,"remoteDocumentGlobal")}function Li(n){return je(n,"remoteDocumentsV14")}function Qo(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function UT(n,e){let t=e.documentKey.path.toArray();return[n,Nc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function BT(n,e){let t=n.path.toArray(),i=e.path.toArray(),r=0;for(let s=0;s<t.length-2&&s<i.length-2;++s)if(r=Q(t[s],i[s]),r)return r;return r=Q(t.length,i.length),r||(r=Q(t[t.length-2],i[i.length-2]),r||Q(t[t.length-1],i[i.length-1]))}var Mp=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Uc=class{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&ea(i.mutation,r,It.empty(),Te.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,X()).next(()=>i))}getLocalViewOfDocuments(e,t,i=X()){let r=tn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let o=Yo();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let i=tn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,X()))}populateOverlays(e,t,i){let r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,r){let s=ft(),o=Zo(),a=function(){return Zo()}();return t.forEach((c,u)=>{let d=i.get(u.key);r.has(u.key)&&(d===void 0||d.mutation instanceof qt)?s=s.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),ea(d.mutation,u,d.mutation.getFieldMask(),Te.now())):o.set(u.key,It.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>{var p;return a.set(u,new Mp(d,(p=o.get(u))!==null&&p!==void 0?p:null))}),a))}recalculateAndSaveOverlays(e,t){let i=Zo(),r=new _e((o,a)=>o-a),s=X();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=t.get(c);if(u===null)return;let d=i.get(c)||It.empty();d=a.applyToLocalView(u,d),i.set(c,d);let p=(r.get(a.batchId)||X()).add(c);r=r.insert(a.batchId,p)})}).next(()=>{let o=[],a=r.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,d=c.value,p=xE();d.forEach(m=>{if(!s.has(m)){let y=FE(t.get(m),i.get(m));y!==null&&p.set(m,y),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,p))}return b.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return function(o){return U.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):jm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):b.resolve(tn()),a=-1,c=s;return o.next(u=>b.forEach(u,(d,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),s.get(d)?b.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{c=c.insert(d,m)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,c,u,X())).next(d=>({batchId:a,changes:PE(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(i=>{let r=Yo();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){let s=t.collectionGroup,o=Yo();return this.indexManager.getCollectionParents(e,s).next(a=>b.forEach(a,c=>{let u=function(p,m){return new Bt(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,i,r).next(d=>{d.forEach((p,m)=>{o=o.insert(p,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(o=>{s.forEach((c,u)=>{let d=u.getKey();o.get(d)===null&&(o=o.insert(d,Fe.newInvalidDocument(d)))});let a=Yo();return o.forEach((c,u)=>{let d=s.get(c);d!==void 0&&ea(d.mutation,u,It.empty(),Te.now()),ba(t,u)&&(a=a.insert(c,u))}),a})}};var Fp=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return b.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:xe(r.createTime)}}(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(r){return{name:r.name,query:Wm(r.bundledQuery),readTime:xe(r.readTime)}}(t)),b.resolve()}};var Lp=class{constructor(){this.overlays=new _e(U.comparator),this.Ir=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){let i=tn();return b.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.ht(e,t,s)}),b.resolve()}removeOverlaysForBatchId(e,t,i){let r=this.Ir.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(i)),b.resolve()}getOverlaysForCollection(e,t,i){let r=tn(),s=t.length+1,o=new U(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>i&&r.set(c.getKey(),c)}return b.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new _e((u,d)=>u-d),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>i){let d=s.get(u.largestBatchId);d===null&&(d=tn(),s=s.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}let a=tn(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=r)););return b.resolve(a)}ht(e,t,i){let r=this.overlays.get(i.key);if(r!==null){let o=this.Ir.get(r.largestBatchId).delete(i.key);this.Ir.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new ha(t,i));let s=this.Ir.get(t);s===void 0&&(s=X(),this.Ir.set(t,s)),this.Ir.set(t,s.add(i.key))}};var Up=class{constructor(){this.sessionToken=ke.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}};var _a=class{constructor(){this.Tr=new fe(Oe.Er),this.dr=new fe(Oe.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let i=new Oe(e,t);this.Tr=this.Tr.add(i),this.dr=this.dr.add(i)}Rr(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.Vr(new Oe(e,t))}mr(e,t){e.forEach(i=>this.removeReference(i,t))}gr(e){let t=new U(new se([])),i=new Oe(t,e),r=new Oe(t,e+1),s=[];return this.dr.forEachInRange([i,r],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new U(new se([])),i=new Oe(t,e),r=new Oe(t,e+1),s=X();return this.dr.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Oe(e,0),i=this.Tr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}},Oe=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return U.comparator(e.key,t.key)||Q(e.wr,t.wr)}static Ar(e,t){return Q(e.wr,t.wr)||U.comparator(e.key,t.key)}};var Bp=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new fe(Oe.Er)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new ua(s,t,i,r);this.mutationQueue.push(o);for(let a of r)this.br=this.br.add(new Oe(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=this.vr(i),s=r<0?0:r;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let i=new Oe(t,0),r=new Oe(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([i,r],o=>{let a=this.Dr(o.wr);s.push(a)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new fe(Q);return t.forEach(r=>{let s=new Oe(r,0),o=new Oe(r,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{i=i.add(a.wr)})}),b.resolve(this.Cr(i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=i;U.isDocumentKey(s)||(s=s.child(""));let o=new Oe(new U(s),0),a=new fe(Q);return this.br.forEachWhile(c=>{let u=c.key.path;return!!i.isPrefixOf(u)&&(u.length===r&&(a=a.add(c.wr)),!0)},o),b.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(i=>{let r=this.Dr(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){G(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.br;return b.forEach(t.mutations,r=>{let s=new Oe(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.br=i})}On(e){}containsKey(e,t){let i=new Oe(t,0),r=this.br.firstAfterOrEqual(i);return b.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var qp=class{constructor(e){this.Mr=e,this.docs=function(){return new _e(U.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.Mr(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let i=this.docs.get(t);return b.resolve(i?i.document.mutableCopy():Fe.newInvalidDocument(t))}getEntries(e,t){let i=ft();return t.forEach(r=>{let s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():Fe.newInvalidDocument(r))}),b.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=ft(),o=t.path,a=new U(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:d}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Fm(oE(d),i)<=0||(r.has(d.key)||ba(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(e,t,i,r){B()}Or(e,t){return b.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new jp(this)}getSize(e){return b.resolve(this.size)}},jp=class extends Lc{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(i)}),b.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var Gp=class{constructor(e){this.persistence=e,this.Nr=new ln(t=>Hi(t),Ca),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.Lr=0,this.Br=new _a,this.targetCount=0,this.kr=os.Bn()}forEachTarget(e,t){return this.Nr.forEach((i,r)=>t(r)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.Lr&&(this.Lr=t),b.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new os(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.Kn(t),b.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,i){let r=0,s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),b.waitFor(s).next(()=>r)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){let i=this.Nr.get(t)||null;return b.resolve(i)}addMatchingKeys(e,t,i){return this.Br.Rr(t,i),b.resolve()}removeMatchingKeys(e,t,i){this.Br.mr(t,i);let r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),b.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),b.resolve()}getMatchingKeysForTargetId(e,t){let i=this.Br.yr(t);return b.resolve(i)}containsKey(e,t){return b.resolve(this.Br.containsKey(t))}};var Bc=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Et(0),this.Kr=!1,this.Kr=!0,this.$r=new Up,this.referenceDelegate=e(this),this.Ur=new Gp(this),this.indexManager=new bp,this.remoteDocumentCache=function(r){return new qp(r)}(i=>this.referenceDelegate.Wr(i)),this.serializer=new kc(t),this.Gr=new Fp(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Lp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.qr[e.toKey()];return i||(i=new Bp(t,this.referenceDelegate),this.qr[e.toKey()]=i),i}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,i){V("MemoryPersistence","Starting transaction:",e);let r=new Kp(this.Qr.next());return this.referenceDelegate.zr(),i(r).next(s=>this.referenceDelegate.jr(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Hr(e,t){return b.or(Object.values(this.qr).map(i=>()=>i.containsKey(e,t)))}},Kp=class extends vc{constructor(e){super(),this.currentSequenceNumber=e}},qc=class n{constructor(e){this.persistence=e,this.Jr=new _a,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw B()}addReference(e,t,i){return this.Jr.addReference(i,t),this.Xr.delete(i.toString()),b.resolve()}removeReference(e,t,i){return this.Jr.removeReference(i,t),this.Xr.add(i.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),b.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(r=>this.Xr.add(r.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.Xr.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.Xr,i=>{let r=U.fromPath(i);return this.ei(e,r).next(s=>{s||t.removeEntry(r,z.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(i=>{i?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return b.or([()=>b.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var zp=class{constructor(e){this.serializer=e}O(e,t,i,r){let s=new wc("createOrUpgrade",t);i<1&&r>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",nT,{unique:!0}),c.createObjectStore("documentMutations")}(e),qT(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=b.resolve();return i<3&&r>=3&&(i!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),qT(e)),o=o.next(()=>function(c){let u=c.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",d)}(s))),i<4&&r>=4&&(i!==0&&(o=o.next(()=>function(c,u){return u.store("mutations").U().next(d=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",nT,{unique:!0});let p=u.store("mutations"),m=d.map(y=>p.put(y));return b.waitFor(m)})}(e,s))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),i<5&&r>=5&&(o=o.next(()=>this.ni(s))),i<6&&r>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),i<7&&r>=7&&(o=o.next(()=>this.ii(s))),i<8&&r>=8&&(o=o.next(()=>this.si(e,s))),i<9&&r>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),i<10&&r>=10&&(o=o.next(()=>this.oi(s))),i<11&&r>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),i<12&&r>=12&&(o=o.next(()=>{(function(c){let u=c.createObjectStore("documentOverlays",{keyPath:wR});u.createIndex("collectionPathOverlayIndex",TR,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",ER,{unique:!1})})(e)})),i<13&&r>=13&&(o=o.next(()=>function(c){let u=c.createObjectStore("remoteDocumentsV14",{keyPath:cR});u.createIndex("documentKeyIndex",uR),u.createIndex("collectionGroupIndex",hR)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),i<14&&r>=14&&(o=o.next(()=>this.ai(e,s))),i<15&&r>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:gR}).createIndex("sequenceNumberIndex",_R,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:yR}).createIndex("documentKeyIndex",vR,{unique:!1})}(e))),i<16&&r>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),i<17&&r>=17&&(o=o.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((i,r)=>{t+=Mc(r)}).next(()=>{let i={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",i)})}ni(e){let t=e.store("mutationQueues"),i=e.store("mutations");return t.U().next(r=>b.forEach(r,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.U("userMutationsIndex",o).next(a=>b.forEach(a,c=>{G(c.userId===s.userId);let u=qi(this.serializer,c);return iI(e,s.userId,u).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),i=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(r=>{let s=[];return i.J((o,a)=>{let c=new se(o),u=function(p){return[0,lt(p)]}(c);s.push(t.get(u).next(d=>d?b.resolve():(p=>t.put({targetId:0,path:lt(p),sequenceNumber:r.highestListenSequenceNumber}))(c)))}).next(()=>b.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:mR});let i=t.store("collectionParents"),r=new ga,s=o=>{if(r.add(o)){let a=o.lastSegment(),c=o.popLast();return i.put({collectionId:a,parent:lt(c)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let c=new se(o);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,c],u)=>{let d=en(a);return s(d.popLast())}))}oi(e){let t=e.store("targets");return t.J((i,r)=>{let s=Jo(r),o=eI(this.serializer,s);return t.put(o)})}_i(e,t){let i=t.store("remoteDocuments"),r=[];return i.J((s,o)=>{let a=t.store("remoteDocumentsV14"),c=function(p){return p.document?new U(se.fromString(p.document.name).popFirst(5)):p.noDocument?U.fromSegments(p.noDocument.path):p.unknownDocument?U.fromSegments(p.unknownDocument.path):B()}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(u))}).next(()=>b.waitFor(r))}ai(e,t){let i=t.store("mutations"),r=oI(this.serializer),s=new Bc(qc.Zr,this.serializer.ct);return i.U().next(o=>{let a=new Map;return o.forEach(c=>{var u;let d=(u=a.get(c.userId))!==null&&u!==void 0?u:X();qi(this.serializer,c).keys().forEach(p=>d=d.add(p)),a.set(c.userId,d)}),b.forEach(a,(c,u)=>{let d=new Me(u),p=Dc.lt(this.serializer,d),m=s.getIndexManager(d),y=Fc.lt(d,this.serializer,m,s.referenceDelegate);return new Uc(r,y,p,m).recalculateAndSaveOverlaysForDocumentKeys(new sa(t,Et.oe),c).next()})})}};function qT(n){n.createObjectStore("targetDocuments",{keyPath:fR}).createIndex("documentTargetsIndex",pR,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",dR,{unique:!0}),n.createObjectStore("targetGlobal")}var Df="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Wp=class n{constructor(e,t,i,r,s,o,a,c,u,d,p=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.ui=s,this.window=o,this.document=a,this.ci=u,this.li=d,this.hi=p,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=m=>Promise.resolve(),!n.D())throw new D(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Dp(this,r),this.Ai=t+"main",this.serializer=new kc(c),this.Ri=new ai(this.Ai,this.hi,new zp(this.serializer)),this.$r=new wp,this.Ur=new Pp(this.referenceDelegate,this.serializer),this.remoteDocumentCache=oI(this.serializer),this.Gr=new vp,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Re("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(P.FAILED_PRECONDITION,Df);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Et(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>k(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>k(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>k(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>cc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(_i(e))return V("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Ho(e).get("owner").next(t=>b.resolve(this.vi(t)))}Ci(e){return cc(e).delete(this.clientId)}Fi(){return k(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let i=je(t,"clientMetadata");return i.U().next(r=>{let s=this.xi(r,18e5),o=r.filter(a=>s.indexOf(a)===-1);return b.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?b.resolve(!0):Ho(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new D(P.FAILED_PRECONDITION,Df);return!1}}return!(!this.networkEnabled||!this.inForeground)||cc(e).U().next(i=>this.xi(i,5e3).find(r=>{if(this.clientId!==r.clientId){let s=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,a=this.networkEnabled===r.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&V("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return k(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new sa(e,Et.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(i=>this.Mi(i.updateTimeMs,t)&&!this.Ni(i.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>cc(e).U().next(t=>this.xi(t,18e5).map(i=>i.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Fc.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Rp(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Dc.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,i){V("IndexedDbPersistence","Starting transaction:",e);let r=t==="readonly"?"readonly":"readwrite",s=function(c){return c===17?CR:c===16?AR:c===15?Um:c===14?fE:c===13?dE:c===12?IR:c===11?hE:void B()}(this.hi),o;return this.Ri.runTransaction(e,r,s,a=>(o=new sa(a,this.Qr?this.Qr.next():Et.oe),t==="readwrite-primary"?this.wi(o).next(c=>!!c||this.Si(o)).next(c=>{if(!c)throw Re(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new D(P.FAILED_PRECONDITION,aE);return i(o)}).next(c=>this.Di(o).next(()=>c)):this.Ki(o).next(()=>i(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Ho(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(P.FAILED_PRECONDITION,Df)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ho(e).put("owner",t)}static D(){return ai.D()}bi(e){let t=Ho(e);return t.get("owner").next(i=>this.vi(i)?(V("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):b.resolve())}Mi(e,t){let i=Date.now();return!(e<i-t)&&(!(e>i)||(Re(`Detected an update time that is in the future: ${e} > ${i}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;_h()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let i=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return V("IndexedDbPersistence",`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return Re("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Re("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Ho(n){return je(n,"owner")}function cc(n){return je(n,"clientMetadata")}function Qm(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var $p=class n{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.$i=i,this.Ui=r}static Wi(e,t){let i=X(),r=X();for(let s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new n(e,t.fromCache,i,r)}};var Qp=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var jc=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return _h()?8:lE(Zs())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,i,r){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Qp;return this.Xi(e,t,o).next(a=>{if(s.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>s.result)}es(e,t,i,r){return i.documentReadCount<this.ji?(Gr()<=Ct.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",Kr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),b.resolve()):(Gr()<=Ct.DEBUG&&V("QueryEngine","Query:",Kr(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.Hi*r?(Gr()<=Ct.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",Kr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ct(t))):b.resolve())}Yi(e,t){if(pT(t))return b.resolve(null);let i=ct(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=bc(t,null,"F"),i=ct(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{let o=X(...s);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(c=>{let u=this.ts(t,a);return this.ns(t,u,o,c.readTime)?this.Yi(e,bc(t,null,"F")):this.rs(e,u,t,c)}))})))}Zi(e,t,i,r){return pT(t)||r.isEqual(z.min())?b.resolve(null):this.Ji.getDocuments(e,i).next(s=>{let o=this.ts(t,s);return this.ns(t,o,i,r)?b.resolve(null):(Gr()<=Ct.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Kr(t)),this.rs(e,o,t,sE(r,-1)).next(a=>a))})}ts(e,t){let i=new fe(bE(e));return t.forEach((r,s)=>{ba(e,s)&&(i=i.add(s))}),i}ns(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Xi(e,t,i){return Gr()<=Ct.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",Kr(t)),this.Ji.getDocumentsMatchingQuery(e,t,xt.min(),i)}rs(e,t,i,r){return this.Ji.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Hp=class{constructor(e,t,i,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new _e(Q),this._s=new ln(s=>Hi(s),Ca),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(i)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Uc(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function aI(n,e,t,i){return new Hp(n,e,t,i)}function lI(n,e){return k(this,null,function*(){let t=L(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.ls(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{let o=[],a=[],c=X();for(let u of r){o.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:a}))})})})}function rP(n,e){let t=L(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{let r=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,c,u,d){let p=u.batch,m=p.keys(),y=b.resolve();return m.forEach(C=>{y=y.next(()=>d.getEntry(c,C)).next(x=>{let N=u.docVersions.get(C);G(N!==null),x.version.compareTo(N)<0&&(p.applyToRemoteDocument(x,u),x.isValidDocument()&&(x.setReadTime(u.commitVersion),d.addEntry(x)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(c,p))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let c=X();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function cI(n){let e=L(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function sP(n,e){let t=L(n),i=e.snapshotVersion,r=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});r=t.os;let a=[];e.targetChanges.forEach((d,p)=>{let m=r.get(p);if(!m)return;a.push(t.Ur.removeMatchingKeys(s,d.removedDocuments,p).next(()=>t.Ur.addMatchingKeys(s,d.addedDocuments,p)));let y=m.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?y=y.withResumeToken(ke.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,i)),r=r.insert(p,y),function(x,N,q){return x.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(m,y,d)&&a.push(t.Ur.updateTargetData(s,y))});let c=ft(),u=X();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(uI(s,o,e.documentUpdates).next(d=>{c=d.Ps,u=d.Is})),!i.isEqual(z.min())){let d=t.Ur.getLastRemoteSnapshotVersion(s).next(p=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(d)}return b.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(t.os=r,s))}function uI(n,e,t){let i=X(),r=X();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let o=ft();return t.forEach((a,c)=>{let u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),c.isNoDocument()&&c.version.isEqual(z.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):V("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{Ps:o,Is:r}})}function oP(n,e){let t=L(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function as(n,e){let t=L(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.Ur.getTargetData(i,e).next(s=>s?(r=s,b.resolve(r)):t.Ur.allocateTargetId(i).next(o=>(r=new ss(e,o,"TargetPurposeListen",i.currentSequenceNumber),t.Ur.addTargetData(i,r).next(()=>r))))}).then(i=>{let r=t.os.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.os=t.os.insert(i.targetId,i),t._s.set(e,i.targetId)),i})}function ls(n,e,t){return k(this,null,function*(){let i=L(n),r=i.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!_i(o))throw o;V("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}i.os=i.os.remove(e),i._s.delete(r.target)})}function Gc(n,e,t){let i=L(n),r=z.min(),s=X();return i.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,d){let p=L(c),m=p._s.get(d);return m!==void 0?b.resolve(p.os.get(m)):p.Ur.getTargetData(u,d)}(i,o,ct(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.Ur.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>i.ss.getDocumentsMatchingQuery(o,e,t?r:z.min(),t?s:X())).next(a=>(fI(i,SE(e),a),{documents:a,Ts:s})))}function hI(n,e){let t=L(n),i=L(t.Ur),r=t.os.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>i.ot(s,e).next(o=>o?o.target:null))}function dI(n,e){let t=L(n),i=t.us.get(e)||z.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.cs.getAllFromCollectionGroup(r,e,sE(i,-1),Number.MAX_SAFE_INTEGER)).then(r=>(fI(t,e,r),r))}function fI(n,e,t){let i=n.us.get(e)||z.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.us.set(e,i)}function aP(n,e,t,i){return k(this,null,function*(){let r=L(n),s=X(),o=ft();for(let u of t){let d=e.Es(u.metadata.name);u.document&&(s=s.add(d));let p=e.ds(u);p.setReadTime(e.As(u.metadata.readTime)),o=o.insert(d,p)}let a=r.cs.newChangeBuffer({trackRemovals:!0}),c=yield as(r,function(d){return ct(gs(se.fromString(`__bundle__/docs/${d}`)))}(i));return r.persistence.runTransaction("Apply bundle documents","readwrite",u=>uI(u,a,o).next(d=>(a.apply(u),d)).next(d=>r.Ur.removeMatchingKeysForTargetId(u,c.targetId).next(()=>r.Ur.addMatchingKeys(u,s,c.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(u,d.Ps,d.Is)).next(()=>d.Ps)))})}function lP(i,r){return k(this,arguments,function*(n,e,t=X()){let s=yield as(n,ct(Wm(e.bundledQuery))),o=L(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let c=xe(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.Gr.saveNamedQuery(a,e);let u=s.withResumeToken(ke.EMPTY_BYTE_STRING,c);return o.os=o.os.insert(u.targetId,u),o.Ur.updateTargetData(a,u).next(()=>o.Ur.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Ur.addMatchingKeys(a,t,s.targetId)).next(()=>o.Gr.saveNamedQuery(a,e))})})}function jT(n,e){return`firestore_clients_${n}_${e}`}function GT(n,e,t){let i=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}function Vf(n,e){return`firestore_targets_${n}_${e}`}var Kc=class n{constructor(e,t,i,r){this.user=e,this.batchId=t,this.state=i,this.error=r}static Rs(e,t,i){let r=JSON.parse(i),s,o=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(s=new D(r.error.code,r.error.message))),o?new n(e,t,r.state,s):(Re("SharedClientState",`Failed to parse mutation state for ID '${t}': ${i}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},ta=class n{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static Rs(e,t){let i=JSON.parse(t),r,s=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(r=new D(i.error.code,i.error.message))),s?new n(e,i.state,r):(Re("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},zc=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let i=JSON.parse(t),r=typeof i=="object"&&i.activeTargetIds instanceof Array,s=Gm();for(let o=0;r&&o<i.activeTargetIds.length;++o)r=cE(i.activeTargetIds[o]),s=s.add(i.activeTargetIds[o]);return r?new n(e,s):(Re("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Yp=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Re("SharedClientState",`Failed to parse online state: ${e}`),null)}},ya=class{constructor(){this.activeTargetIds=Gm()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},na=class{constructor(e,t,i,r,s){this.window=e,this.ui=t,this.persistenceKey=i,this.ps=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new _e(Q),this.started=!1,this.bs=[];let o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=jT(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new ya),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return k(this,null,function*(){let e=yield this.syncEngine.Qi();for(let i of e){if(i===this.ps)continue;let r=this.getItem(jT(this.persistenceKey,i));if(r){let s=zc.Rs(i,r);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let i=this.Ls(t);i&&this.Bs(i)}for(let i of this.bs)this.ws(i);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((i,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,i){this.qs(e,t,i),this.Qs(e)}addLocalQueryTarget(e,t=!0){let i="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(Vf(this.persistenceKey,e));if(r){let s=ta.Rs(e,r);s&&(i=s.state)}}return t&&this.Ks.fs(e),this.Ns(),i}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Vf(this.persistenceKey,e))}updateQueryState(e,t,i){this.$s(e,t,i)}handleUserChange(e,t,i){t.forEach(r=>{this.Qs(r)}),this.currentUser=e,i.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return V("SharedClientState","READ",e,t),t}setItem(e,t){V("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){V("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(V("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Re("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>k(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let i=this.Gs(t.key);return this.zs(i,null)}{let i=this.js(t.key,t.newValue);if(i)return this.zs(i.clientId,i)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let i=this.Hs(t.key,t.newValue);if(i)return this.Js(i)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let i=this.Ys(t.key,t.newValue);if(i)return this.Zs(i)}}else if(t.key===this.xs){if(t.newValue!==null){let i=this.Ls(t.newValue);if(i)return this.Bs(i)}}else if(t.key===this.vs){let i=function(s){let o=Et.oe;if(s!=null)try{let a=JSON.parse(s);G(typeof a=="number"),o=a}catch(a){Re("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);i!==Et.oe&&this.sequenceNumberHandler(i)}else if(t.key===this.Os){let i=this.Xs(t.newValue);yield Promise.all(i.map(r=>this.syncEngine.eo(r)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,i){let r=new Kc(this.currentUser,e,t,i),s=GT(this.persistenceKey,this.currentUser,e);this.setItem(s,r.Vs())}Qs(e){let t=GT(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,i){let r=Vf(this.persistenceKey,e),s=new ta(e,t,i);this.setItem(r,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let i=this.Gs(e);return zc.Rs(i,t)}Hs(e,t){let i=this.Fs.exec(e),r=Number(i[1]),s=i[2]!==void 0?i[2]:null;return Kc.Rs(new Me(s),r,t)}Ys(e,t){let i=this.Ms.exec(e),r=Number(i[1]);return ta.Rs(r,t)}Ls(e){return Yp.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return k(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);V("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let i=t?this.Ss.insert(e,t):this.Ss.remove(e),r=this.ks(this.Ss),s=this.ks(i),o=[],a=[];return s.forEach(c=>{r.has(c)||o.push(c)}),r.forEach(c=>{s.has(c)||a.push(c)}),this.syncEngine.io(o,a).then(()=>{this.Ss=i})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Gm();return e.forEach((i,r)=>{t=t.unionWith(r.activeTargetIds)}),t}},Wc=class{constructor(){this.so=new ya,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,i){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new ya,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Jp=class{_o(e){}shutdown(){}};var $c=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){V("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){V("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var uc=null;function Of(){return uc===null?uc=function(){return 268435456+Math.round(2147483648*Math.random())}():uc++,"0x"+uc.toString(16)}var cP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Xp=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var et="WebChannelConnection",Zp=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let i=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=i+"://"+t.host,this.vo=`projects/${r}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${s}`}get Fo(){return!1}Mo(t,i,r,s,o){let a=Of(),c=this.xo(t,i.toUriEncodedString());V("RestConnection",`Sending RPC '${t}' ${a}:`,c,r);let u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,s,o),this.No(t,c,u,r).then(d=>(V("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Ut("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",c,"request:",r),d})}Lo(t,i,r,s,o,a){return this.Mo(t,i,r,s,o)}Oo(t,i,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ms}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((s,o)=>t[o]=s),r&&r.headers.forEach((s,o)=>t[o]=s)}xo(t,i){let r=cP[t];return`${this.Do}/v1/${i}:${r}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,i,r){let s=Of();return new Promise((o,a)=>{let c=new bf;c.setWithCredentials(!0),c.listenOnce(Rf.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case zo.NO_ERROR:let d=c.getResponseJson();V(et,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case zo.TIMEOUT:V(et,`RPC '${e}' ${s} timed out`),a(new D(P.DEADLINE_EXCEEDED,"Request time out"));break;case zo.HTTP_ERROR:let p=c.getStatus();if(V(et,`RPC '${e}' ${s} failed with status:`,p,"response text:",c.getResponseText()),p>0){let m=c.getResponseJson();Array.isArray(m)&&(m=m[0]);let y=m?.error;if(y&&y.status&&y.message){let C=function(N){let q=N.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(q)>=0?q:P.UNKNOWN}(y.status);a(new D(C,y.message))}else a(new D(P.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new D(P.UNAVAILABLE,"Connection failed."));break;default:B()}}finally{V(et,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(r);V(et,`RPC '${e}' ${s} sending request:`,r),c.send(t,"POST",u,i,15)})}Bo(e,t,i){let r=Of(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=kf(),a=xf(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,i),c.encodeInitMessageHeaders=!0;let d=s.join("");V(et,`Creating RPC '${e}' stream ${r}: ${d}`,c);let p=o.createWebChannel(d,c),m=!1,y=!1,C=new Xp({Io:N=>{y?V(et,`Not sending because RPC '${e}' stream ${r} is closed:`,N):(m||(V(et,`Opening RPC '${e}' stream ${r} transport.`),p.open(),m=!0),V(et,`RPC '${e}' stream ${r} sending:`,N),p.send(N))},To:()=>p.close()}),x=(N,q,j)=>{N.listen(q,M=>{try{j(M)}catch(W){setTimeout(()=>{throw W},0)}})};return x(p,Lr.EventType.OPEN,()=>{y||(V(et,`RPC '${e}' stream ${r} transport opened.`),C.yo())}),x(p,Lr.EventType.CLOSE,()=>{y||(y=!0,V(et,`RPC '${e}' stream ${r} transport closed`),C.So())}),x(p,Lr.EventType.ERROR,N=>{y||(y=!0,Ut(et,`RPC '${e}' stream ${r} transport errored:`,N),C.So(new D(P.UNAVAILABLE,"The operation could not be completed")))}),x(p,Lr.EventType.MESSAGE,N=>{var q;if(!y){let j=N.data[0];G(!!j);let M=j,W=M.error||((q=M[0])===null||q===void 0?void 0:q.error);if(W){V(et,`RPC '${e}' stream ${r} received error:`,W);let H=W.status,Y=function(w){let E=Ve[w];if(E!==void 0)return BE(E)}(H),T=W.message;Y===void 0&&(Y=P.INTERNAL,T="Unknown error status: "+H+" with message "+W.message),y=!0,C.So(new D(Y,T)),p.close()}else V(et,`RPC '${e}' stream ${r} received:`,j),C.bo(j)}}),x(a,Pf.STAT_EVENT,N=>{N.stat===oc.PROXY?V(et,`RPC '${e}' stream ${r} detected buffering proxy`):N.stat===oc.NOPROXY&&V(et,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{C.wo()},0),C}};function pI(){return typeof window<"u"?window:null}function mc(){return typeof document<"u"?document:null}function Ra(n){return new pp(n,!0)}var va=class{constructor(e,t,i=1e3,r=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=i,this.qo=r,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),i=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-i);r>0&&V("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var Qc=class{constructor(e,t,i,r,s,o,a,c){this.ui=e,this.Ho=i,this.Jo=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new va(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return k(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return k(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return k(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(Re(t.toString()),Re("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.Yo===t&&this.P_(i,r)},i=>{e(()=>{let r=new D(P.UNKNOWN,"Fetching auth token failed: "+i.message);return this.I_(r)})})}P_(e,t){let i=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{i(()=>this.listener.Eo())}),this.stream.Ro(()=>{i(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(r=>{i(()=>this.I_(r))}),this.stream.onMessage(r=>{i(()=>++this.e_==1?this.E_(r):this.onNext(r))})}i_(){this.state=5,this.t_.Go(()=>k(this,null,function*(){this.state=0,this.start()}))}I_(e){return V("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(V("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},em=class extends Qc{constructor(e,t,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=$R(this.serializer,e),i=function(s){if(!("targetChange"in s))return z.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?z.min():o.readTime?xe(o.readTime):z.min()}(e);return this.listener.d_(t,i)}A_(e){let t={};t.database=_p(this.serializer),t.addTarget=function(s,o){let a,c=o.target;if(a=Cc(c)?{documents:QE(s,c)}:{query:HE(s,c)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=jE(s,o.resumeToken);let u=mp(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(z.min())>0){a.readTime=rs(s,o.snapshotVersion.toTimestamp());let u=mp(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let i=HR(this.serializer,e);i&&(t.labels=i),this.a_(t)}R_(e){let t={};t.database=_p(this.serializer),t.removeTarget=e,this.a_(t)}},tm=class extends Qc{constructor(e,t,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return G(!!e.streamToken),this.lastStreamToken=e.streamToken,G(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=QR(e.writeResults,e.commitTime),i=xe(e.commitTime);return this.listener.g_(i,t)}p_(){let e={};e.database=_p(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(i=>ma(this.serializer,i))};this.a_(t)}};var nm=class extends class{}{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new D(P.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,i,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,gp(t,i),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(P.UNKNOWN,s.toString())})}Lo(e,t,i,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,gp(t,i),r,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(P.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},im=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Re(t),this.D_=!1):V("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var rm=class{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{i.enqueueAndForget(()=>k(this,null,function*(){yi(this)&&(V("RemoteStore","Restarting streams for network reachability change."),yield function(c){return k(this,null,function*(){let u=L(c);u.L_.add(4),yield _s(u),u.q_.set("Unknown"),u.L_.delete(4),yield Pa(u)})}(this))}))}),this.q_=new im(i,r)}};function Pa(n){return k(this,null,function*(){if(yi(n))for(let e of n.B_)yield e(!0)})}function _s(n){return k(this,null,function*(){for(let e of n.B_)yield e(!1)})}function mu(n,e){let t=L(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Jm(t)?Ym(t):vs(t).r_()&&Hm(t,e))}function cs(n,e){let t=L(n),i=vs(t);t.N_.delete(e),i.r_()&&mI(t,e),t.N_.size===0&&(i.r_()?i.o_():yi(t)&&t.q_.set("Unknown"))}function Hm(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}vs(n).A_(e)}function mI(n,e){n.Q_.xe(e),vs(n).R_(e)}function Ym(n){n.Q_=new fp({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),vs(n).start(),n.q_.v_()}function Jm(n){return yi(n)&&!vs(n).n_()&&n.N_.size>0}function yi(n){return L(n).L_.size===0}function gI(n){n.Q_=void 0}function uP(n){return k(this,null,function*(){n.q_.set("Online")})}function hP(n){return k(this,null,function*(){n.N_.forEach((e,t)=>{Hm(n,e)})})}function dP(n,e){return k(this,null,function*(){gI(n),Jm(n)?(n.q_.M_(e),Ym(n)):n.q_.set("Unknown")})}function fP(n,e,t){return k(this,null,function*(){if(n.q_.set("Online"),e instanceof Pc&&e.state===2&&e.cause)try{yield function(r,s){return k(this,null,function*(){let o=s.cause;for(let a of s.targetIds)r.N_.has(a)&&(yield r.remoteSyncer.rejectListen(a,o),r.N_.delete(a),r.Q_.removeTarget(a))})}(n,e)}catch(i){V("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield Hc(n,i)}else if(e instanceof Jr?n.Q_.Ke(e):e instanceof Rc?n.Q_.He(e):n.Q_.We(e),!t.isEqual(z.min()))try{let i=yield cI(n.localStore);t.compareTo(i)>=0&&(yield function(s,o){let a=s.Q_.rt(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let d=s.N_.get(u);d&&s.N_.set(u,d.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let d=s.N_.get(c);if(!d)return;s.N_.set(c,d.withResumeToken(ke.EMPTY_BYTE_STRING,d.snapshotVersion)),mI(s,c);let p=new ss(d.target,c,u,d.sequenceNumber);Hm(s,p)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(i){V("RemoteStore","Failed to raise snapshot:",i),yield Hc(n,i)}})}function Hc(n,e,t){return k(this,null,function*(){if(!_i(e))throw e;n.L_.add(1),yield _s(n),n.q_.set("Offline"),t||(t=()=>cI(n.localStore)),n.asyncQueue.enqueueRetryable(()=>k(this,null,function*(){V("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield Pa(n)}))})}function _I(n,e){return e().catch(t=>Hc(n,t,e))}function ys(n){return k(this,null,function*(){let e=L(n),t=mi(e),i=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;pP(e);)try{let r=yield oP(e.localStore,i);if(r===null){e.O_.length===0&&t.o_();break}i=r.batchId,mP(e,r)}catch(r){yield Hc(e,r)}yI(e)&&vI(e)})}function pP(n){return yi(n)&&n.O_.length<10}function mP(n,e){n.O_.push(e);let t=mi(n);t.r_()&&t.V_&&t.m_(e.mutations)}function yI(n){return yi(n)&&!mi(n).n_()&&n.O_.length>0}function vI(n){mi(n).start()}function gP(n){return k(this,null,function*(){mi(n).p_()})}function _P(n){return k(this,null,function*(){let e=mi(n);for(let t of n.O_)e.m_(t.mutations)})}function yP(n,e,t){return k(this,null,function*(){let i=n.O_.shift(),r=up.from(i,e,t);yield _I(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield ys(n)})}function vP(n,e){return k(this,null,function*(){e&&mi(n).V_&&(yield function(i,r){return k(this,null,function*(){if(function(o){return UE(o)&&o!==P.ABORTED}(r.code)){let s=i.O_.shift();mi(i).s_(),yield _I(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),yield ys(i)}})}(n,e)),yI(n)&&vI(n)})}function KT(n,e){return k(this,null,function*(){let t=L(n);t.asyncQueue.verifyOperationInProgress(),V("RemoteStore","RemoteStore received new credentials");let i=yi(t);t.L_.add(3),yield _s(t),i&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Pa(t)})}function sm(n,e){return k(this,null,function*(){let t=L(n);e?(t.L_.delete(2),yield Pa(t)):e||(t.L_.add(2),yield _s(t),t.q_.set("Unknown"))})}function vs(n){return n.K_||(n.K_=function(t,i,r){let s=L(t);return s.w_(),new em(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Eo:uP.bind(null,n),Ro:hP.bind(null,n),mo:dP.bind(null,n),d_:fP.bind(null,n)}),n.B_.push(e=>k(this,null,function*(){e?(n.K_.s_(),Jm(n)?Ym(n):n.q_.set("Unknown")):(yield n.K_.stop(),gI(n))}))),n.K_}function mi(n){return n.U_||(n.U_=function(t,i,r){let s=L(t);return s.w_(),new tm(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:gP.bind(null,n),mo:vP.bind(null,n),f_:_P.bind(null,n),g_:yP.bind(null,n)}),n.B_.push(e=>k(this,null,function*(){e?(n.U_.s_(),yield ys(n)):(yield n.U_.stop(),n.O_.length>0&&(V("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var om=class n{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new qe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){let o=Date.now()+i,a=new n(e,t,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ws(n,e){if(Re("AsyncQueue",`${e}: ${n}`),_i(n))return new D(P.UNAVAILABLE,`${e}: ${n}`);throw n}var Yc=class n{constructor(e){this.comparator=e?(t,i)=>e(t,i)||U.comparator(t.key,i.key):(t,i)=>U.comparator(t.key,i.key),this.keyedMap=Yo(),this.sortedSet=new _e(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let i=new n;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}};var Jc=class{constructor(){this.W_=new _e(U.comparator)}track(e){let t=e.doc.key,i=this.W_.get(t);i?e.type!==0&&i.type===3?this.W_=this.W_.insert(t,e):e.type===3&&i.type!==1?this.W_=this.W_.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.W_=this.W_.remove(t):e.type===1&&i.type===2?this.W_=this.W_.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):B():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,i)=>{e.push(i)}),e}},us=class n{constructor(e,t,i,r,s,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,i,r,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Yc.emptySet(t),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Sa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}};var am=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},lm=class{constructor(){this.queries=zT(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,i){let r=L(t),s=r.queries;r.queries=zT(),s.forEach((o,a)=>{for(let c of a.j_)c.onError(i)})})(this,new D(P.ABORTED,"Firestore shutting down"))}};function zT(){return new ln(n=>CE(n),Sa)}function Xm(n,e){return k(this,null,function*(){let t=L(n),i=3,r=e.query,s=t.queries.get(r);s?!s.H_()&&e.J_()&&(i=2):(s=new am,i=e.J_()?0:1);try{switch(i){case 0:s.z_=yield t.onListen(r,!0);break;case 1:s.z_=yield t.onListen(r,!1);break;case 2:yield t.onFirstRemoteStoreListen(r)}}catch(o){let a=ws(o,`Initialization of query '${Kr(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&eg(t)})}function Zm(n,e){return k(this,null,function*(){let t=L(n),i=e.query,r=3,s=t.queries.get(i);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?r=e.J_()?0:1:!s.H_()&&e.J_()&&(r=2))}switch(r){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}})}function wP(n,e){let t=L(n),i=!1;for(let r of e){let s=r.query,o=t.queries.get(s);if(o){for(let a of o.j_)a.X_(r)&&(i=!0);o.z_=r}}i&&eg(t)}function TP(n,e,t){let i=L(n),r=i.queries.get(e);if(r)for(let s of r.j_)s.onError(t);i.queries.delete(e)}function eg(n){n.Y_.forEach(e=>{e.next()})}var cm,WT;(WT=cm||(cm={})).ea="default",WT.Cache="cache";var wa=class{constructor(e,t,i){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=i||{}}X_(e){if(!this.options.includeMetadataChanges){let i=[];for(let r of e.docChanges)r.type!==3&&i.push(r);e=new us(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let i=t!=="Offline";return(!this.options._a||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=us.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==cm.Cache}};var um=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var Xc=class{constructor(e){this.serializer=e}Es(e){return rn(this.serializer,e)}ds(e){return e.metadata.exists?$E(this.serializer,e.document,!1):Fe.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return xe(e)}},hm=class{constructor(e,t,i){this.ca=e,this.localStore=t,this.serializer=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=wI(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let i=se.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,i=new Xc(this.serializer);for(let r of e)if(r.metadata.queries){let s=i.Es(r.metadata.name);for(let o of r.metadata.queries){let a=(t.get(o)||X()).add(s);t.set(o,a)}}return t}complete(){return k(this,null,function*(){let e=yield aP(this.localStore,new Xc(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let i of this.queries)yield lP(this.localStore,i,t.get(i.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function wI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Zc=class{constructor(e){this.key=e}},eu=class{constructor(e){this.key=e}},tu=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=X(),this.mutatedKeys=X(),this.Aa=bE(e),this.Ra=new Yc(this.Aa)}get Va(){return this.Ta}ma(e,t){let i=t?t.fa:new Jc,r=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1,c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((d,p)=>{let m=r.get(d),y=ba(this.query,p)?p:null,C=!!m&&this.mutatedKeys.has(m.key),x=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations),N=!1;m&&y?m.data.isEqual(y.data)?C!==x&&(i.track({type:3,doc:y}),N=!0):this.ga(m,y)||(i.track({type:2,doc:y}),N=!0,(c&&this.Aa(y,c)>0||u&&this.Aa(y,u)<0)&&(a=!0)):!m&&y?(i.track({type:0,doc:y}),N=!0):m&&!y&&(i.track({type:1,doc:m}),N=!0,(c||u)&&(a=!0)),N&&(y?(o=o.add(y),s=x?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),i.track({type:1,doc:d})}return{Ra:o,fa:i,ns:a,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((d,p)=>function(y,C){let x=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B()}};return x(y)-x(C)}(d.type,p.type)||this.Aa(d.doc,p.doc)),this.pa(i),r=r!=null&&r;let a=t&&!r?this.ya():[],c=this.da.size===0&&this.current&&!r?1:0,u=c!==this.Ea;return this.Ea=c,o.length!==0||u?{snapshot:new us(this.query,e.Ra,s,o,e.mutatedKeys,c===0,u,!1,!!i&&i.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Jc,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=X(),this.Ra.forEach(i=>{this.Sa(i.key)&&(this.da=this.da.add(i.key))});let t=[];return e.forEach(i=>{this.da.has(i)||t.push(new eu(i))}),this.da.forEach(i=>{e.has(i)||t.push(new Zc(i))}),t}ba(e){this.Ta=e.Ts,this.da=X();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return us.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},dm=class{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}},fm=class{constructor(e){this.key=e,this.va=!1}},pm=class{constructor(e,t,i,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new ln(a=>CE(a),Sa),this.Ma=new Map,this.xa=new Set,this.Oa=new _e(U.comparator),this.Na=new Map,this.La=new _a,this.Ba={},this.ka=new Map,this.qa=os.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function EP(n,e,t=!0){return k(this,null,function*(){let i=gu(n),r,s=i.Fa.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.Da()):r=yield TI(i,e,t,!0),r})}function IP(n,e){return k(this,null,function*(){let t=gu(n);yield TI(t,e,!0,!1)})}function TI(n,e,t,i){return k(this,null,function*(){let r=yield as(n.localStore,ct(e)),s=r.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return i&&(a=yield tg(n,e,s,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&mu(n.remoteStore,r),a})}function tg(n,e,t,i,r){return k(this,null,function*(){n.Ka=(p,m,y)=>function(x,N,q,j){return k(this,null,function*(){let M=N.view.ma(q);M.ns&&(M=yield Gc(x.localStore,N.query,!1).then(({documents:T})=>N.view.ma(T,M)));let W=j&&j.targetChanges.get(N.targetId),H=j&&j.targetMismatches.get(N.targetId)!=null,Y=N.view.applyChanges(M,x.isPrimaryClient,W,H);return mm(x,N.targetId,Y.wa),Y.snapshot})}(n,p,m,y);let s=yield Gc(n.localStore,e,!0),o=new tu(e,s.Ts),a=o.ma(s.documents),c=fa.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),u=o.applyChanges(a,n.isPrimaryClient,c);mm(n,t,u.wa);let d=new dm(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),u.snapshot})}function AP(n,e,t){return k(this,null,function*(){let i=L(n),r=i.Fa.get(e),s=i.Ma.get(r.targetId);if(s.length>1)return i.Ma.set(r.targetId,s.filter(o=>!Sa(o,e))),void i.Fa.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||(yield ls(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),t&&cs(i.remoteStore,r.targetId),hs(i,r.targetId)}).catch(gi))):(hs(i,r.targetId),yield ls(i.localStore,r.targetId,!0))})}function CP(n,e){return k(this,null,function*(){let t=L(n),i=t.Fa.get(e),r=t.Ma.get(i.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),cs(t.remoteStore,i.targetId))})}function SP(n,e,t){return k(this,null,function*(){let i=sg(n);try{let r=yield function(o,a){let c=L(o),u=Te.now(),d=a.reduce((y,C)=>y.add(C.key),X()),p,m;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let C=ft(),x=X();return c.cs.getEntries(y,d).next(N=>{C=N,C.forEach((q,j)=>{j.isValidDocument()||(x=x.add(q))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,C)).next(N=>{p=N;let q=[];for(let j of a){let M=BR(j,p.get(j.key).overlayedDocument);M!=null&&q.push(new qt(j.key,M,yE(M.value.mapValue),Se.exists(!0)))}return c.mutationQueue.addMutationBatch(y,u,q,a)}).next(N=>{m=N;let q=N.applyToLocalDocumentSet(p,x);return c.documentOverlayCache.saveOverlays(y,N.batchId,q)})}).then(()=>({batchId:m.batchId,changes:PE(p)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(o,a,c){let u=o.Ba[o.currentUser.toKey()];u||(u=new _e(Q)),u=u.insert(a,c),o.Ba[o.currentUser.toKey()]=u}(i,r.batchId,t),yield xn(i,r.changes),yield ys(i.remoteStore)}catch(r){let s=ws(r,"Failed to persist write");t.reject(s)}})}function EI(n,e){return k(this,null,function*(){let t=L(n);try{let i=yield sP(t.localStore,e);e.targetChanges.forEach((r,s)=>{let o=t.Na.get(s);o&&(G(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.va=!0:r.modifiedDocuments.size>0?G(o.va):r.removedDocuments.size>0&&(G(o.va),o.va=!1))}),yield xn(t,i,e)}catch(i){yield gi(i)}})}function $T(n,e,t){let i=L(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){let r=[];i.Fa.forEach((s,o)=>{let a=o.view.Z_(e);a.snapshot&&r.push(a.snapshot)}),function(o,a){let c=L(o);c.onlineState=a;let u=!1;c.queries.forEach((d,p)=>{for(let m of p.j_)m.Z_(a)&&(u=!0)}),u&&eg(c)}(i.eventManager,e),r.length&&i.Ca.d_(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function bP(n,e,t){return k(this,null,function*(){let i=L(n);i.sharedClientState.updateQueryState(e,"rejected",t);let r=i.Na.get(e),s=r&&r.key;if(s){let o=new _e(U.comparator);o=o.insert(s,Fe.newNoDocument(s,z.min()));let a=X().add(s),c=new da(z.min(),new Map,new _e(Q),o,a);yield EI(i,c),i.Oa=i.Oa.remove(s),i.Na.delete(e),rg(i)}else yield ls(i.localStore,e,!1).then(()=>hs(i,e,t)).catch(gi)})}function RP(n,e){return k(this,null,function*(){let t=L(n),i=e.batch.batchId;try{let r=yield rP(t.localStore,e);ig(t,i,null),ng(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield xn(t,r)}catch(r){yield gi(r)}})}function PP(n,e,t){return k(this,null,function*(){let i=L(n);try{let r=yield function(o,a){let c=L(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return c.mutationQueue.lookupMutationBatch(u,a).next(p=>(G(p!==null),d=p.keys(),c.mutationQueue.removeMutationBatch(u,p))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>c.localDocuments.getDocuments(u,d))})}(i.localStore,e);ig(i,e,t),ng(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield xn(i,r)}catch(r){yield gi(r)}})}function xP(n,e){return k(this,null,function*(){let t=L(n);yi(t.remoteStore)||V("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let i=yield function(o){let a=L(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(i===-1)return void e.resolve();let r=t.ka.get(i)||[];r.push(e),t.ka.set(i,r)}catch(i){let r=ws(i,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}})}function ng(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function ig(n,e,t){let i=L(n),r=i.Ba[i.currentUser.toKey()];if(r){let s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.Ba[i.currentUser.toKey()]=r}}function hs(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let i of n.Ma.get(e))n.Fa.delete(i),t&&n.Ca.$a(i,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(i=>{n.La.containsKey(i)||II(n,i)})}function II(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(cs(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),rg(n))}function mm(n,e,t){for(let i of t)i instanceof Zc?(n.La.addReference(i.key,e),kP(n,i)):i instanceof eu?(V("SyncEngine","Document no longer in limbo: "+i.key),n.La.removeReference(i.key,e),n.La.containsKey(i.key)||II(n,i.key)):B()}function kP(n,e){let t=e.key,i=t.path.canonicalString();n.Oa.get(t)||n.xa.has(i)||(V("SyncEngine","New document in limbo: "+t),n.xa.add(i),rg(n))}function rg(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new U(se.fromString(e)),i=n.qa.next();n.Na.set(i,new fm(t)),n.Oa=n.Oa.insert(t,i),mu(n.remoteStore,new ss(ct(gs(t.path)),i,"TargetPurposeLimboResolution",Et.oe))}}function xn(n,e,t){return k(this,null,function*(){let i=L(n),r=[],s=[],o=[];i.Fa.isEmpty()||(i.Fa.forEach((a,c)=>{o.push(i.Ka(c,e,t).then(u=>{var d;if((u||t)&&i.isPrimaryClient){let p=u?!u.fromCache:(d=t?.targetChanges.get(c.targetId))===null||d===void 0?void 0:d.current;i.sharedClientState.updateQueryState(c.targetId,p?"current":"not-current")}if(u){r.push(u);let p=$p.Wi(c.targetId,u);s.push(p)}}))}),yield Promise.all(o),i.Ca.d_(r),yield function(c,u){return k(this,null,function*(){let d=L(c);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>b.forEach(u,m=>b.forEach(m.$i,y=>d.persistence.referenceDelegate.addReference(p,m.targetId,y)).next(()=>b.forEach(m.Ui,y=>d.persistence.referenceDelegate.removeReference(p,m.targetId,y)))))}catch(p){if(!_i(p))throw p;V("LocalStore","Failed to update sequence numbers: "+p)}for(let p of u){let m=p.targetId;if(!p.fromCache){let y=d.os.get(m),C=y.snapshotVersion,x=y.withLastLimboFreeSnapshotVersion(C);d.os=d.os.insert(m,x)}}})}(i.localStore,s))})}function NP(n,e){return k(this,null,function*(){let t=L(n);if(!t.currentUser.isEqual(e)){V("SyncEngine","User change. New user:",e.toKey());let i=yield lI(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(a=>{a.forEach(c=>{c.reject(new D(P.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield xn(t,i.hs)}})}function DP(n,e){let t=L(n),i=t.Na.get(e);if(i&&i.va)return X().add(i.key);{let r=X(),s=t.Ma.get(e);if(!s)return r;for(let o of s){let a=t.Fa.get(o);r=r.unionWith(a.view.Va)}return r}}function VP(n,e){return k(this,null,function*(){let t=L(n),i=yield Gc(t.localStore,e.query,!0),r=e.view.ba(i);return t.isPrimaryClient&&mm(t,e.targetId,r.wa),r})}function OP(n,e){return k(this,null,function*(){let t=L(n);return dI(t.localStore,e).then(i=>xn(t,i))})}function MP(n,e,t,i){return k(this,null,function*(){let r=L(n),s=yield function(a,c){let u=L(a),d=L(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",p=>d.Mn(p,c).next(m=>m?u.localDocuments.getDocuments(p,m):b.resolve(null)))}(r.localStore,e);s!==null?(t==="pending"?yield ys(r.remoteStore):t==="acknowledged"||t==="rejected"?(ig(r,e,i||null),ng(r,e),function(a,c){L(L(a).mutationQueue).On(c)}(r.localStore,e)):B(),yield xn(r,s)):V("SyncEngine","Cannot apply mutation batch with id: "+e)})}function FP(n,e){return k(this,null,function*(){let t=L(n);if(gu(t),sg(t),e===!0&&t.Qa!==!0){let i=t.sharedClientState.getAllActiveQueryTargets(),r=yield QT(t,i.toArray());t.Qa=!0,yield sm(t.remoteStore,!0);for(let s of r)mu(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let i=[],r=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?i.push(o):r=r.then(()=>(hs(t,o),ls(t.localStore,o,!0))),cs(t.remoteStore,o)}),yield r,yield QT(t,i),function(o){let a=L(o);a.Na.forEach((c,u)=>{cs(a.remoteStore,u)}),a.La.pr(),a.Na=new Map,a.Oa=new _e(U.comparator)}(t),t.Qa=!1,yield sm(t.remoteStore,!1)}})}function QT(n,e,t){return k(this,null,function*(){let i=L(n),r=[],s=[];for(let o of e){let a,c=i.Ma.get(o);if(c&&c.length!==0){a=yield as(i.localStore,ct(c[0]));for(let u of c){let d=i.Fa.get(u),p=yield VP(i,d);p.snapshot&&s.push(p.snapshot)}}else{let u=yield hI(i.localStore,o);a=yield as(i.localStore,u),yield tg(i,AI(u),o,!1,a.resumeToken)}r.push(a)}return i.Ca.d_(s),r})}function AI(n){return AE(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function LP(n){return function(t){return L(L(t).persistence).Qi()}(L(n).localStore)}function UP(n,e,t,i){return k(this,null,function*(){let r=L(n);if(r.Qa)return void V("SyncEngine","Ignoring unexpected query state notification.");let s=r.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield dI(r.localStore,SE(s[0])),a=da.createSynthesizedRemoteEventForCurrentChange(e,t==="current",ke.EMPTY_BYTE_STRING);yield xn(r,o,a);break}case"rejected":yield ls(r.localStore,e,!0),hs(r,e,i);break;default:B()}})}function BP(n,e,t){return k(this,null,function*(){let i=gu(n);if(i.Qa){for(let r of e){if(i.Ma.has(r)&&i.sharedClientState.isActiveQueryTarget(r)){V("SyncEngine","Adding an already active target "+r);continue}let s=yield hI(i.localStore,r),o=yield as(i.localStore,s);yield tg(i,AI(s),o.targetId,!1,o.resumeToken),mu(i.remoteStore,o)}for(let r of t)i.Ma.has(r)&&(yield ls(i.localStore,r,!1).then(()=>{cs(i.remoteStore,r),hs(i,r)}).catch(gi))}})}function gu(n){let e=L(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=EI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=DP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bP.bind(null,e),e.Ca.d_=wP.bind(null,e.eventManager),e.Ca.$a=TP.bind(null,e.eventManager),e}function sg(n){let e=L(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=RP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=PP.bind(null,e),e}function qP(n,e,t){let i=L(n);(function(s,o,a){return k(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(y,C){let x=L(y),N=xe(C.createTime);return x.persistence.runTransaction("hasNewerBundle","readonly",q=>x.Gr.getBundleMetadata(q,C.id)).then(q=>!!q&&q.createTime.compareTo(N)>=0)}(s.localStore,c))return yield o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress(wI(c));let u=new hm(c,s.localStore,o.serializer),d=yield o.Ua();for(;d;){let m=yield u.la(d);m&&a._updateProgress(m),d=yield o.Ua()}let p=yield u.complete();return yield xn(s,p.Ia,void 0),yield function(y,C){let x=L(y);return x.persistence.runTransaction("Save bundle","readwrite",N=>x.Gr.saveBundleMetadata(N,C))}(s.localStore,c),a._completeWith(p.progress),Promise.resolve(p.Pa)}catch(c){return Ut("SyncEngine",`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})})(i,e,t).then(r=>{i.sharedClientState.notifyBundleLoaded(r)})}var gm=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return k(this,null,function*(){this.serializer=Ra(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,i){return null}Ha(t,i){return null}za(t){return aI(this.persistence,new jc,t.initialUser,this.serializer)}Ga(t){return new Bc(qc.Zr,this.serializer)}Wa(t){return new Wc}terminate(){return k(this,null,function*(){var t,i;(t=this.gcScheduler)===null||t===void 0||t.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var nu=class n extends gm{constructor(e,t,i){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return k(this,null,function*(){yield eh(n.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield sg(this.Ja.syncEngine),yield ys(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return aI(this.persistence,new jc,e.initialUser,this.serializer)}ja(e,t){let i=this.persistence.referenceDelegate.garbageCollector;return new kp(i,e.asyncQueue,t)}Ha(e,t){let i=new Qf(t,this.persistence);return new $f(e.asyncQueue,i)}Ga(e){let t=Qm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?Pt.withCacheSize(this.cacheSizeBytes):Pt.DEFAULT;return new Wp(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,pI(),mc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Wc}},_m=class n extends nu{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return k(this,null,function*(){yield eh(n.prototype,this,"initialize").call(this,e);let t=this.Ja.syncEngine;this.sharedClientState instanceof na&&(this.sharedClientState.syncEngine={no:MP.bind(null,t),ro:UP.bind(null,t),io:BP.bind(null,t),Qi:LP.bind(null,t),eo:OP.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(i=>k(this,null,function*(){yield FP(this.Ja.syncEngine,i),this.gcScheduler&&(i&&!this.gcScheduler.started?this.gcScheduler.start():i||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(i&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():i||this.indexBackfillerScheduler.stop())}))})}Wa(e){let t=pI();if(!na.D(t))throw new D(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let i=Qm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new na(t,e.asyncQueue,i,e.clientId,e.initialUser)}},og=(()=>{class n{initialize(t,i){return k(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>$T(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=NP.bind(null,this.syncEngine),yield sm(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new lm}()}createDatastore(t){let i=Ra(t.databaseInfo.databaseId),r=function(o){return new Zp(o)}(t.databaseInfo);return function(o,a,c,u){return new nm(o,a,c,u)}(t.authCredentials,t.appCheckCredentials,r,i)}createRemoteStore(t){return function(r,s,o,a,c){return new rm(r,s,o,a,c)}(this.localStore,this.datastore,t.asyncQueue,i=>$T(this.syncEngine,i,0),function(){return $c.D()?new $c:new Jp}())}createSyncEngine(t,i){return function(s,o,a,c,u,d,p){let m=new pm(s,o,a,c,u,d);return p&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,i)}terminate(){return k(this,null,function*(){var t,i;yield function(s){return k(this,null,function*(){let o=L(s);V("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield _s(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()})}}return n.provider={build:()=>new n},n})();function HT(n,e=10240){let t=0;return{read(){return k(this,null,function*(){if(t<n.byteLength){let r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})},cancel(){return k(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var ds=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Re("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var ym=class{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new qe,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(i=>{i&&i.ua()?this.metadata.resolve(i.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(i?.aa)}`))},i=>this.metadata.reject(i))}close(){return this.Xa.cancel()}getMetadata(){return k(this,null,function*(){return this.metadata.promise})}Ua(){return k(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return k(this,null,function*(){let e=yield this.nu();if(e===null)return null;let t=this.eu.decode(e),i=Number(t);isNaN(i)&&this.ru(`length string (${t}) is not valid number`);let r=yield this.iu(i);return new um(JSON.parse(r),e.length+i)})}su(){return this.buffer.findIndex(e=>e===123)}nu(){return k(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}iu(e){return k(this,null,function*(){for(;this.buffer.length<e;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){return k(this,null,function*(){let e=yield this.Xa.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var vm=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return k(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new D(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(r,s){return k(this,null,function*(){let o=L(r),a={documents:s.map(p=>pa(o.serializer,p))},c=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,se.emptyPath(),a,s.length),u=new Map;c.forEach(p=>{let m=WR(o.serializer,p);u.set(m.key.toString(),m)});let d=[];return s.forEach(p=>{let m=u.get(p.toString());G(!!m),d.push(m)}),d})}(this.datastore,e);return t.forEach(i=>this.recordVersion(i)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastTransactionError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new pi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return k(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,i)=>{let r=U.fromPath(i);this.mutations.push(new ca(r,this.precondition(r)))}),yield function(i,r){return k(this,null,function*(){let s=L(i),o={writes:r.map(a=>ma(s.serializer,a))};yield s.Mo("Commit",s.serializer.databaseId,se.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw B();t=z.min()}let i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new D(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(z.min())?Se.exists(!1):Se.updateTime(t):Se.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(z.min()))throw new D(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Se.updateTime(t)}return Se.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var wm=class{constructor(e,t,i,r,s){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=r,this.deferred=s,this._u=i.maxAttempts,this.t_=new va(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>k(this,null,function*(){let e=new vm(this.datastore),t=this.cu(e);t&&t.then(i=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(i)}).catch(r=>{this.lu(r)}))}).catch(i=>{this.lu(i)})}))}cu(e){try{let t=this.updateFunction(e);return!Aa(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!UE(t)}return!1}};var Tm=class{constructor(e,t,i,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=Me.UNAUTHENTICATED,this.clientId=_c.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,o=>k(this,null,function*(){V("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(i,o=>(V("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new qe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>k(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let i=ws(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}};function Mf(n,e){return k(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(r=>k(this,null,function*(){i.isEqual(r)||(yield lI(e.localStore,r),i=r)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function YT(n,e){return k(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield ag(n);V("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>KT(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>KT(e.remoteStore,r)),n._onlineComponents=e})}function ag(n){return k(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Mf(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(r){return r.name==="FirebaseError"?r.code===P.FAILED_PRECONDITION||r.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Ut("Error using user provided cache. Falling back to memory cache: "+t),yield Mf(n,new gm)}}else V("FirestoreClient","Using default OfflineComponentProvider"),yield Mf(n,new gm);return n._offlineComponents})}function _u(n){return k(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V("FirestoreClient","Using user provided OnlineComponentProvider"),yield YT(n,n._uninitializedComponentsProvider._online)):(V("FirestoreClient","Using default OnlineComponentProvider"),yield YT(n,new og))),n._onlineComponents})}function CI(n){return ag(n).then(e=>e.persistence)}function lg(n){return ag(n).then(e=>e.localStore)}function SI(n){return _u(n).then(e=>e.remoteStore)}function cg(n){return _u(n).then(e=>e.syncEngine)}function jP(n){return _u(n).then(e=>e.datastore)}function fs(n){return k(this,null,function*(){let e=yield _u(n),t=e.eventManager;return t.onListen=EP.bind(null,e.syncEngine),t.onUnlisten=AP.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=IP.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=CP.bind(null,e.syncEngine),t})}function GP(n){return n.asyncQueue.enqueue(()=>k(this,null,function*(){let e=yield CI(n),t=yield SI(n);return e.setNetworkEnabled(!0),function(r){let s=L(r);return s.L_.delete(0),Pa(s)}(t)}))}function KP(n){return n.asyncQueue.enqueue(()=>k(this,null,function*(){let e=yield CI(n),t=yield SI(n);return e.setNetworkEnabled(!1),function(r){return k(this,null,function*(){let s=L(r);s.L_.add(0),yield _s(s),s.q_.set("Offline")})}(t)}))}function zP(n,e){let t=new qe;return n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(r,s,o){return k(this,null,function*(){try{let a=yield function(u,d){let p=L(u);return p.persistence.runTransaction("read document","readonly",m=>p.localDocuments.getDocument(m,d))}(r,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new D(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let c=ws(a,`Failed to get document '${s} from cache`);o.reject(c)}})}(yield lg(n),e,t)})),t.promise}function bI(n,e,t={}){let i=new qe;return n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(s,o,a,c,u){let d=new ds({next:m=>{d.Za(),o.enqueueAndForget(()=>Zm(s,p));let y=m.docs.has(a);!y&&m.fromCache?u.reject(new D(P.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&m.fromCache&&c&&c.source==="server"?u.reject(new D(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),p=new wa(gs(a.path),d,{includeMetadataChanges:!0,_a:!0});return Xm(s,p)}(yield fs(n),n.asyncQueue,e,t,i)})),i.promise}function WP(n,e){let t=new qe;return n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(r,s,o){return k(this,null,function*(){try{let a=yield Gc(r,s,!0),c=new tu(s,a.Ts),u=c.ma(a.documents),d=c.applyChanges(u,!1);o.resolve(d.snapshot)}catch(a){let c=ws(a,`Failed to execute query '${s} against cache`);o.reject(c)}})}(yield lg(n),e,t)})),t.promise}function RI(n,e,t={}){let i=new qe;return n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(s,o,a,c,u){let d=new ds({next:m=>{d.Za(),o.enqueueAndForget(()=>Zm(s,p)),m.fromCache&&c.source==="server"?u.reject(new D(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),p=new wa(a,d,{includeMetadataChanges:!0,_a:!0});return Xm(s,p)}(yield fs(n),n.asyncQueue,e,t,i)})),i.promise}function $P(n,e){let t=new ds(e);return n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(r,s){L(r).Y_.add(s),s.next()}(yield fs(n),t)})),()=>{t.Za(),n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return function(r,s){L(r).Y_.delete(s)}(yield fs(n),t)}))}}function QP(n,e,t,i){let r=function(o,a){let c;return c=typeof o=="string"?qE().encode(o):o,function(d,p){return new ym(d,p)}(function(d,p){if(d instanceof Uint8Array)return HT(d,p);if(d instanceof ArrayBuffer)return HT(new Uint8Array(d),p);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(t,Ra(e));n.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){qP(yield cg(n),r,i)}))}function HP(n,e){return n.asyncQueue.enqueue(()=>k(this,null,function*(){return function(i,r){let s=L(i);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,r))}(yield lg(n),e)}))}function PI(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var JT=new Map;function ug(n,e,t){if(!t)throw new D(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function hg(n,e,t,i){if(e===!0&&i===!0)throw new D(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function XT(n){if(!U.isDocumentKey(n))throw new D(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ZT(n){if(U.isDocumentKey(n))throw new D(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function yu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":B()}function oe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=yu(n);throw new D(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function xI(n,e){if(e<=0)throw new D(P.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var iu=class{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new D(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new D(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}hg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=PI((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new D(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new D(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new D(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Zi=class{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new iu({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new D(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new iu(e),e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new Ff;switch(i.type){case"firstParty":return new qf(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new D(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return k(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let i=JT.get(t);i&&(V("ComponentProvider","Removing Datastore"),JT.delete(t),i.terminate())}(this),Promise.resolve()}};function kI(n,e,t,i={}){var r;let s=(n=oe(n,Zi))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Ut("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),i.mockUserToken){let a,c;if(typeof i.mockUserToken=="string")a=i.mockUserToken,c=Me.MOCK_USER;else{a=rl(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);let u=i.mockUserToken.sub||i.mockUserToken.user_id;if(!u)throw new D(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Me(u)}n._authCredentials=new Lf(new gc(a,c))}}var $e=class n{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},me=class n{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new sn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},sn=class n extends $e{constructor(e,t,i){super(e,t,gs(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new me(this.firestore,null,new U(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function dg(n,e,...t){if(n=ne(n),ug("collection","path",e),n instanceof Zi){let i=se.fromString(e,...t);return ZT(i),new sn(n,null,i)}{if(!(n instanceof me||n instanceof sn))throw new D(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(se.fromString(e,...t));return ZT(i),new sn(n.firestore,null,i)}}function NI(n,e){if(n=oe(n,Zi),ug("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(P.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new $e(n,null,function(i){return new Bt(se.emptyPath(),i)}(e))}function xa(n,e,...t){if(n=ne(n),arguments.length===1&&(e=_c.newId()),ug("doc","path",e),n instanceof Zi){let i=se.fromString(e,...t);return XT(i),new me(n,null,new U(i))}{if(!(n instanceof me||n instanceof sn))throw new D(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(se.fromString(e,...t));return XT(i),new me(n.firestore,n instanceof sn?n.converter:null,new U(i))}}function fg(n,e){return n=ne(n),e=ne(e),(n instanceof me||n instanceof sn)&&(e instanceof me||e instanceof sn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function pg(n,e){return n=ne(n),e=ne(e),n instanceof $e&&e instanceof $e&&n.firestore===e.firestore&&Sa(n._query,e._query)&&n.converter===e.converter}var ru=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new va(this,"async_queue_retry"),this.Vu=()=>{let i=mc();i&&V("AsyncQueue","Visibility state changed to "+i.visibilityState),this.t_.jo()},this.mu=e;let t=mc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=mc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new qe;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return k(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!_i(e))throw e;V("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(i=>{this.Eu=i,this.du=!1;let r=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(i);throw Re("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.du=!1,i))));return this.mu=t,t}enqueueAfterDelay(e,t,i){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let r=om.createAndSchedule(this,e,t,i,s=>this.yu(s));return this.Tu.push(r),r}fu(){this.Eu&&B()}verifyOperationInProgress(){}wu(){return k(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function Em(n){return function(t,i){if(typeof t!="object"||t===null)return!1;let r=t;for(let s of i)if(s in r&&typeof r[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Im=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new qe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var DI=-1,Ee=class extends Zi{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new ru,this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return k(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new ru(e),this._firestoreClient=void 0,yield e}})}};function Qe(n){if(n._terminated)throw new D(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||VI(n),n._firestoreClient}function VI(n){var e,t,i;let r=n._freezeSettings(),s=function(a,c,u,d){return new Hf(a,c,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,PI(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),n._firestoreClient=new Tm(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){let c=a?._online.build();return{_offline:a?._offline.build(c),_online:c}}(n._componentsProvider))}function OI(n,e){Ut("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return FI(n,og.provider,{build:i=>new nu(i,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function MI(n){return k(this,null,function*(){Ut("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();FI(n,og.provider,{build:t=>new _m(t,e.cacheSizeBytes)})})}function FI(n,e,t){if((n=oe(n,Ee))._firestoreClient||n._terminated)throw new D(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new D(P.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},VI(n)}function LI(n){if(n._initialized&&!n._terminated)throw new D(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new qe;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>k(this,null,function*(){try{yield function(i){return k(this,null,function*(){if(!ai.D())return Promise.resolve();let r=i+"main";yield ai.delete(r)})}(Qm(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function UI(n){return function(t){let i=new qe;return t.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return xP(yield cg(t),i)})),i.promise}(Qe(n=oe(n,Ee)))}function BI(n){return GP(Qe(n=oe(n,Ee)))}function qI(n){return KP(Qe(n=oe(n,Ee)))}function jI(n,e){let t=Qe(n=oe(n,Ee)),i=new Im;return QP(t,n._databaseId,e,i),i}function GI(n,e){return HP(Qe(n=oe(n,Ee)),e).then(t=>t?new $e(n,null,t.query):null)}var cn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(ke.fromBase64String(e))}catch(t){throw new D(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(ke.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var jt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Rn=class{constructor(e){this._methodName=e}};var er=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}};var Ta=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,r){if(i.length!==r.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(this._values,e._values)}};var YP=/^__.*__$/,Am=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new qt(e,this.data,this.fieldMask,t,this.fieldTransforms):new fi(e,this.data,t,this.fieldTransforms)}},su=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new qt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function KI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B()}}var ou=class n{constructor(e,t,i,r,s,o){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:i,xu:!1});return r.Ou(e),r}Nu(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:i,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return au(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(KI(this.Cu)&&YP.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},Cm=class{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||Ra(e)}Qu(e,t,i,r=!1){return new ou({Cu:e,methodName:t,qu:i,path:Pe.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function rr(n){let e=n._freezeSettings(),t=Ra(n._databaseId);return new Cm(n._databaseId,!!e.ignoreUndefinedProperties,t)}function vu(n,e,t,i,r,s={}){let o=n.Qu(s.merge||s.mergeFields?2:0,e,t,r);_g("Data must be an object, but it was:",o,i);let a=$I(i,o),c,u;if(s.merge)c=new It(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let p of s.mergeFields){let m=xm(e,p,t);if(!o.contains(m))throw new D(P.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);HI(d,m)||d.push(m)}c=new It(d),u=o.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,u=o.fieldTransforms;return new Am(new tt(a),c,u)}var Ea=class n extends Rn{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function zI(n,e,t){return new ou({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Sm=class n extends Rn{_toFieldTransform(e){return new Yi(e.path,new hi)}isEqual(e){return e instanceof n}},bm=class n extends Rn{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=zI(this,e,!0),i=this.Ku.map(s=>sr(s,t)),r=new Sn(i);return new Yi(e.path,r)}isEqual(e){return e instanceof n&&yh(this.Ku,e.Ku)}},Rm=class n extends Rn{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=zI(this,e,!0),i=this.Ku.map(s=>sr(s,t)),r=new bn(i);return new Yi(e.path,r)}isEqual(e){return e instanceof n&&yh(this.Ku,e.Ku)}},Pm=class n extends Rn{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new di(e.serializer,NE(e.serializer,this.$u));return new Yi(e.path,t)}isEqual(e){return e instanceof n&&this.$u===e.$u}};function mg(n,e,t,i){let r=n.Qu(1,e,t);_g("Data must be an object, but it was:",r,i);let s=[],o=tt.empty();ir(i,(c,u)=>{let d=yg(e,c,t);u=ne(u);let p=r.Nu(d);if(u instanceof Ea)s.push(d);else{let m=sr(u,p);m!=null&&(s.push(d),o.set(d,m))}});let a=new It(s);return new su(o,a,r.fieldTransforms)}function gg(n,e,t,i,r,s){let o=n.Qu(1,e,t),a=[xm(e,i,t)],c=[r];if(s.length%2!=0)throw new D(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)a.push(xm(e,s[m])),c.push(s[m+1]);let u=[],d=tt.empty();for(let m=a.length-1;m>=0;--m)if(!HI(u,a[m])){let y=a[m],C=c[m];C=ne(C);let x=o.Nu(y);if(C instanceof Ea)u.push(y);else{let N=sr(C,x);N!=null&&(u.push(y),d.set(y,N))}}let p=new It(u);return new su(d,p,o.fieldTransforms)}function WI(n,e,t,i=!1){return sr(t,n.Qu(i?4:3,e))}function sr(n,e){if(QI(n=ne(n)))return _g("Unsupported field value:",e,n),$I(n,e);if(n instanceof Rn)return function(i,r){if(!KI(r.Cu))throw r.Bu(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Bu(`${i._methodName}() is not currently supported inside arrays`);let s=i._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(i,r){let s=[],o=0;for(let a of i){let c=sr(a,r.Lu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,e)}return function(i,r){if((i=ne(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return NE(r.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){let s=Te.fromDate(i);return{timestampValue:rs(r.serializer,s)}}if(i instanceof Te){let s=new Te(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:rs(r.serializer,s)}}if(i instanceof er)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof cn)return{bytesValue:jE(r.serializer,i._byteString)};if(i instanceof me){let s=r.databaseId,o=i.firestore._databaseId;if(!o.isEqual(s))throw r.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:zm(i.firestore._databaseId||r.databaseId,i._key.path)}}if(i instanceof Ta)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Bu("VectorValues must only contain numeric values.");return Km(a.serializer,c)})}}}}}}(i,r);throw r.Bu(`Unsupported field value: ${yu(i)}`)}(n,e)}function $I(n,e){let t={};return pE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ir(n,(i,r)=>{let s=sr(r,e.Mu(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function QI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Te||n instanceof er||n instanceof cn||n instanceof me||n instanceof Rn||n instanceof Ta)}function _g(n,e,t){if(!QI(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){let i=yu(t);throw i==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+i)}}function xm(n,e,t){if((e=ne(e))instanceof jt)return e._internalPath;if(typeof e=="string")return yg(n,e);throw au("Field path arguments must be of type string or ",n,!1,void 0,t)}var JP=new RegExp("[~\\*/\\[\\]]");function yg(n,e,t){if(e.search(JP)>=0)throw au(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new jt(...e.split("."))._internalPath}catch{throw au(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function au(n,e,t,i,r){let s=i&&!i.isEmpty(),o=r!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new D(P.INVALID_ARGUMENT,a+n+c)}function HI(n,e){return n.some(t=>t.isEqual(e))}var tr=class{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new me(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new km(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(wu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},km=class extends tr{data(){return super.data()}};function wu(n,e){return typeof e=="string"?yg(n,e):e instanceof jt?e._internalPath:e._delegate._internalPath}function YI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ia=class{},nr=class extends Ia{};function kn(n,e,...t){let i=[];e instanceof Ia&&i.push(e),i=i.concat(t),function(s){let o=s.filter(c=>c instanceof Nm).length,a=s.filter(c=>c instanceof lu).length;if(o>1||o>0&&a>0)throw new D(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(let r of i)n=r._apply(n);return n}var lu=class n extends nr{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=this._parse(e);return o0(e._query,t),new $e(e.firestore,e.converter,lp(e._query,t))}_parse(e){let t=rr(e.firestore);return function(s,o,a,c,u,d,p){let m;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new D(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){tE(p,d);let y=[];for(let C of p)y.push(eE(c,s,C));m={arrayValue:{values:y}}}else m=eE(c,s,p)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||tE(p,d),m=WI(a,o,p,d==="in"||d==="not-in");return ie.create(u,d,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function JI(n,e,t){let i=e,r=wu("where",n);return lu._create(r,i,t)}var Nm=class n extends Ia{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:ue.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let o=r,a=s.getFlattenedFilters();for(let c of a)o0(o,c),o=lp(o,c)}(e._query,t),new $e(e.firestore,e.converter,lp(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Dm=class n extends nr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(r,s,o){if(r.startAt!==null)throw new D(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new D(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Qi(s,o)}(e._query,this._field,this._direction);return new $e(e.firestore,e.converter,function(r,s){let o=r.explicitOrderBy.concat([s]);return new Bt(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}};function XI(n,e="asc"){let t=e,i=wu("orderBy",n);return Dm._create(i,t)}var cu=class n extends nr{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){return new $e(e.firestore,e.converter,bc(e._query,this._limit,this._limitType))}};function ZI(n){return xI("limit",n),cu._create("limit",n,"F")}function e0(n){return xI("limitToLast",n),cu._create("limitToLast",n,"L")}var uu=class n extends nr{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=s0(e,this.type,this._docOrFields,this._inclusive);return new $e(e.firestore,e.converter,function(r,s){return new Bt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)}(e._query,t))}};function t0(...n){return uu._create("startAt",n,!0)}function n0(...n){return uu._create("startAfter",n,!1)}var hu=class n extends nr{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=s0(e,this.type,this._docOrFields,this._inclusive);return new $e(e.firestore,e.converter,function(r,s){return new Bt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)}(e._query,t))}};function i0(...n){return hu._create("endBefore",n,!1)}function r0(...n){return hu._create("endAt",n,!0)}function s0(n,e,t,i){if(t[0]=ne(t[0]),t[0]instanceof tr)return function(s,o,a,c,u){if(!c)throw new D(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let p of Yr(s))if(p.field.isKeyField())d.push($i(o,c.key));else{let m=c.data.field(p.field);if(fu(m))throw new D(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){let y=p.field.canonicalString();throw new D(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(m)}return new an(d,u)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{let r=rr(n.firestore);return function(o,a,c,u,d,p){let m=o.explicitOrderBy;if(d.length>m.length)throw new D(P.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let y=[];for(let C=0;C<d.length;C++){let x=d[C];if(m[C].field.isKeyField()){if(typeof x!="string")throw new D(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof x}`);if(!jm(o)&&x.indexOf("/")!==-1)throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${x}' contains a slash.`);let N=o.path.child(se.fromString(x));if(!U.isDocumentKey(N))throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);let q=new U(N);y.push($i(a,q))}else{let N=WI(c,u,x);y.push(N)}}return new an(y,p)}(n._query,n.firestore._databaseId,r,e,t,i)}}function eE(n,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new D(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!jm(e)&&t.indexOf("/")!==-1)throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let i=e.path.child(se.fromString(t));if(!U.isDocumentKey(i))throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return $i(n,new U(i))}if(t instanceof me)return $i(n,t._key);throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${yu(t)}.`)}function tE(n,e){if(!Array.isArray(n)||n.length===0)throw new D(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function o0(n,e){let t=function(r,s){for(let o of r)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new D(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var ps=class{convertValue(e,t="none"){switch(Wi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ve(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(li(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let i={};return ir(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertVectorValue(e){var t,i,r;let s=(r=(i=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||i===void 0?void 0:i.values)===null||r===void 0?void 0:r.map(o=>ve(o.doubleValue));return new Ta(s)}convertGeoPoint(e){return new er(ve(e.latitude),ve(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":let i=Bm(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(oa(e));default:return null}}convertTimestamp(e){let t=Cn(e);return new Te(t.seconds,t.nanos)}convertDocumentKey(e,t){let i=se.fromString(e);G(ZE(i));let r=new ci(i.get(1),i.get(3)),s=new U(i.popFirst(5));return r.isEqual(t)||Re(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Tu(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}var Vm=class extends ps{constructor(e){super(),this.firestore=e}convertBytes(e){return new cn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new me(this.firestore,null,t)}};var An=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},kt=class extends tr{constructor(e,t,i,r,s,o){super(e,t,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new si(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let i=this._document.data.field(wu("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}},si=class extends kt{data(e={}){return super.data(e)}},Gt=class{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new An(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new si(this._firestore,this._userDataWriter,i.key,i,new An(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{let c=new si(r._firestore,r._userDataWriter,a.doc.key,a.doc,new An(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new si(r._firestore,r._userDataWriter,a.doc.key,a.doc,new An(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter),u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:XP(a.type),doc:c,oldIndex:u,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function XP(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B()}}function vg(n,e){return n instanceof kt&&e instanceof kt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Gt&&e instanceof Gt&&n._firestore===e._firestore&&pg(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function a0(n){n=oe(n,me);let e=oe(n.firestore,Ee);return bI(Qe(e),n._key).then(t=>Ig(e,n,t))}var Pn=class extends ps{constructor(e){super(),this.firestore=e}convertBytes(e){return new cn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new me(this.firestore,null,t)}};function l0(n){n=oe(n,me);let e=oe(n.firestore,Ee),t=Qe(e),i=new Pn(e);return zP(t,n._key).then(r=>new kt(e,i,n._key,r,new An(r!==null&&r.hasLocalMutations,!0),n.converter))}function c0(n){n=oe(n,me);let e=oe(n.firestore,Ee);return bI(Qe(e),n._key,{source:"server"}).then(t=>Ig(e,n,t))}function u0(n){n=oe(n,$e);let e=oe(n.firestore,Ee),t=Qe(e),i=new Pn(e);return YI(n._query),RI(t,n._query).then(r=>new Gt(e,i,n,r))}function h0(n){n=oe(n,$e);let e=oe(n.firestore,Ee),t=Qe(e),i=new Pn(e);return WP(t,n._query).then(r=>new Gt(e,i,n,r))}function d0(n){n=oe(n,$e);let e=oe(n.firestore,Ee),t=Qe(e),i=new Pn(e);return RI(t,n._query,{source:"server"}).then(r=>new Gt(e,i,n,r))}function wg(n,e,t){n=oe(n,me);let i=oe(n.firestore,Ee),r=Tu(n.converter,e,t);return Ts(i,[vu(rr(i),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,Se.none())])}function Tg(n,e,t,...i){n=oe(n,me);let r=oe(n.firestore,Ee),s=rr(r),o;return o=typeof(e=ne(e))=="string"||e instanceof jt?gg(s,"updateDoc",n._key,e,t,i):mg(s,"updateDoc",n._key,e),Ts(r,[o.toMutation(n._key,Se.exists(!0))])}function f0(n){return Ts(oe(n.firestore,Ee),[new pi(n._key,Se.none())])}function p0(n,e){let t=oe(n.firestore,Ee),i=xa(n),r=Tu(n.converter,e);return Ts(t,[vu(rr(n.firestore),"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,Se.exists(!1))]).then(()=>i)}function Eg(n,...e){var t,i,r;n=ne(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Em(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Em(e[o])){let p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(i=p.error)===null||i===void 0?void 0:i.bind(p),e[o+2]=(r=p.complete)===null||r===void 0?void 0:r.bind(p)}let c,u,d;if(n instanceof me)u=oe(n.firestore,Ee),d=gs(n._key.path),c={next:p=>{e[o]&&e[o](Ig(u,n,p))},error:e[o+1],complete:e[o+2]};else{let p=oe(n,$e);u=oe(p.firestore,Ee),d=p._query;let m=new Pn(u);c={next:y=>{e[o]&&e[o](new Gt(u,m,p,y))},error:e[o+1],complete:e[o+2]},YI(n._query)}return function(m,y,C,x){let N=new ds(x),q=new wa(y,N,C);return m.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return Xm(yield fs(m),q)})),()=>{N.Za(),m.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return Zm(yield fs(m),q)}))}}(Qe(u),d,a,c)}function m0(n,e){return $P(Qe(n=oe(n,Ee)),Em(e)?e:{next:e})}function Ts(n,e){return function(i,r){let s=new qe;return i.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){return SP(yield cg(i),r,s)})),s.promise}(Qe(n),e)}function Ig(n,e,t){let i=t.docs.get(e._key),r=new Pn(n);return new kt(n,r,e._key,i,new An(t.hasPendingWrites,t.fromCache),e.converter)}var ZP={maxAttempts:5};var du=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=rr(e)}set(e,t,i){this._verifyNotCommitted();let r=ii(e,this._firestore),s=Tu(r.converter,t,i),o=vu(this._dataReader,"WriteBatch.set",r._key,s,r.converter!==null,i);return this._mutations.push(o.toMutation(r._key,Se.none())),this}update(e,t,i,...r){this._verifyNotCommitted();let s=ii(e,this._firestore),o;return o=typeof(t=ne(t))=="string"||t instanceof jt?gg(this._dataReader,"WriteBatch.update",s._key,t,i,r):mg(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Se.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=ii(e,this._firestore);return this._mutations=this._mutations.concat(new pi(t._key,Se.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function ii(n,e){if((n=ne(n)).firestore!==e)throw new D(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Om=class extends class{constructor(t,i){this._firestore=t,this._transaction=i,this._dataReader=rr(t)}get(t){let i=ii(t,this._firestore),r=new Vm(this._firestore);return this._transaction.lookup([i._key]).then(s=>{if(!s||s.length!==1)return B();let o=s[0];if(o.isFoundDocument())return new tr(this._firestore,r,o.key,o,i.converter);if(o.isNoDocument())return new tr(this._firestore,r,i._key,null,i.converter);throw B()})}set(t,i,r){let s=ii(t,this._firestore),o=Tu(s.converter,i,r),a=vu(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,r);return this._transaction.set(s._key,a),this}update(t,i,r,...s){let o=ii(t,this._firestore),a;return a=typeof(i=ne(i))=="string"||i instanceof jt?gg(this._dataReader,"Transaction.update",o._key,i,r,s):mg(this._dataReader,"Transaction.update",o._key,i),this._transaction.update(o._key,a),this}delete(t){let i=ii(t,this._firestore);return this._transaction.delete(i._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=ii(e,this._firestore),i=new Pn(this._firestore);return super.get(e).then(r=>new kt(this._firestore,i,t._key,r._document,new An(!1,!1),t.converter))}};function g0(n,e,t){n=oe(n,Ee);let i=Object.assign(Object.assign({},ZP),t);return function(s){if(s.maxAttempts<1)throw new D(P.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(s,o,a){let c=new qe;return s.asyncQueue.enqueueAndForget(()=>k(this,null,function*(){let u=yield jP(s);new wm(s.asyncQueue,u,a,o,c).au()})),c.promise}(Qe(n),r=>e(new Om(n,r)),i)}function _0(){return new Ea("deleteField")}function y0(){return new Sm("serverTimestamp")}function v0(...n){return new bm("arrayUnion",n)}function w0(...n){return new Rm("arrayRemove",n)}function T0(n){return new Pm("increment",n)}(function(e,t=!0){(function(r){ms=r})(cl),bi(new _t("firestore",(i,{instanceIdentifier:r,options:s})=>{let o=i.getProvider("app").getImmediate(),a=new Ee(new Uf(i.getProvider("auth-internal")),new Gf(i.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new D(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ci(u.options.projectId,d)}(o,r),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Ot(Zw,"4.7.3",e),Ot(Zw,"4.7.3","esm2017")})();var ex="@firebase/firestore-compat",tx="0.3.38";function Pg(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new D("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function E0(){if(typeof Uint8Array>"u")throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function I0(){if(!mE())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Eu=class n{constructor(e){this._delegate=e}static fromBase64String(e){return I0(),new n(cn.fromBase64String(e))}static fromUint8Array(e){return E0(),new n(cn.fromUint8Array(e))}toBase64(){return I0(),this._delegate.toBase64()}toUint8Array(){return E0(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Ag(n){return nx(n,["next","error","complete"])}function nx(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}var Cg=class{enableIndexedDbPersistence(e,t){return OI(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return MI(e._delegate)}clearIndexedDbPersistence(e){return LI(e._delegate)}},Iu=class{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof ci||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ut("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,i={}){kI(this._delegate,e,t,i)}enableNetwork(){return BI(this._delegate)}disableNetwork(){return qI(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,hg("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return UI(this._delegate)}onSnapshotsInSync(e){return m0(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new As(this,dg(this._delegate,e))}catch(t){throw ut(t,"collection()","Firestore.collection()")}}doc(e){try{return new un(this,xa(this._delegate,e))}catch(t){throw ut(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new cr(this,NI(this._delegate,e))}catch(t){throw ut(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return g0(this._delegate,t=>e(new Au(this,t)))}batch(){return Qe(this._delegate),new Cu(new du(this._delegate,e=>Ts(this._delegate,e)))}loadBundle(e){return jI(this._delegate,e)}namedQuery(e){return GI(this._delegate,e).then(t=>t?new cr(this,t):null)}},Es=class extends ps{constructor(e){super(),this.firestore=e}convertBytes(e){return new Eu(new cn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return un.forKey(t,this.firestore,null)}};function ix(n){nE(n)}var Au=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Es(e)}get(e){let t=or(e);return this._delegate.get(t).then(i=>new ar(this._firestore,new kt(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){let r=or(e);return i?(Pg("Transaction.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=or(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=or(e);return this._delegate.delete(t),this}},Cu=class{constructor(e){this._delegate=e}set(e,t,i){let r=or(e);return i?(Pg("WriteBatch.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=or(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=or(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Is=class n{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){let i=new si(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new lr(this._firestore,i),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let i=n.INSTANCES,r=i.get(e);r||(r=new WeakMap,i.set(e,r));let s=r.get(t);return s||(s=new n(e,new Es(e),t),r.set(t,s)),s}};Is.INSTANCES=new WeakMap;var un=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Es(e)}static forPath(e,t,i){if(e.length%2!==0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new me(t._delegate,i,new U(e)))}static forKey(e,t,i){return new n(t,new me(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new As(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new As(this.firestore,dg(this._delegate,e))}catch(t){throw ut(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ne(e),e instanceof me?fg(this._delegate,e):!1}set(e,t){t=Pg("DocumentReference.set",t);try{return t?wg(this._delegate,e,t):wg(this._delegate,e)}catch(i){throw ut(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return arguments.length===1?Tg(this._delegate,e):Tg(this._delegate,e,t,...i)}catch(r){throw ut(r,"updateDoc()","DocumentReference.update()")}}delete(){return f0(this._delegate)}onSnapshot(...e){let t=A0(e),i=C0(e,r=>new ar(this.firestore,new kt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return Eg(this._delegate,t,i)}get(e){let t;return e?.source==="cache"?t=l0(this._delegate):e?.source==="server"?t=c0(this._delegate):t=a0(this._delegate),t.then(i=>new ar(this.firestore,new kt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Is.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ut(n,e,t){return n.message=n.message.replace(e,t),n}function A0(n){for(let e of n)if(typeof e=="object"&&!Ag(e))return e;return{}}function C0(n,e){var t,i;let r;return Ag(n[0])?r=n[0]:Ag(n[1])?r=n[1]:typeof n[0]=="function"?r={next:n[0],error:n[1],complete:n[2]}:r={next:n[1],error:n[2],complete:n[3]},{next:s=>{r.next&&r.next(e(s))},error:(t=r.error)===null||t===void 0?void 0:t.bind(r),complete:(i=r.complete)===null||i===void 0?void 0:i.bind(r)}}var ar=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new un(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return vg(this._delegate,e._delegate)}},lr=class extends ar{data(e){let t=this._delegate.data(e);return this._delegate._converter||iE(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},cr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Es(e)}where(e,t,i){try{return new n(this.firestore,kn(this._delegate,JI(e,t,i)))}catch(r){throw ut(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,kn(this._delegate,XI(e,t)))}catch(i){throw ut(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,kn(this._delegate,ZI(e)))}catch(t){throw ut(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,kn(this._delegate,e0(e)))}catch(t){throw ut(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,kn(this._delegate,t0(...e)))}catch(t){throw ut(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,kn(this._delegate,n0(...e)))}catch(t){throw ut(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,kn(this._delegate,i0(...e)))}catch(t){throw ut(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,kn(this._delegate,r0(...e)))}catch(t){throw ut(t,"endAt()","Query.endAt()")}}isEqual(e){return pg(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=h0(this._delegate):e?.source==="server"?t=d0(this._delegate):t=u0(this._delegate),t.then(i=>new ka(this.firestore,new Gt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){let t=A0(e),i=C0(e,r=>new ka(this.firestore,new Gt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return Eg(this._delegate,t,i)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Is.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Sg=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new lr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},ka=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new cr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new lr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Sg(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new lr(this._firestore,i))})}isEqual(e){return vg(this._delegate,e._delegate)}},As=class n extends cr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new un(this.firestore,e):null}doc(e){try{return e===void 0?new un(this.firestore,xa(this._delegate)):new un(this.firestore,xa(this._delegate,e))}catch(t){throw ut(t,"doc()","CollectionReference.doc()")}}add(e){return p0(this._delegate,e).then(t=>new un(this.firestore,t))}isEqual(e){return fg(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Is.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function or(n){return oe(n,me)}var bg=class n{constructor(...e){this._delegate=new jt(...e)}static documentId(){return new n(Pe.keyField().canonicalString())}isEqual(e){return e=ne(e),e instanceof jt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Rg=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=y0();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=_0();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=v0(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=w0(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=T0(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var rx={Firestore:Iu,GeoPoint:er,Timestamp:Te,Blob:Eu,Transaction:Au,WriteBatch:Cu,DocumentReference:un,DocumentSnapshot:ar,Query:cr,QueryDocumentSnapshot:lr,QuerySnapshot:ka,CollectionReference:As,FieldPath:bg,FieldValue:Rg,setLogLevel:ix,CACHE_SIZE_UNLIMITED:DI};function sx(n,e){n.INTERNAL.registerComponent(new _t("firestore-compat",t=>{let i=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(i,r)},"PUBLIC").setServiceProps(Object.assign({},rx)))}function ox(n){sx(n,(e,t)=>new Iu(e,t,new Cg)),n.registerVersion(ex,tx)}ox(Be);function ax(n,e=pr){return new Mn(t=>{let i;return e!=null?e.schedule(()=>{i=n.onSnapshot({includeMetadataChanges:!0},t)}):i=n.onSnapshot({includeMetadataChanges:!0},t),()=>{i?.()}})}function S0(n,e){return ax(n,e)}function lx(n,e){return S0(n,e).pipe(Ja(void 0),Ya(),Ce(t=>{let[i,r]=t;return r.exists?i?.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}}))}function Ng(n,e){return S0(n,e).pipe(Ce(t=>({payload:t,type:"query"})))}var Su=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let i=this.ref.collection(e),{ref:r,query:s}=k0(i,t);return new Ru(r,s,this.afs)}snapshotChanges(){return lx(this.ref,this.afs.schedulers.outsideAngular).pipe(be)}valueChanges(e={}){return this.snapshotChanges().pipe(Ce(({payload:t})=>e.idField?Dt(Ae({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Fn(this.ref.get(e)).pipe(be)}};function bu(n,e){return Ng(n,e).pipe(Ja(void 0),Ya(),Ce(t=>{let[i,r]=t,s=r.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return i&&JSON.stringify(i.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((a,c)=>{let u=s.find(p=>p.doc.ref.isEqual(a.ref)),d=i?.payload.docs.find(p=>p.ref.isEqual(a.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(a.metadata)||!u&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:a}})}),o}))}function b0(n,e,t){return bu(n,t).pipe(Ai((i,r)=>cx(i,r.map(s=>s.payload),e),[]),Ha(),Ce(i=>i.map(r=>({type:r.type,payload:r}))))}function cx(n,e,t){return e.forEach(i=>{t.indexOf(i.type)>-1&&(n=ux(n,i))}),n}function xg(n,e,t,...i){let r=n.slice();return r.splice(e,t,...i),r}function ux(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return xg(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return xg(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return xg(n,e.oldIndex,1);break}return n}function R0(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Ru=class{ref;query;afs;constructor(e,t,i){this.ref=e,this.query=t,this.afs=i}stateChanges(e){let t=bu(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Ce(i=>i.filter(r=>e.indexOf(r.type)>-1)))),t.pipe(Ja(void 0),Ya(),Ws(([i,r])=>r.length>0||!i),Ce(([,i])=>i),be)}auditTrail(e){return this.stateChanges(e).pipe(Ai((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=R0(e);return b0(this.query,t,this.afs.schedulers.outsideAngular).pipe(be)}valueChanges(e={}){return Ng(this.query,this.afs.schedulers.outsideAngular).pipe(Ce(t=>t.payload.docs.map(i=>e.idField?Dt(Ae({},i.data()),{[e.idField]:i.id}):i.data())),be)}get(e){return Fn(this.query.get(e)).pipe(be)}add(e){return this.ref.add(e)}doc(e){return new Su(this.ref.doc(e),this.afs)}},kg=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?bu(this.query,this.afs.schedulers.outsideAngular).pipe(be):bu(this.query,this.afs.schedulers.outsideAngular).pipe(Ce(t=>t.filter(i=>e.indexOf(i.type)>-1)),Ws(t=>t.length>0),be)}auditTrail(e){return this.stateChanges(e).pipe(Ai((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=R0(e);return b0(this.query,t,this.afs.schedulers.outsideAngular).pipe(be)}valueChanges(e={}){return Ng(this.query,this.afs.schedulers.outsideAngular).pipe(Ce(i=>i.payload.docs.map(r=>e.idField?Ae({[e.idField]:r.id},r.data()):r.data())),be)}get(e){return Fn(this.query.get(e)).pipe(be)}},P0=new Ne("angularfire2.enableFirestorePersistence"),x0=new Ne("angularfire2.firestore.persistenceSettings"),hx=new Ne("angularfire2.firestore.settings"),dx=new Ne("angularfire2.firestore.use-emulator");function k0(n,e=t=>t){return{query:e(n),ref:n}}var fx=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,i,r,s,o,a,c,u,d,p,m,y,C,x,N,q,j){this.schedulers=c;let M=Ri(t,a,i),W=d;p&&co(M,a,m,C,x,N,y,q),[this.firestore,this.persistenceEnabled$]=wr(`${M.name}.firestore`,"AngularFirestore",M.name,()=>{let H=a.runOutsideAngular(()=>M.firestore());if(s&&H.settings(s),W&&H.useEmulator(...W),r&&!el(o)){let Y=()=>{try{return Fn(H.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),zt(!1)}};return[H,a.runOutsideAngular(Y)]}else return[H,zt(!1)]},[s,W,r])}collection(t,i){let r;typeof t=="string"?r=this.firestore.collection(t):r=t;let{ref:s,query:o}=k0(r,i),a=this.schedulers.ngZone.run(()=>s);return new Ru(a,o,this)}collectionGroup(t,i){let r=i||(o=>o),s=this.firestore.collectionGroup(t);return new kg(r(s),this)}doc(t){let i;typeof t=="string"?i=this.firestore.doc(t):i=t;let r=this.schedulers.ngZone.run(()=>i);return new Su(r,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(i){return new(i||n)(K(qn),K(jn,8),K(P0,8),K(hx,8),K(Ln),K(mt),K(vr),K(x0,8),K(dx,8),K(uo,8),K(io,8),K(ro,8),K(so,8),K(oo,8),K(ao,8),K(lo,8),K(yn,8))};static \u0275prov=ht({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),QN=(()=>{class n{constructor(){Be.registerVersion("angularfire",vn.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:P0,useValue:!0},{provide:x0,useValue:t}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=$t({type:n});static \u0275inj=Wt({providers:[fx]})}return n})();var N0=["toast-component",""];function px(n,e){if(n&1){let t=ch();Vt(0,"button",5),Xs("click",function(){rh(t);let r=gt();return sh(r.remove())}),Vt(1,"span",6),_n(2,"\xD7"),gn()()}}function mx(n,e){if(n&1&&(ah(0),_n(1),lh()),n&2){let t=gt(2);Le(),Si("[",t.duplicatesCount+1,"]")}}function gx(n,e){if(n&1&&(Vt(0,"div"),_n(1),Qs(2,mx,2,1,"ng-container",4),gn()),n&2){let t=gt();mn(t.options.titleClass),Hs("aria-label",t.title),Le(),Si(" ",t.title," "),Le(),rt("ngIf",t.duplicatesCount)}}function _x(n,e){if(n&1&&Js(0,"div",7),n&2){let t=gt();mn(t.options.messageClass),rt("innerHTML",t.message,oh)}}function yx(n,e){if(n&1&&(Vt(0,"div",8),_n(1),gn()),n&2){let t=gt();mn(t.options.messageClass),Hs("aria-label",t.message),Le(),Si(" ",t.message," ")}}function vx(n,e){if(n&1&&(Vt(0,"div"),Js(1,"div",9),gn()),n&2){let t=gt();Le(),Ys("width",t.width()+"%")}}function wx(n,e){if(n&1){let t=ch();Vt(0,"button",5),Xs("click",function(){rh(t);let r=gt();return sh(r.remove())}),Vt(1,"span",6),_n(2,"\xD7"),gn()()}}function Tx(n,e){if(n&1&&(ah(0),_n(1),lh()),n&2){let t=gt(2);Le(),Si("[",t.duplicatesCount+1,"]")}}function Ex(n,e){if(n&1&&(Vt(0,"div"),_n(1),Qs(2,Tx,2,1,"ng-container",4),gn()),n&2){let t=gt();mn(t.options.titleClass),Hs("aria-label",t.title),Le(),Si(" ",t.title," "),Le(),rt("ngIf",t.duplicatesCount)}}function Ix(n,e){if(n&1&&Js(0,"div",7),n&2){let t=gt();mn(t.options.messageClass),rt("innerHTML",t.message,oh)}}function Ax(n,e){if(n&1&&(Vt(0,"div",8),_n(1),gn()),n&2){let t=gt();mn(t.options.messageClass),Hs("aria-label",t.message),Le(),Si(" ",t.message," ")}}function Cx(n,e){if(n&1&&(Vt(0,"div"),Js(1,"div",9),gn()),n&2){let t=gt();Le(),Ys("width",t.width()+"%")}}var Dg=class{_attachedHost;component;viewContainerRef;injector;constructor(e,t){this.component=e,this.injector=t}attach(e,t){return this._attachedHost=e,e.attach(this,t)}detach(){let e=this._attachedHost;if(e)return this._attachedHost=void 0,e.detach()}get isAttached(){return this._attachedHost!=null}setAttachedHost(e){this._attachedHost=e}},Vg=class{_attachedPortal;_disposeFn;attach(e,t){return this._attachedPortal=e,this.attachComponentPortal(e,t)}detach(){this._attachedPortal&&this._attachedPortal.setAttachedHost(),this._attachedPortal=void 0,this._disposeFn&&(this._disposeFn(),this._disposeFn=void 0)}setDisposeFn(e){this._disposeFn=e}},Og=class{_overlayRef;componentInstance;duplicatesCount=0;_afterClosed=new Kt;_activate=new Kt;_manualClose=new Kt;_resetTimeout=new Kt;_countDuplicate=new Kt;constructor(e){this._overlayRef=e}manualClose(){this._manualClose.next(),this._manualClose.complete()}manualClosed(){return this._manualClose.asObservable()}timeoutReset(){return this._resetTimeout.asObservable()}countDuplicate(){return this._countDuplicate.asObservable()}close(){this._overlayRef.detach(),this._afterClosed.next(),this._manualClose.next(),this._afterClosed.complete(),this._manualClose.complete(),this._activate.complete(),this._resetTimeout.complete(),this._countDuplicate.complete()}afterClosed(){return this._afterClosed.asObservable()}isInactive(){return this._activate.isStopped}activate(){this._activate.next(),this._activate.complete()}afterActivate(){return this._activate.asObservable()}onDuplicate(e,t){e&&this._resetTimeout.next(),t&&this._countDuplicate.next(++this.duplicatesCount)}},Cs=class{toastId;config;message;title;toastType;toastRef;_onTap=new Kt;_onAction=new Kt;constructor(e,t,i,r,s,o){this.toastId=e,this.config=t,this.message=i,this.title=r,this.toastType=s,this.toastRef=o,this.toastRef.afterClosed().subscribe(()=>{this._onAction.complete(),this._onTap.complete()})}triggerTap(){this._onTap.next(),this.config.tapToDismiss&&this._onTap.complete()}onTap(){return this._onTap.asObservable()}triggerAction(e){this._onAction.next(e)}onAction(){return this._onAction.asObservable()}},D0={maxOpened:0,autoDismiss:!1,newestOnTop:!0,preventDuplicates:!1,countDuplicates:!1,resetTimeoutOnDuplicate:!1,includeTitleDuplicates:!1,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},closeButton:!1,disableTimeOut:!1,timeOut:5e3,extendedTimeOut:1e3,enableHtml:!1,progressBar:!1,toastClass:"ngx-toastr",positionClass:"toast-top-right",titleClass:"toast-title",messageClass:"toast-message",easing:"ease-in",easeTime:300,tapToDismiss:!0,onActivateTick:!1,progressAnimation:"decreasing"},V0=new Ne("ToastConfig"),Mg=class extends Vg{_hostDomElement;_componentFactoryResolver;_appRef;constructor(e,t,i){super(),this._hostDomElement=e,this._componentFactoryResolver=t,this._appRef=i}attachComponentPortal(e,t){let i=this._componentFactoryResolver.resolveComponentFactory(e.component),r;return r=i.create(e.injector),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.detachView(r.hostView),r.destroy()}),t?this._hostDomElement.insertBefore(this._getComponentRootNode(r),this._hostDomElement.firstChild):this._hostDomElement.appendChild(this._getComponentRootNode(r)),r}_getComponentRootNode(e){return e.hostView.rootNodes[0]}},Sx=(()=>{class n{_document=gr(dh);_containerElement;ngOnDestroy(){this._containerElement&&this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let t=this._document.createElement("div");t.classList.add("overlay-container"),t.setAttribute("aria-live","polite"),this._document.body.appendChild(t),this._containerElement=t}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Fg=class{_portalHost;constructor(e){this._portalHost=e}attach(e,t=!0){return this._portalHost.attach(e,t)}detach(){return this._portalHost.detach()}},bx=(()=>{class n{_overlayContainer=gr(Sx);_componentFactoryResolver=gr(H_);_appRef=gr(Za);_document=gr(dh);_paneElements=new Map;create(t,i){return this._createOverlayRef(this.getPaneElement(t,i))}getPaneElement(t="",i){return this._paneElements.get(i)||this._paneElements.set(i,{}),this._paneElements.get(i)[t]||(this._paneElements.get(i)[t]=this._createPaneElement(t,i)),this._paneElements.get(i)[t]}_createPaneElement(t,i){let r=this._document.createElement("div");return r.id="toast-container",r.classList.add(t),r.classList.add("toast-container"),i?i.getContainerElement().appendChild(r):this._overlayContainer.getContainerElement().appendChild(r),r}_createPortalHost(t){return new Mg(t,this._componentFactoryResolver,this._appRef)}_createOverlayRef(t){return new Fg(this._createPortalHost(t))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),O0=(()=>{class n{overlay;_injector;sanitizer;ngZone;toastrConfig;currentlyActive=0;toasts=[];overlayContainer;previousToastMessage;index=0;constructor(t,i,r,s,o){this.overlay=i,this._injector=r,this.sanitizer=s,this.ngZone=o,this.toastrConfig=Ae(Ae({},t.default),t.config),t.config.iconClasses&&(this.toastrConfig.iconClasses=Ae(Ae({},t.default.iconClasses),t.config.iconClasses))}show(t,i,r={},s=""){return this._preBuildNotification(s,t,i,this.applyConfig(r))}success(t,i,r={}){let s=this.toastrConfig.iconClasses.success||"";return this._preBuildNotification(s,t,i,this.applyConfig(r))}error(t,i,r={}){let s=this.toastrConfig.iconClasses.error||"";return this._preBuildNotification(s,t,i,this.applyConfig(r))}info(t,i,r={}){let s=this.toastrConfig.iconClasses.info||"";return this._preBuildNotification(s,t,i,this.applyConfig(r))}warning(t,i,r={}){let s=this.toastrConfig.iconClasses.warning||"";return this._preBuildNotification(s,t,i,this.applyConfig(r))}clear(t){for(let i of this.toasts)if(t!==void 0){if(i.toastId===t){i.toastRef.manualClose();return}}else i.toastRef.manualClose()}remove(t){let i=this._findToast(t);if(!i||(i.activeToast.toastRef.close(),this.toasts.splice(i.index,1),this.currentlyActive=this.currentlyActive-1,!this.toastrConfig.maxOpened||!this.toasts.length))return!1;if(this.currentlyActive<this.toastrConfig.maxOpened&&this.toasts[this.currentlyActive]){let r=this.toasts[this.currentlyActive].toastRef;r.isInactive()||(this.currentlyActive=this.currentlyActive+1,r.activate())}return!0}findDuplicate(t="",i="",r,s){let{includeTitleDuplicates:o}=this.toastrConfig;for(let a of this.toasts){let c=o&&a.title===t;if((!o||c)&&a.message===i)return a.toastRef.onDuplicate(r,s),a}return null}applyConfig(t={}){return Ae(Ae({},this.toastrConfig),t)}_findToast(t){for(let i=0;i<this.toasts.length;i++)if(this.toasts[i].toastId===t)return{index:i,activeToast:this.toasts[i]};return null}_preBuildNotification(t,i,r,s){return s.onActivateTick?this.ngZone.run(()=>this._buildNotification(t,i,r,s)):this._buildNotification(t,i,r,s)}_buildNotification(t,i,r,s){if(!s.toastComponent)throw new Error("toastComponent required");let o=this.findDuplicate(r,i,this.toastrConfig.resetTimeoutOnDuplicate&&s.timeOut>0,this.toastrConfig.countDuplicates);if((this.toastrConfig.includeTitleDuplicates&&r||i)&&this.toastrConfig.preventDuplicates&&o!==null)return o;this.previousToastMessage=i;let a=!1;this.toastrConfig.maxOpened&&this.currentlyActive>=this.toastrConfig.maxOpened&&(a=!0,this.toastrConfig.autoDismiss&&this.clear(this.toasts[0].toastId));let c=this.overlay.create(s.positionClass,this.overlayContainer);this.index=this.index+1;let u=i;i&&s.enableHtml&&(u=this.sanitizer.sanitize(Q_.HTML,i));let d=new Og(c),p=new Cs(this.index,s,u,r,t,d),m=[{provide:Cs,useValue:p}],y=Xa.create({providers:m,parent:this._injector}),C=new Dg(s.toastComponent,y),x=c.attach(C,s.newestOnTop);d.componentInstance=x.instance;let N={toastId:this.index,title:r||"",message:i||"",toastRef:d,onShown:d.afterActivate(),onHidden:d.afterClosed(),onTap:p.onTap(),onAction:p.onAction(),portal:x};return a||(this.currentlyActive=this.currentlyActive+1,setTimeout(()=>{N.toastRef.activate()})),this.toasts.push(N),N}static \u0275fac=function(i){return new(i||n)(K(V0),K(bx),K(Xa),K(Z_),K(mt))};static \u0275prov=ht({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Rx=(()=>{class n{toastrService;toastPackage;ngZone;message;title;options;duplicatesCount;originalTimeout;width=$s(-1);toastClasses="";state;get _state(){return this.state()}get displayStyle(){if(this.state().value==="inactive")return"none"}timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,i,r){this.toastrService=t,this.toastPackage=i,this.ngZone=r,this.message=i.message,this.title=i.title,this.options=i.config,this.originalTimeout=i.config.timeOut,this.toastClasses=`${i.toastType} ${i.config.toastClass}`,this.sub=i.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=i.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=i.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=i.toastRef.countDuplicate().subscribe(s=>{this.duplicatesCount=s}),this.state=$s({value:"inactive",params:{easeTime:this.toastPackage.config.easeTime,easing:"ease-in"}})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state.update(t=>Dt(Ae({},t),{value:"active"})),!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.outsideTimeout(()=>this.remove(),this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}updateProgress(){if(this.width()===0||this.width()===100||!this.options.timeOut)return;let t=new Date().getTime(),i=this.hideTime-t;this.width.set(i/this.options.timeOut*100),this.options.progressAnimation==="increasing"&&this.width.update(r=>100-r),this.width()<=0&&this.width.set(0),this.width()>=100&&this.width.set(100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state.update(t=>Dt(Ae({},t),{value:"active"})),this.outsideTimeout(()=>this.remove(),this.originalTimeout),this.options.timeOut=this.originalTimeout,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10)}remove(){this.state().value!=="removed"&&(clearTimeout(this.timeout),this.state.update(t=>Dt(Ae({},t),{value:"removed"})),this.outsideTimeout(()=>this.toastrService.remove(this.toastPackage.toastId),+this.toastPackage.config.easeTime))}tapToast(){this.state().value!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state().value!=="removed"&&this.options.disableTimeOut!=="extendedTimeOut"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width.set(0))}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state().value==="removed"||(this.outsideTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}outsideTimeout(t,i){this.ngZone?this.ngZone.runOutsideAngular(()=>this.timeout=setTimeout(()=>this.runInsideAngular(t),i)):this.timeout=setTimeout(()=>t(),i)}outsideInterval(t,i){this.ngZone?this.ngZone.runOutsideAngular(()=>this.intervalId=setInterval(()=>this.runInsideAngular(t),i)):this.intervalId=setInterval(()=>t(),i)}runInsideAngular(t){this.ngZone?this.ngZone.run(()=>t()):t()}static \u0275fac=function(i){return new(i||n)(Ci(O0),Ci(Cs),Ci(mt))};static \u0275cmp=ih({type:n,selectors:[["","toast-component",""]],hostVars:5,hostBindings:function(i,r){i&1&&Xs("click",function(){return r.tapToast()})("mouseenter",function(){return r.stickAround()})("mouseleave",function(){return r.delayedHideToast()}),i&2&&(Y_("@flyInOut",r._state),mn(r.toastClasses),Ys("display",r.displayStyle))},standalone:!0,features:[uh],attrs:N0,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(i,r){i&1&&Qs(0,px,3,0,"button",0)(1,gx,3,5,"div",1)(2,_x,1,3,"div",2)(3,yx,2,4,"div",3)(4,vx,2,2,"div",4),i&2&&(rt("ngIf",r.options.closeButton),Le(),rt("ngIf",r.title),Le(),rt("ngIf",r.message&&r.options.enableHtml),Le(),rt("ngIf",r.message&&!r.options.enableHtml),Le(),rt("ngIf",r.options.progressBar))},dependencies:[fh],encapsulation:2,data:{animation:[ey("flyInOut",[nl("inactive",tl({opacity:0})),nl("active",tl({opacity:1})),nl("removed",tl({opacity:0})),mh("inactive => active",ph("{{ easeTime }}ms {{ easing }}")),mh("active => removed",ph("{{ easeTime }}ms {{ easing }}"))])]},changeDetection:0})}return n})(),Px=Dt(Ae({},D0),{toastComponent:Rx}),xx=(n={})=>$_([{provide:V0,useValue:{default:Px,config:n}}]),dD=(()=>{class n{static forRoot(t={}){return{ngModule:n,providers:[xx(t)]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=$t({type:n});static \u0275inj=Wt({})}return n})();var kx=(()=>{class n{toastrService;toastPackage;appRef;message;title;options;duplicatesCount;originalTimeout;width=$s(-1);toastClasses="";get displayStyle(){return this.state()==="inactive"?"none":null}state=$s("inactive");timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,i,r){this.toastrService=t,this.toastPackage=i,this.appRef=r,this.message=i.message,this.title=i.title,this.options=i.config,this.originalTimeout=i.config.timeOut,this.toastClasses=`${i.toastType} ${i.config.toastClass}`,this.sub=i.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=i.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=i.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=i.toastRef.countDuplicate().subscribe(s=>{this.duplicatesCount=s})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state.set("active"),!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.timeout=setTimeout(()=>{this.remove()},this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))),this.options.onActivateTick&&this.appRef.tick()}updateProgress(){if(this.width()===0||this.width()===100||!this.options.timeOut)return;let t=new Date().getTime(),i=this.hideTime-t;this.width.set(i/this.options.timeOut*100),this.options.progressAnimation==="increasing"&&this.width.update(r=>100-r),this.width()<=0&&this.width.set(0),this.width()>=100&&this.width.set(100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state.set("active"),this.options.timeOut=this.originalTimeout,this.timeout=setTimeout(()=>this.remove(),this.originalTimeout),this.hideTime=new Date().getTime()+(this.originalTimeout||0),this.width.set(-1),this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))}remove(){this.state()!=="removed"&&(clearTimeout(this.timeout),this.state.set("removed"),this.timeout=setTimeout(()=>this.toastrService.remove(this.toastPackage.toastId)))}tapToast(){this.state()!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state()!=="removed"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width.set(0))}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state()==="removed"||(this.timeout=setTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10)))}static \u0275fac=function(i){return new(i||n)(Ci(O0),Ci(Cs),Ci(Za))};static \u0275cmp=ih({type:n,selectors:[["","toast-component",""]],hostVars:4,hostBindings:function(i,r){i&1&&Xs("click",function(){return r.tapToast()})("mouseenter",function(){return r.stickAround()})("mouseleave",function(){return r.delayedHideToast()}),i&2&&(mn(r.toastClasses),Ys("display",r.displayStyle))},standalone:!0,features:[uh],attrs:N0,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(i,r){i&1&&Qs(0,wx,3,0,"button",0)(1,Ex,3,5,"div",1)(2,Ix,1,3,"div",2)(3,Ax,2,4,"div",3)(4,Cx,2,2,"div",4),i&2&&(rt("ngIf",r.options.closeButton),Le(),rt("ngIf",r.title),Le(),rt("ngIf",r.message&&r.options.enableHtml),Le(),rt("ngIf",r.message&&!r.options.enableHtml),Le(),rt("ngIf",r.options.progressBar))},dependencies:[fh],encapsulation:2,changeDetection:0})}return n})(),fD=Dt(Ae({},D0),{toastComponent:kx});var gD={production:!0,firebase:{apiKey:"********************************",authDomain:"********************************",projectId:"********************************",storageBucket:"********************************",messagingSenderId:"********************************",appId:"********************************",measurementId:"********************************"}};export{dy as a,Jx as b,uo as c,Ok as d,lN as e,QN as f,gD as g,O0 as h,dD as i};
